!function(e){"use strict";e.PDFTron=e.PDFTron||{},e.PDFTron.WebViewer=e.PDFTron.WebViewer||{},e.PDFTron.WebViewer.ToolMode={Pan:"Pan",TextSelect:"TextSelect",PanAndAnnotationEdit:"PanAndAnnotationEdit",AnnotationEdit:"AnnotationEdit",AnnotationCreateCustom:"AnnotationCreateCustom",AnnotationCreateEllipse:"AnnotationCreateEllipse",AnnotationCreateFreeHand:"AnnotationCreateFreeHand",AnnotationCreateLine:"AnnotationCreateLine",AnnotationCreateRectangle:"AnnotationCreateRectangle",AnnotationCreateSticky:"AnnotationCreateSticky",AnnotationCreateTextHighlight:"AnnotationCreateTextHighlight",AnnotationCreateTextStrikeout:"AnnotationCreateTextStrikeout",AnnotationCreateTextUnderline:"AnnotationCreateTextUnderline",AnnotationCreatePolyline:"AnnotationCreatePolyline",AnnotationCreatePolygon:"AnnotationCreatePolygon",AnnotationCreatePolygonCloud:"AnnotationCreatePolygonCloud",AnnotationCreateCallout:"AnnotationCreateCallout",AnnotationCreateFreeText:"AnnotationCreateFreeText"};var t=function(){},n=function(){console.warn("Unsupported method for this viewer type.")};t.prototype={fitHeight:function(){n()},fitPage:function(){n()},fitWidth:function(){n()},fitZoom:function(){n()},getCurrentPageNumber:function(){n()},setCurrentPageNumber:function(e){n()},getLayoutMode:function(){n()},setLayoutMode:function(e){n()},getPageCount:function(){n()},getShowSideWindow:function(){n()},setShowSideWindow:function(e){n()},getToolMode:function(){n()},setToolMode:function(e){n()},getFitMode:function(){n()},setFitMode:function(e){n()},getZoomLevel:function(){n()},setZoomLevel:function(){n()},goToFirstPage:function(){n()},goToLastPage:function(){n()},goToNextPage:function(){n()},goToPrevPage:function(){n()},loadDocument:function(e){n()},rotateClockwise:function(){n()},rotateCounterClockwise:function(){n()},searchText:function(e,t){n()}},e.WebViewerInterface=t}(window),function(e){"use strict";e.ControlUtils={},e.console=e.console||{log:function(){},warn:function(){},error:function(){},assert:function(){}};var t=function(e){return"undefined"==typeof e},n=function(){var e=window.location.href,t=e.indexOf("#");return t>=0?e.substring(t+1):""};e.ControlUtils.getQueryStringMap=function(e){t(e)&&(e=!0);for(var o={},i=e?n():window.location.search.substring(1),a=i.split("&"),r=0;r<a.length;r++){var s=a[r].split("=");o[s[0]]=s[1]}return{getBoolean:function(e,n){var i=o[e];return t(i)?t(n)?null:n:(i=i.toLowerCase(),"true"===i||"yes"===i||"1"===i||"false"!==i&&"no"!==i&&"0"!==i&&!!e)},getString:function(e,n){var i=o[e];return t(i)?t(n)?null:n:decodeURIComponent(i)}}},e.ControlUtils.initialize=function(e){function t(){var e=o.getBoolean("toolbar"),t=o.getBoolean("useSharedWorker",!1);null!==e&&(ReaderControl.config.ui.hideControlBar=!e),window.readerControl=new ReaderControl({enableAnnot:o.getBoolean("a",!1),enableOffline:o.getBoolean("offline",!1),docId:o.getString("did"),serverUrl:o.getString("server_url"),user:o.getString("user"),isAdmin:o.getBoolean("admin",!1),readOnly:o.getBoolean("readonly",!1),hideToolbar:ReaderControl.config.ui.hideControlBar,showFilePicker:o.getBoolean("filepicker",!1),pdfType:r,preloadWorker:o.getBoolean("preloadWorker",!0),useDownloader:o.getBoolean("useDownloader",!0),hideAnnotationPanel:o.getBoolean("hideAnnotationPanel",!1),pageHistory:o.getBoolean("pageHistory",!0)});var n=o.getString("d");"undefined"!=typeof Android&&"undefined"!=typeof Android.getXodContentUri&&(n=Android.getXodContentUri());var i=o.getBoolean("streaming",!1),a=o.getBoolean("auto_load",!0);window.readerControl.fireEvent("viewerLoaded");var s=o.getString("p");if(null!==n&&a!==!1||s){var l;try{t&&window.parent.WebViewer&&(l=window.parent.WebViewer.workerTransportPromise())}catch(d){console.warn(d),"SecurityError"===d.name&&console.warn("workerTransportPromise option cannot be used with CORS")}o.getBoolean("startOffline")?($.ajaxSetup({cache:!0}),window.readerControl.loadDocument(n,{streaming:!1})):i===!0?window.readerControl.loadDocument(n,{streaming:i}):window.ControlUtils.byteRangeCheck(function(e){206!==e&&(i=!0,console.warn("HTTP range requests not supported. Switching to streaming mode.")),window.readerControl.loadDocument(n,{streaming:i,workerTransportPromise:l})},function(){window.readerControl.loadDocument(n,{streaming:!0,workerTransportPromise:l})})}}function n(){null!==i&&i.length>0?$.getScript(i).done(function(e,n){t()}).fail(function(e,n,o){console.warn("Config script could not be loaded. The default configuration will be used."),t()}):t()}if($(window).on("hashchange",function(){window.location.reload()}),window.ControlUtils.i18nInit(function(){window.CanvasRenderingContext2D||e()}),window.CanvasRenderingContext2D){var o=window.ControlUtils.getQueryStringMap(!window.utils.ieWebViewLocal),i=o.getString("config"),a=o.getString("xdomain_urls");null!==a&&window.ControlUtils.initXdomain(a);var r=o.getString("pdf");if("pnacl"===r||"ems"===r||"jsworker"===r||"auto"===r){var s=["external/FileSaver.min.js","pdf/PDFReaderControl.js"],l=s.map(function(e){if("jsworker"===r&&"external/FileSaver.min.js"===e)return null;var t=new $.Deferred,n=document.createElement("script");n.type="text/javascript";var o=document.getElementsByTagName("body")[0];return o.appendChild(n),n.onload=function(){t.resolve()},n.src=e,t});$.when.apply(null,l).done(function(){ReaderControl.config=DesktopReaderControl.config,n()})}else n()}},e.ControlUtils.getCustomData=function(){var t=e.ControlUtils.getQueryStringMap(),n=t.getString("custom");return null===n?null:n},e.ControlUtils.getI18nOptions=function(e){var t={useCookie:!1,useDataAttrOptions:!0,defaultValueFromContent:!1,fallbackLng:"en",resGetPath:"Resources/i18n/__ns__-__lng__.json"};return e||(t.lng="en"),t},e.ControlUtils.i18nInit=function(t){i18n.init(e.ControlUtils.getI18nOptions(),function(){$(document).trigger("i18nready"),t&&t(),$("body").i18n()})},e.ControlUtils.initXdomain=function(e){var t=JSON.parse(e),n=$("<script>").attr("src","external/xdomain.js");t.url&&n.attr("slave",t.url),$("head").append(n),t.url||xdomain.slaves(t)},e.ControlUtils.getNotifyFunction=function(e,t){switch(t){case"permissionEdit":alert(i18n.t("annotations.permissionEdit"));break;case"permissionDelete":alert(i18n.t("annotations.permissionDelete"));break;case"readOnlyCreate":alert(i18n.t("annotations.readOnlyCreate"));break;case"readOnlyDelete":alert(i18n.t("annotations.readOnlyDelete"));break;case"readOnlyEdit":alert(i18n.t("annotations.readOnlyEdit"));break;case"markupOffCreate":alert(i18n.t("annotations.markupOffCreate"));break;case"endOfDocumentSearch":alert(i18n.t("endOfDocument"))}},e.ControlUtils.byteRangeCheck=function(e,t){$.ajax({url:window.location.href,type:"GET",cache:!1,headers:{Range:"bytes=0-0"},success:function(t,n,o){e(o.status)},error:function(){t()}})};var o={toolList:[],viewerPreferences:{showSideWindow:!0},registerTool:function(t,n,o,i){var a={tool:t,name:n,annotationCheck:function(e){var t=e.elementName===o.prototype.elementName;return t&&i&&(t=i(e)),t}},r=this._importToolData(n);r&&r.defaultEditMode?a.defaultEditMode=r.defaultEditMode:a.defaultEditMode=e.ControlUtils.editMode.basic;var s=new o;s.StrokeColor&&(r&&r.colors?a.colors=r.colors:a.colors=["#FF0000","#FF8000","#FFFF00","#00FF00","#008000","#00FFFF","#0000FF","#FF00FF","#000000","#FFFFFF"]),s.FillColor&&(r&&r.fillColors?a.fillColors=r.fillColors:a.fillColors=["#FF0000","#FF8000","#FFFF00","#00FF00","#008000","#00FFFF","#0000FF","#FF00FF","#000000","#FFFFFF","transparent"]),s.TextColor&&(r&&r.textColors?a.textColors=r.textColors:a.textColors=["#FF0000","#FF8000","#FFFF00","#00FF00","#008000","#00FFFF","#0000FF","#FF00FF","#000000","#FFFFFF"]),r&&r.defaults&&(t.defaults=r.defaults),this.toolList.push(a)},_getMatchingTools:function(e){for(var t=[],n=this.toolList.length,o=0;o<n;++o)this.toolList[o].annotationCheck(e)&&t.push(this.toolList[o]);return t},getToolColors:function(e){var t=this._getMatchingTools(e);if(1===t.length)return{colors:t[0].colors,fillColors:t[0].fillColors,textColors:t[0].textColors}},getAdvancedToolColors:function(){return["#F8E0E0","#F8ECE0","#F7F8E0","#E0F8E0","#E0F8F7","#E0E0F8","#ECE0F8","#F8E0F7","#FFFFFF","#F5A9A9","#F5D0A9","#F2F5A9","#A9F5A9","#A9F5F2","#A9A9F5","#D0A9F5","#F5A9F2","#E6E6E6","#FA5858","#FAAC58","#F4FA58","#58FA58","#58FAF4","#4848FA","#AC58FA","#FA58F4","#BDBDBD","#FF0000","#FF8000","#FFFF00","#00FF00","#00FFFF","#0000FF","#8000FF","#FF00FF","#808080","#B40404","#B45F04","#AEB404","#04B404","#04B4AE","#0404B4","#5F04B4","#B404AE","#585858","#800000","#804000","#808000","#008000","#008080","#000080","#400080","#800080","#444444","#610B0B","#61380B","#5E610B","#0B610B","#0B615E","#0B0B61","#380B61","#610B5E","#2E2E2E","#2A0A0A","#2A1B0A","#292A0A","#0A2A0A","#0A2A29","#0A0A2A","#1B0A2A","#2A0A29","#000000"]},_getColorList:function(e,t){var n=null,o=this._getMatchingTools(e);return 1===o.length&&("StrokeColor"===t?n=o[0].colors:"FillColor"===t?n=o[0].fillColors:"TextColor"===t&&(n=o[0].textColors)),{tool:o[0],colorList:n}},addToolColor:function(e,t,n){var o=this._getColorList(e,t),i=o.colorList;null!==i&&i.indexOf(n)===-1&&("FillColor"===t?i.splice(-1,0,n):i.push(n),this._exportToolData(o.tool))},removeToolColor:function(e,t,n){var o=this._getColorList(e,t),i=o.colorList;if(null!==i){var a=i.indexOf(n);a>-1&&(i.splice(a,1),this._exportToolData(o.tool))}},getDefaultToolEditingMode:function(e){var t=this._getMatchingTools(e);return 1===t.length?t[0].defaultEditMode:null},setDefaultToolEditingMode:function(e,t){var n=this._getMatchingTools(e);1===n.length&&(n[0].defaultEditMode=t,this._exportToolData(n[0]))},defaultToolValueChanged:function(e,t,n){var o=this._getMatchingTools(e);1===o.length&&(o[0].tool.defaults[t]=n,this._exportToolData(o[0]))},_exportTool:function(e){var t={defaultEditMode:e.defaultEditMode};e.colors&&(t.colors=e.colors),e.fillColors&&(t.fillColors=e.fillColors),e.textColors&&(t.textColors=e.textColors),t.defaults=e.tool.defaults,this._storePreference("toolData-"+e.name,t)},_exportToolData:function(e){_.isUndefined(e)?this.toolList.forEach(this._exportTool):this._exportTool(e)},_importToolData:function(e){return this._getPreference("toolData-"+e)},getViewerPreferences:function(){return this.viewerPreferences=this._getPreference("viewerPreferences")||this.viewerPreferences,this.viewerPreferences},setViewerPreference:function(e,t){this.viewerPreferences[e]=t,this._storePreference("viewerPreferences",this.viewerPreferences)},_storePreference:function(e,t){try{localStorage[e]=JSON.stringify(t)}catch(n){console.warn("localStorage could not be accessed. "+n.message)}},_getPreference:function(e){var t;try{t=localStorage[e]}finally{return t?JSON.parse(t):null}}};e.ControlUtils.userPreferences=o,e.ControlUtils.editMode={basic:"Basic",advanced:"Advanced"},$(document).on("defaultToolValueChanged",function(e,t,n,i){o.defaultToolValueChanged(t,n,i)}),e.ControlUtils.getSelectedAnnotation=function(){var e=readerControl.docViewer.getAnnotationManager(),t=e.getSelectedAnnotations();if(t.length<=0)return null;var n=t[0];return e.canModify(n)?n:null},e.ControlUtils.PropertyManager=function(t,n,o){this.annotationProperty=t,this.$slider=n,this.$radioContainer=o,this.displayUnit="",this.annotationPropertyModifier=function(e){return e};var i=this;o.find("[data-value]").each(function(){var t=$(this),n=t.attr("data-value");t.on("click",function(){i.update(n),readerControl.fireEvent("defaultToolValueChanged",[e.ControlUtils.getSelectedAnnotation(),i.annotationProperty,i.annotationPropertyModifier(n)])})})},e.ControlUtils.PropertyManager.prototype={setDisplayUnit:function(e){this.displayUnit=e},setAnnotationPropertyModifier:function(e){this.annotationPropertyModifier=e},update:function(t,n){n=!!_.isUndefined(n)||n;var o=this.$radioContainer.find('[data-value="'+t+'"]');if(o.length>0?o.prop("checked",!0):this.$radioContainer.find("[data-value]").prop("checked",!1),this.$radioContainer.find(".propertyValue").text(Math.round(t)+this.displayUnit),n){var i=e.ControlUtils.getSelectedAnnotation();if(i){i[this.annotationProperty]=this.annotationPropertyModifier(t);var a=readerControl.docViewer.getAnnotationManager();a.trigger("annotationChanged",[[i],"modify"]),a.updateAnnotation(i),e.ControlUtils.updateAnnotPreview(i)}}}};var i;e.ControlUtils.setPreviewCanvas=function(e,t,n){i=new a(e,t,n)},e.ControlUtils.updateAnnotPreview=function(e){i.update(e)};var a=function(e,t,n){this.canvas=e,this.ctx=this.canvas.getContext("2d"),this.width=t,this.height=n};a.prototype={drawRectangle:function(e,t){var n=this.ctx.lineWidth;this.ctx.save(),this.ctx.beginPath(),this.ctx.moveTo(n,n),this.ctx.lineTo(this.width-n,n),this.ctx.lineTo(this.width-n,this.height-n),this.ctx.lineTo(n,this.height-n),this.ctx.closePath(),this.ctx.clip(),this.ctx.moveTo(0,0),this.ctx.fillRect(0,0,this.width,this.height),t&&(this.ctx.fillStyle=t.toString(),this.ctx.textAlign="center",this.ctx.textBaseline="middle",this.ctx.fillText("Aa",this.width/2,this.height/2)),this.ctx.restore(),e>0&&(this.ctx.lineWidth*=2,this.ctx.strokeRect(0,0,this.width,this.height))},drawCircle:function(){var e=.5*this.width,t=.5*this.height,n=.5*this.width,o=this.ctx.lineWidth;this.ctx.beginPath(),this.ctx.arc(e,t,n-o,0,2*Math.PI),this.ctx.fill(),this.ctx.beginPath(),this.ctx.arc(e,t,n-o/2,0,2*Math.PI),this.ctx.stroke()},drawHorizontalLine:function(){this.ctx.beginPath(),this.ctx.moveTo(0,this.height/2),this.ctx.lineTo(this.width,this.height/2),this.ctx.stroke()},drawDiagonalLine:function(){var e=10;this.ctx.beginPath(),this.ctx.moveTo(e,this.height-e),this.ctx.lineTo(this.width-e,e),this.ctx.stroke()},drawCurvedLine:function(){this.ctx.lineCap="round",this.ctx.beginPath(),this.ctx.moveTo(1/8*this.width,.5*this.height),this.ctx.bezierCurveTo(5/16*this.width,3/8*this.height,5/16*this.width,3/8*this.height,.5*this.width,.5*this.height),this.ctx.bezierCurveTo(.6875*this.width,5/8*this.height,.6875*this.width,5/8*this.height,7/8*this.width,.5*this.height),this.ctx.stroke()},drawStickyNote:function(e){var t=Math.max(e.Width/this.width,e.Height/this.height),n=.75/t;this.ctx.translate(.125*this.width,.125*this.height),this.ctx.scale(n,n),e.draw(this.ctx)},update:function(e){var t=e.StrokeThickness,n=e.StrokeColor,o=e.FillColor,i=e.Opacity,a=e.TextColor,r=e.FontSize;this.ctx.save(),this.ctx.clearRect(0,0,this.width,this.height),t&&(this.ctx.lineWidth=t),n&&(this.ctx.strokeStyle=n.toString()),o&&(this.ctx.fillStyle=o.toString()),_.isUndefined(i)||(this.ctx.globalAlpha=i),_.isUndefined(r)||(this.ctx.font=r+" Arial"),e instanceof Annotations.TextMarkupAnnotation&&!(e instanceof Annotations.TextHighlightAnnotation)||e instanceof Annotations.PolylineAnnotation?this.drawHorizontalLine():e instanceof Annotations.LineAnnotation?this.drawDiagonalLine():e instanceof Annotations.FreeHandAnnotation?this.drawCurvedLine():e instanceof Annotations.StickyAnnotation?this.drawStickyNote(e):e instanceof Annotations.RectangleAnnotation||e instanceof Annotations.FreeTextAnnotation||e instanceof Annotations.PolygonAnnotation?this.drawRectangle(t,a):e instanceof Annotations.EllipseAnnotation?this.drawCircle():o?this.drawRectangle(t,a):this.drawHorizontalLine(),this.ctx.restore()}}}(window),$(function(){"use strict";function e(e){Ae=e;var t=A.docViewer.getDisplayModeManager().getDisplayMode(),n=t.pageToWindow({x:e.x,y:e.y},e.pageIndex);n.y-=xe.scrollTop(),s(n,xe.scrollLeft(),"center center",function(e,t){t.element.css(e)}),X.dialog("open")}function t(e){if(e.matches)q.find(".visiblePriority").removeClass("active").prependTo(j);else if(j.find(".visiblePriority").insertAfter(q.find('[data-toolmode="TextSelect"]')),$("#overflowButton").hasClass("visiblePriority")){var t=j.find('[data-toolmode="AnnotationCreateSticky"]');n(t,!1)}o(A.getToolMode())}function n(e,t){var n=e.clone().attr("id","overflowButton");t&&n.addClass("active"),q.find("#overflowButton").replaceWith(n)}function o(e){q.find("[data-toolmode]").removeClass("active");var t=q.find('[data-toolmode="'+e+'"]');if(t.length>0&&t.is(":visible"))t.addClass("active");else{var o=j.find('[data-toolmode="'+e+'"]');o.length>0&&n(o,!0)}}function i(){X.dialog("close"),G.hide(),J.hide(),de.hide(),ce.hide(),Y.show(),X.dialog("option","dialogClass",fe),g(!1,!0),ye=Ce.none}function a(){if(ye===Ce.annotEdit||ye===Ce.none){if(!A.enableAnnotations)return;var t=P.getSelectedAnnotations();if(1===t.length){var n=t[0];Y.children().detach();for(var o=0;o<window.AnnotationEdit.buttons.length;++o){var i=window.AnnotationEdit.buttons[o];i.isHidden(n)||(Y.append(i.element),i.getText&&i.element.attr("data-i18n",i.getText(n)).i18n())}var a=Y.children();a.first().addClass("leftRounded"),a.last().addClass("rightRounded"),r(n)}}else ye===Ce.textSelect?v(be):ye===Ce.signature&&e(Ae)}function r(e){function t(e,t){t.element.css(e)}var n=xe.scrollTop(),o=xe.scrollLeft(),i=xe.height(),a=e.PageNumber-1,r=e.getX()+e.getWidth()/2,l=e.getY(),d=A.docViewer.getDisplayModeManager().getDisplayMode(),c=d.pageToWindow({x:r,y:l},a);X.dialog("open"),c.y-=n+Pe,s(c,o,"center bottom",function(l,c){if(l.top<Me){var h=d.pageToWindow({x:r,y:e.getY()+e.getHeight()},a);h.y=h.y-n+Pe,s(h,o,"center top",function(e,n){if(e.top+n.height-Me>i){var l=d.pageToWindow({x:r,y:0},a);l.y=i/2,s(l,o,"center center",function(e,n){t(e,n)})}else t(e,n)})}else t(l,c)})}function s(e,t,n,o){e.x-=t,X.dialog("option","position",{my:n,at:"left+"+e.x+" top+"+e.y,of:window,collision:"fit",using:function(e,t){o(e,t.element)}})}function l(e,t){var n=y(e);c(t),d(t.find('li[data-color="'+n+'"]'))}function d(e){e.prepend('<div class="color-selected"></div>')}function c(e){e.find("div.color-selected").remove()}function h(e){var t=$('<li data-color="'+e+'"></li>');"transparent"===e&&(e='url("Resources/color_none.png")');var n=$("<div></div>").css("background",e);return t.append(n),t}function u(e){pe=e;var t,n;e===ge.color?(t=G.find("#colorButton"),n=he.colors):e===ge.fillColor?(t=G.find("#fillColorButton"),n=he.fillColors):e===ge.textColor&&(t=G.find("#textColorButton"),n=he.textColors),L.removeClass("removing"),we=!1,x.removeClass("active"),t.addClass("active"),p();var o=window.ControlUtils.getSelectedAnnotation();o&&(k.find("[data-color]").remove(),n.forEach(function(e){D.before(h(e))}),l(o[pe],S),l(o[pe],U))}function f(e,t){var n=pe,o=window.ControlUtils.getSelectedAnnotation();if(o){var i=b(e.attr("data-color"));if(we){var a=y(i);"transparent"!==a&&(M.removeToolColor(o,n,a),he=M.getToolColors(o),e.remove())}else c(t),d(e),i&&(o[n]=i,P.updateAnnotation(o),P.trigger("annotationChanged",[[o],"modify"]),A.fireEvent("defaultToolValueChanged",[o,n,i]),window.ControlUtils.updateAnnotPreview(o))}}function g(e,t){we=e,we?(L.addClass("removing"),k.find("li").each(function(e,t){var n=t.getAttribute("data-color");if(null!==n&&"transparent"!==n){var o=$(t);o.find("div.color-selected").remove(),o.prepend('<div class="color-removing"></div>')}})):(L.removeClass("removing"),k.find("div.color-removing").remove(),t||u(pe))}function p(){var e=U.find('[data-color="transparent"]');pe===ge.fillColor?e.show():e.hide()}function w(){function e(e){return 100===e?"":e}function t(e){me=e,u(pe),me===ve.basic?(ne.addClass("selected"),ie.show(),oe.removeClass("selected"),ae.hide(),Z.parent().insertBefore(W)):me===ve.advanced&&(ne.removeClass("selected"),ie.hide(),oe.addClass("selected"),ae.show(),Z.parent().insertBefore(z))}function n(){J.hide(),G.show()}$(document).on("sidePanelVisibilityChanged notesPanelVisibilityChanged",function(){a()}),A.docViewer.on("fitModeUpdated displayModeUpdated zoomUpdated",function(){A.docViewer.getDocument()&&a()}),A.docViewer.on("beforeDocumentLoaded pageNumberUpdated",function(){i()}),X.find("#annotEditDone").on("click",function(){P.deselectAllAnnotations(),i()}),X.find("#annotEditDelete").on("click",function(){P.deleteAnnotations(P.getSelectedAnnotations())}),ee.on("click",function(){X.dialog("option","dialogClass",ue),G.show(),Y.hide();var e=P.getSelectedAnnotations()[0];if(e){ye=Ce.annotEdit,he=M.getToolColors(e);var n=e.StrokeColor,i=e.FillColor,a=e.TextColor,d=0,c=G.find("#colorType").show();x.show(),a?(u(ge.textColor),d++):G.find("#textColorButton").hide(),i?(u(ge.fillColor),d++):G.find("#fillColorButton").hide(),n?(u(ge.color),d++):G.find("#colorButton").hide(),e.FontSize?(o.update(parseFloat(e.FontSize),!1),V.show()):V.hide(),null!==e.StrokeThickness&&"undefined"!=typeof e.StrokeThickness?(E.show(),e instanceof Annotations.FreeTextAnnotation&&e.getIntent()===Annotations.FreeTextAnnotation.Intent.FreeText?O.slider("option","min",0):O.slider("option","min",1),s.update(e.StrokeThickness,!1)):E.hide(),e instanceof Annotations.TextHighlightAnnotation?(B.hide(),Z.hide()):(B.show(),l.update(100*e.Opacity,!1),Z.show()),d<=1?c.hide():2===d?x.css("width","50%"):3===d&&x.css("width","33%"),window.ControlUtils.updateAnnotPreview(e),t(M.getDefaultToolEditingMode(e)),r(e)}}),G.find("#colorButton").on("click",function(){u(ge.color)}),G.find("#fillColorButton").on("click",function(){u(ge.fillColor)}),G.find("#textColorButton").on("click",function(){u(ge.textColor)}),te.on("click",function(){var e=P.getSelectedAnnotations()[0];e&&(P.useDefaultStickyNotes()&&($(e).data("popup").show(),e.getPopup().setOpen(!0),P.drawAnnotations(e.PageNumber)),P.canModify(e)||P.getReadOnly()?P.trigger("annotationDoubleClicked",e):$(document).trigger("startAddingReply",e))}),S.on("click","li",function(){f($(this),S)});var o=new $e("FontSize",N,F);o.setAnnotationPropertyModifier(function(e){return e+"pt"}),N.slider({range:"min",min:5,max:72,value:9,slide:function(e,t){var n=window.ControlUtils.getSelectedAnnotation();n&&($(t.handle).html(t.value),o.update(t.value))},stop:function(e,t){var n=window.ControlUtils.getSelectedAnnotation();n&&(P.trigger("annotationChanged",[[n],"modify"]),A.fireEvent("defaultToolValueChanged",[n,"FontSize",t.value+"pt"]))},change:function(e,t){var n=$(t.handle);n.attr("title",t.value),n.html(t.value)}});var s=new $e("StrokeThickness",O,_);s.setDisplayUnit("pt"),O.slider({range:"min",min:1,max:12,value:1,slide:function(e,t){var n=window.ControlUtils.getSelectedAnnotation();n&&($(t.handle).html(t.value),s.update(t.value))},stop:function(e,t){var n=window.ControlUtils.getSelectedAnnotation();n&&(P.trigger("annotationChanged",[[n],"modify"]),A.fireEvent("defaultToolValueChanged",[n,"StrokeThickness",t.value]))},change:function(e,t){var n=$(t.handle);n.attr("title",t.value),n.html(t.value)}});var l=new $e("Opacity",I,R);l.setDisplayUnit("%"),l.setAnnotationPropertyModifier(function(e){return e/100}),I.slider({range:"min",min:0,max:100,value:100,slide:function(t,n){var o=window.ControlUtils.getSelectedAnnotation();o&&($(n.handle).html(e(n.value)),l.update(n.value))},stop:function(e,t){var n=window.ControlUtils.getSelectedAnnotation();n&&(P.trigger("annotationChanged",[[n],"modify"]),A.fireEvent("defaultToolValueChanged",[n,"Opacity",t.value/100]))},change:function(t,n){var o=$(n.handle);o.attr("title",n.value),o.html(e(n.value))}});var w=M.getAdvancedToolColors();w.forEach(function(e){var t=h(e);H.append(t),U.append(t.clone())}),U.append(h("transparent")),D.on("click",function(e){e.stopImmediatePropagation(),G.hide(),J.show(),c(H),se.addClass("disabled")}),L.on("click",function(e){e.stopImmediatePropagation(),g(!we)}),ne.on("click",function(){t(ve.basic),M.setDefaultToolEditingMode(window.ControlUtils.getSelectedAnnotation(),ve.basic)}),oe.on("click",function(){t(ve.advanced),M.setDefaultToolEditingMode(window.ControlUtils.getSelectedAnnotation(),ve.advanced),p()}),U.on("click","li",function(){f($(this),U)}),H.on("click","li",function(){c(H),d($(this)),se.removeClass("disabled")}),re.on("click",function(){n()}),se.on("click",function(){if(!$(this).hasClass("disabled")){var e=H.find(".color-selected").parent().attr("data-color");M.addToolColor(window.ControlUtils.getSelectedAnnotation(),pe,e),u(pe),f(k.find('li[data-color="'+e+'"]'),S),n()}})}function v(e){be=e;var t=e.quad,n={x:(t.x1+t.x3)/2,y:Math.min(t.y1,t.y3),pageIndex:e.pageIndex},o=A.docViewer.getDisplayModeManager().getDisplayMode(),i=o.pageToWindow({x:n.x,y:n.y},n.pageIndex);i.y-=xe.scrollTop()+Pe,s(i,xe.scrollLeft(),"center bottom",function(e,t){e.top<Me&&(e.top=Me+Pe),t.element.css(e)}),X.dialog("open")}function m(){function e(e,n,o){ce.find("#"+e).on("click",function(){for(var e in t)if(t.hasOwnProperty(e)){var a=parseInt(e,10),r=t[a],s=new n;s.PageNumber=a+1,s.Quads=r,s.Author=A.getAnnotationUser(),s.StrokeColor=o.defaults.StrokeColor,Tools.TextAnnotationCreateTool.AUTO_SET_TEXT&&s.setContents(A.docViewer.getSelectedText()),P.addAnnotation(s)}A.docViewer.clearSelection(),i()})}var t=null;ce=$("#textSelectionContainer");var n=ce.find("#copyButton");Te||(n.hide(),n.next().addClass("leftRounded")),A.docViewer.on("textSelected",function(e,t){null===t&&i()});var o=A.toolModeMap[window.PDFTron.WebViewer.ToolMode.TextSelect];o.on("selectionComplete",function(e,o,i){if(P.getReadOnly()||!A.enableAnnotations){if(!Te)return;n.siblings().hide(),n.addClass("rightRounded")}ye=Ce.textSelect,t=i,ce.show(),de.hide(),Y.hide(),v(o)}),n.on("click",function(){A.copyButtonHandler(),i()}),e("selectHighlightButton",Annotations.TextHighlightAnnotation,A.toolModeMap.AnnotationCreateTextHighlight),e("selectStrikeoutButton",Annotations.TextStrikeoutAnnotation,A.toolModeMap.AnnotationCreateTextStrikeout),e("selectUnderlineButton",Annotations.TextUnderlineAnnotation,A.toolModeMap.AnnotationCreateTextUnderline),e("selectSquigglyButton",Annotations.TextSquigglyAnnotation,A.toolModeMap.AnnotationCreateTextSquiggly)}function C(){q.on("click","span",function(){var e=$(this);if("overflowTools"!==e.attr("id")){var t=e.hasClass("annotTool");if(t&&P.getReadOnly())return void T.trigger("notify","readOnlyCreate");if(t&&P.getMarkupOff())return void T.trigger("notify","markupOffCreate");var n=e.attr("data-toolmode");A.setToolMode(n)}}),j.on("click","span",function(){if(P.getReadOnly())return void T.trigger("notify","readOnlyCreate");if(P.getMarkupOff())return void T.trigger("notify","markupOffCreate");var e=$(this),t=e.attr("data-toolmode");A.setToolMode(t)}),T.on("mouseLeftDown",function(){i()}),T.on("mouseLeftUp",function(){setTimeout(function(){a()},0)})}function y(e){var t=e.toHexString();return t||(t="transparent"),t}function b(e){return"transparent"===e?new Annotations.Color(255,255,255,0):new Annotations.Color(e)}var A,T,P,M,x,S,k,V,F,E,_,B,R,D,L,U,H,N,O,I,W,z,q,j,Z,K,X,Y,G,J,Q,ee,te,ne,oe,ie,ae,re,se,le,de,ce,he,ue="no-title annotEditDialog",fe=ue+" dialogTransparent",ge={color:"StrokeColor",fillColor:"FillColor",textColor:"TextColor"},pe=ge.color,we=!1,ve=window.ControlUtils.editMode,me=ve.basic,Ce={none:0,annotEdit:1,textSelect:2,signature:3},ye=Ce.none,be=null,Ae=null,Te=!0,$e=function(e,t,n){window.ControlUtils.PropertyManager.apply(this,arguments),n.buttonset()};$e.prototype=$.extend({},window.ControlUtils.PropertyManager.prototype,{update:function(e){window.ControlUtils.PropertyManager.prototype.update.apply(this,arguments),this.$radioContainer.buttonset("refresh"),this.$slider.slider("option","value",e)}}),$(document).on("viewerLoaded",function(){function n(){a.prop("checked",!1);var e=$("#signatureAddButton");e.hasClass("unclickableButton")||e.addClass("unclickableButton");var t=window.innerWidth*(2/3);le.dialog("option",{width:t,height:t/2}),le.dialog("open")}if(A=window.readerControl,T=A.docViewer,P=T.getAnnotationManager(),M=window.ControlUtils.userPreferences,$(".annotTool").hide(),$("#overflowTools").hide(),X=$("#annotEditDialog").dialog({autoOpen:!1,draggable:!1,resizable:!1,minHeight:"auto",width:"auto",dialogClass:fe}),G=X.find("#annotEditProperties"),S=G.find("#colorPicker"),k=S.find(".colorPicker"),x=G.find(".colorButton"),V=G.find(".fontSizePicker"),F=G.find("#fontSizeRadio"),N=G.find("#advancedFontSizeSlider"),E=G.find(".thicknessPicker"),_=G.find("#thicknessRadio"),O=G.find("#advancedThicknessSlider"),B=G.find(".opacityPicker"),R=G.find("#opacityRadio"),I=G.find("#advancedOpacitySlider"),ie=G.find("#basicProperties"),ae=G.find("#advancedProperties"),U=ae.find(".colorPicker"),ne=G.find("#basicPropertyEdit"),oe=G.find("#advancedPropertyEdit"),W=G.find("#basicPropertyContainer"),z=G.find("#advancedPropertyContainer"),J=X.find("#addNewColor"),H=J.find(".colorPicker"),re=J.find("#cancelAddColor"),se=J.find("#selectAddColor"),D=G.find("#addColorButton"),L=G.find("#removeColorButton"),Y=X.find("#annotEditButtons"),Q=Y.find("#annotEditDelete"),ee=Y.find("#annotEditStyle"),te=Y.find("#annotEditNote"),q=$("#toolList"),j=$("#overflowToolsContainer"),K=document.getElementById("annotPreviewCanvas"),Z=$(K),window.ControlUtils.setPreviewCanvas(K,K.width,K.height),C(),w(),m(),window.AnnotationEdit={buttons:[{element:Y.find("#annotEditDone"),isHidden:function(){return!1}},{element:Y.find("#annotEditDelete"),isHidden:function(e){return!P.canModify(e)}},{element:Y.find("#annotEditStyle"),isHidden:function(e){return!P.canModify(e)||e instanceof Annotations.StampAnnotation}},{element:Y.find("#annotEditNote"),isHidden:function(e){var t=e instanceof Annotations.FreeTextAnnotation,n=P.getReadOnly()&&(""===e.getContents()||t),o=!e.Listable&&!t;return n||o},getText:function(e){return P.getReadOnly()?"annotationPopup.buttonNote":P.canModify(e)?e instanceof Annotations.FreeTextAnnotation?"annotationPopup.buttonEditText":"annotationPopup.buttonNote":"annotationPopup.buttonReply"}}]},context.settings({click:!0,right:!0,minWidth:!1}),context.attach("#overflowTools",j[0]),window.matchMedia){var o=window.matchMedia("(max-width: 1024px)");o.addListener(t),t(o)}le=$("#signatureDialog").dialog({autoOpen:!1,draggable:!1,resizable:!1,modal:!0,dialogClass:"noCloseButton",open:function(){var e=$(this),t=window.utils.getCanvasMultiplier(),n=e.width(),o=e.height()-35;l.attr({width:n*t,height:o*t}).css({width:n,height:o}),r.openSignature()},close:function(){r.clearSignatureCanvas()}}),de=$("#signatureSelectionContainer"),$("#signatureCancelButton").on("click",function(){le.dialog("close")}),$("#signatureClearButton").on("click",function(){r.clearSignatureCanvas();var e=$("#signatureAddButton");e.hasClass("unclickableButton")||e.addClass("unclickableButton")}),$("#signatureAddButton").on("click",function(){var e=a.prop("checked"),t=r.addSignature(e);t&&le.dialog("close")}),$("#mySignatureButton").on("click",function(){r.addDefaultSignature(),i()}),$("#newSignatureButton").on("click",function(){n(),i()}),$("#makeDefaultSignatureText").on("click",function(){var e=a.prop("checked");a.prop("checked",!e)});var a=$("#makeDefaultSignature"),r=A.toolModeMap.AnnotationCreateSignature;r.on("locationSelected",function(t,o){r.hasDefaultSignature()?(ye=Ce.signature,de.show(),ce.hide(),Y.hide(),e(o)):n()});var s=$("#signatureAddButton"),l=$("#signatureCanvas");$(document).on("mouseup click touchend",function(){s.hasClass("unclickableButton")&&!r.isEmptySignature()&&s.removeClass("unclickableButton")}),r.setSignatureCanvas(l)}),$(document).on("toolModeChanged",function(e,t){var n="";for(var i in A.toolModeMap)if(t===A.toolModeMap[i]){n=i;break}n&&o(n)}),$(document).on("documentLoaded",function(){P=T.getAnnotationManager(),!P.getReadOnly()&&A.enableAnnotations&&($(".annotTool").css("display",""),$("#overflowTools").show()),P.on("annotationSelected",function(e,t,n){null!==t&&1===t.length||i()}),P.on("annotationChanged",function(e,t,n){e.imported||"delete"!==n||i()})});var Pe=10,Me=$("#control").outerHeight(),xe=$("#DocumentViewer");xe.on("scroll",function(){i()})}),$(function(){"use strict";function e(e){e?(S.showAllAnnotLines(),p.resizable("enable"),m.removeClass("chevron-left").addClass("chevron-right")):(S.hideAllAnnotLines(),p.resizable("disable"),m.removeClass("chevron-right").addClass("chevron-left"))}function t(){var e=p.width(),t=window.innerWidth,n=Math.max(.45*t,y);p.resizable("option","maxWidth",n),e>n&&p.width(n)}function n(e){setTimeout(e,0)}function o(e){e&&e.target!==window||(t(),w.height(T.getViewerHeight()),p.height(T.getViewerHeight()),T.notesPanelVisible()&&(w.hasClass("hidden")||n(function(){var e=S.getPanelAdjustment();w.width(p.width()-v.width()+e),
S.updateAllPositions(),S.updateAllAnnotLines()})))}var i=window.ControlUtils.getQueryStringMap();if(!i.getBoolean("hideAnnotationPanel",!1)){var a=function(e,t,n){this._editable=t,this._replyable=n,this._isEditing=!1,this._stayUncollapsed=!1,this._annotation=e,this._parent=null,this.$container=$('<div class="noteContainer">'),this.createContainer()};a.prototype={COLLAPSE_HEIGHT:120,createContainer:function(){var e=this,t=this.getAnnotation(),n=this.getContainer();n.data("annot",t);var o=$('<div class="noteHeader">'),i=$("<table>"),a=$("<tr>"),r=$("<td>"),s=new Image;s.height=32,s.width=32,s.src="./Resources/user.png",r.append(s),r.addClass("user-image-col"),a.append(r);var l=$('<td class="noteAuthorAndTime">'),d=$('<span class="noteAuthor">').text(t.Author),c=$('<span class="noteSubject">').text(t.Subject);l.append(d),l.append("<span> - </span>"),l.append(c);var h="h:mm A MMM D";(new Date).getFullYear()!==t.DateCreated.getFullYear()&&(h="h:mm A MMM D YYYY");var u=$('<div class="noteTime">').text(moment(t.DateCreated).format(h));l.append(u),a.append(l),i.append(a),o.append(i),n.append(o),this.$staticNoteContents=$('<div class="staticNoteContents">').text(t.getContents()),n.append(this.$staticNoteContents),this.$collapseButtonsContainer=$('<div class="collapseButtonsContainer">'),this.$showMoreButton=$('<a class="notesLink" data-i18n="notesPanel.showMore"></a>'),this.$showMoreButton.on("click",function(){e._stayUncollapsed=!0,e.$staticNoteContents.removeClass("noteCollapsed"),e.$showMoreButton.hide(),e.$showLessButton.show()}),this.$showLessButton=$('<a class="notesLink" data-i18n="notesPanel.showLess"></a>'),this.$showLessButton.on("click",function(){e._stayUncollapsed=!1,e.$staticNoteContents.addClass("noteCollapsed"),e.$showMoreButton.show(),e.$showLessButton.hide()}),this.$collapseButtonsContainer.append(this.$showMoreButton),this.$collapseButtonsContainer.append(this.$showLessButton),n.append(this.$collapseButtonsContainer),this.$editButtonsContainer=$('<div class="editButtonsContainer">');var f=$('<a class="notesLink" data-i18n="notesPanel.edit"></a>');f.on("click",function(){e.switchToEditingMode(),e.trigger("update")});var g=$('<a class="notesLink" data-i18n="notesPanel.delete"></a>');g.on("click",function(){e.showDeleteConfirmation()}),this.$editButtonsContainer.append(f),this.$editButtonsContainer.append(g),n.append(this.$editButtonsContainer),this._editable||this.$editButtonsContainer.hide(),this.$noteContents=$('<div class="noteContents">').hide(),this.$textarea=$('<textarea class="panelElementFont">'),this.$textarea.on("update",function(){e._updateSaveButtonStatus()}),this._handleKeyboardSaveShortcut(this.$textarea,function(){e.$saveButton.trigger("click")}),this.$noteContents.append(this.$textarea),n.append(this.$noteContents);var p=$('<div class="noteButtonsContainer">');this.$saveButton=$('<button type="button" class="roundedCornerButton" data-i18n="notesPanel.save"></button>'),this.$saveButton.on("click",function(){e.save()});var w=$('<button type="button" class="roundedCornerButton" data-i18n="notesPanel.cancel"></button>');w.on("click",function(){e.cancel(!0)}),p.append(this.$saveButton),p.append(w),this.$noteContents.append(p),n.i18n()},getContainer:function(){return this.$container},getAnnotation:function(){return this._annotation},setParent:function(e){this._parent=e},getText:function(){return this.getAnnotation().getContents()||""},isEditing:function(){return this._isEditing},forceUncollapsed:function(){this._stayUncollapsed=!0},unforceUncollapsed:function(){this._stayUncollapsed=!1},collapseContents:function(){this.$staticNoteContents.removeClass("noteCollapsed"),this.$staticNoteContents.height()>this.COLLAPSE_HEIGHT?this._stayUncollapsed?(this.$showMoreButton.hide(),this.$showLessButton.show()):(this.$staticNoteContents.addClass("noteCollapsed"),this.$showMoreButton.show(),this.$showLessButton.hide()):(this.$showMoreButton.hide(),this.$showLessButton.hide())},isEmpty:function(){var e=this.getAnnotation().getContents();return""===e||"undefined"==typeof e},save:function(){this.showTextBox(),this.trigger("save",this.$textarea.val())},cancel:function(e){this.setTextareaToNoteText(),this.showTextBox(),e&&this.trigger("cancel")},highlightText:function(e){if(!e)return void this.updateText();var t=new RegExp("("+e+")","ig");this.$staticNoteContents.html(this.getText().replace(t,"<span class='highlight'>$1</span>"))},_updateButtonStatus:function(e,t){""===e.val()?t.prop("disabled",!0):t.prop("disabled",!1)},_updateSaveButtonStatus:function(){this._updateButtonStatus(this.$textarea,this.$saveButton)},_setFlexible:function(e){e.flexible();var t=this;e.off("heightChanged").on("heightChanged",function(){t.trigger("update")})},initFlexibleTextarea:function(){this._setFlexible(this.$textarea)},remove:function(){this._parent&&this._parent.replyRemoved(this),this.$textarea.flexible("remove"),this.getContainer().remove(),this.off()},select:function(){},deselect:function(){},focusInput:function(e){this.$textarea.focus(),e&&this.$textarea.select()},showEditBox:function(){this._isEditing=!0,this.$staticNoteContents.hide(),this.$editButtonsContainer.hide(),this.$collapseButtonsContainer.hide(),this.$noteContents.show(),this.initFlexibleTextarea(),this.$textarea.trigger("updateHeight")},showTextBox:function(){this._stayUncollapsed=!0,this._isEditing=!1,this.$noteContents.hide(),this.$staticNoteContents.show(),this.$editButtonsContainer.show(),this.$collapseButtonsContainer.show()},switchToEditingMode:function(e,t){this.setTextareaToNoteText(),this._updateSaveButtonStatus(),this.showEditBox(),t||this.focusInput(e)},_handleKeyboardSaveShortcut:function(e,t){var n=13;e.on("keydown",function(o){var i=o.metaKey||o.ctrlKey;if(i&&o.which===n){var a=e.val();a&&t(a)}})},_createDeleteConfirmationElement:function(e,t){var n=this,o=$('<div class="noteDeleteShadow">'),i=$('<div class="deleteConfirmText">');i.attr("data-i18n",e),o.append(i),t=t||function(){};var a=$('<button type="button" class="roundedCornerButton" data-i18n="notesPanel.delete"></button>');a.on("click",function(){t(),n.removeDeleteConfirmation(),n.trigger("delete")});var r=$('<button type="button" class="roundedCornerButton" data-i18n="notesPanel.cancel"></button>');return r.on("click",function(){n.removeDeleteConfirmation()}),o.append(a),o.append(r),o.i18n(),o},showDeleteConfirmation:function(){var e=this._createDeleteConfirmationElement("notesPanel.deleteComment");this.getContainer().append(e)},removeDeleteConfirmation:function(){this.getContainer().find(".noteDeleteShadow").remove()},setTextareaToNoteText:function(){this.$textarea.val(this.getText()),this.$textarea.trigger("updateHeight")},updateText:function(){var e=this.getText();e=e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),this.$staticNoteContents.html(Autolinker.link(e))}},$.extend(a.prototype,window.utils.eventHandler);var r=function(){a.apply(this,arguments),this._topValue=null,this._height=null,this._replies=[];var e=this;this.$rootElement=$('<div class="panelElement panelElementFont">'),this.$rootElement.on("click",function(){e.showReplyBox(),e.trigger("clicked"),e.trigger("update")}),this.$rootElement.append(this.getContainer()),this.$replyContainer=$('<div class="replyContainer">').hide(),this.$replyTextarea=$('<textarea class="panelElementFont replyTextarea" data-i18n="[placeholder]notesPanel.enterReply"></textarea>'),this.$replyTextarea.on("update",function(){e._updateReplyButtonStatus()}),this.$replyTextarea.on("focus",function(){e._updateReplyButtonStatus(),e.$replyButtonsContainer.show(),e.trigger("update")}),this.$replyTextarea.on("blur",function(){""===e.$replyTextarea.val()&&(e.$replyButtonsContainer.hide(),e.trigger("update"))}),this._handleKeyboardSaveShortcut(this.$replyTextarea,function(t){e.trigger("reply",t),e.$replyTextarea.focus()}),this.$replyContainer.append(this.$replyTextarea),this.$replyButtonsContainer=$('<div class="replyButtonsContainer">').hide(),this.$replyButton=$('<button type="button" class="roundedCornerButton" data-i18n="notesPanel.reply"></button>'),this.$replyButton.on("click",function(){e.trigger("reply",e.$replyTextarea.val())});var t=$('<button type="button" class="roundedCornerButton" data-i18n="notesPanel.cancel"></button>');t.on("click",function(){e._resetReplyBox(),e.trigger("update")}),this.$replyButtonsContainer.append(this.$replyButton),this.$replyButtonsContainer.append(t),this.$replyContainer.append(this.$replyButtonsContainer),this.$rootElement.append(this.$replyContainer),this.$rootElement.i18n()};r.prototype={getElement:function(){return this.$rootElement},getTop:function(){return this._topValue},setTop:function(e){this._topValue=e},updateTopPosition:function(){this.getElement().css("top",this.getTop())},getHeight:function(){return this._height},recalculateHeight:function(){this.collapseContents();for(var e=0;e<this._replies.length;++e)this._replies[e].collapseContents();this._height=this.getElement().outerHeight()},show:function(){this.getElement().show()},hide:function(){this.getElement().hide()},select:function(e){this.getElement().addClass("selectedNote"),e&&this.isEmpty()&&this.switchToEditingMode(!1,!0)},deselect:function(e){this.getElement().removeClass("selectedNote");var t=[this].concat(this._replies);t.forEach(function(t){t.isEditing()&&(""===t.$textarea.val()?t.cancel(e):t.save())})},isVisible:function(){return"none"!==this.getElement().css("display")},remove:function(){this._replies=null,a.prototype.remove.call(this),this.$replyTextarea.flexible("remove"),this.getElement().remove()},replyRemoved:function(e){this._replies&&this._replies.remove(e)},_disableAnimations:function(){this.getElement().addClass("noTransition")},_enableAnimations:function(){this.getElement().removeClass("noTransition")},switchToEditingMode:function(){this.show(),a.prototype.switchToEditingMode.apply(this,arguments)},startAddingReply:function(){this.show(),this.showReplyBox(),this.$replyTextarea.focus()},showDeleteConfirmation:function(){var e=this,t=this.isEmpty()?"notesPanel.deleteAnnotation":"notesPanel.deleteCommentThread",n=this._createDeleteConfirmationElement(t,function(){e._resetReplyBox(),e.hideReplyBox()});this.getElement().append(n)},removeDeleteConfirmation:function(){this.getElement().children(".noteDeleteShadow").remove()},removeAllDeleteConfirmations:function(){this.getElement().find(".noteDeleteShadow").remove()},_updateReplyButtonStatus:function(){this._updateButtonStatus(this.$replyTextarea,this.$replyButton)},showReplyBox:function(){if(this._replyable){this.$replyContainer.show(),this._setFlexible(this.$replyTextarea);var e=document.activeElement===this.$replyTextarea[0];e&&this.$replyButtonsContainer.show()}},hideReplyBox:function(){""===this.$replyTextarea.val()&&(this.$replyContainer.hide(),this.$replyButtonsContainer.hide())},_resetReplyBox:function(){this._clearReplyText(),this.$replyButtonsContainer.hide()},_clearReplyText:function(){this.$replyTextarea.val(""),this.$replyTextarea.trigger("updateHeight")},addReply:function(e,t){e.setParent(this),this._replies.push(e),t||this._resetReplyBox(),e.getContainer().addClass("replyContainer");var n=this.getElement().children(".noteContainer.replyContainer").add(e.getContainer());n.sort(function(e,t){return $(e).data("annot").DateCreated-$(t).data("annot").DateCreated}),this.$replyContainer.before(n)}},r.prototype=$.extend({},a.prototype,r.prototype);var s=function(){this.$horizontalLine1=$("<div>").addClass("noteLine horizontal"),this.$horizontalLine2=$("<div>").addClass("noteLine horizontal"),this.$verticalLine=$("<div>").addClass("noteLine vertical"),this.$elements=$([this.$horizontalLine1[0],this.$horizontalLine2[0],this.$verticalLine[0]])};s.prototype={getElements:function(){return this.$elements},hide:function(){this.$elements.removeClass("pointerTransition"),this.$elements.css("opacity",0)},show:function(){this.$elements.addClass("pointerTransition"),this.$elements.css("opacity",.5)},updatePosition:function(e,t,n){if(Math.abs(n)<1)this.$elements.hide(),this.$horizontalLine1.css({width:e,top:t.top,right:t.right}).show();else{this.$elements.show();var o=.75*e;this.$horizontalLine1.css({width:o,top:t.top,right:t.left}),this.$horizontalLine2.css({width:e-o,top:t.top+n,right:t.left+o});var i=parseInt(this.$horizontalLine2.css("border-top-width"),10);this.$verticalLine.css({height:Math.abs(n),top:t.top+n+i,right:t.left+o})}}};var l=function(e,t){this.annotation=e,this.$element=$('<div class="annotLine">'),this.$element.attr("data-i18n","[title]notesPanel.annotLineDesc"),this.$element.data("i18n-options",{pageNumber:e.PageNumber,subject:e.Subject,author:e.Author}),this.$element.i18n(),this.$element.on("click",t)};l.prototype={getElement:function(){return this.$element},getAnnotation:function(){return this.annotation},hide:function(){this.getElement().hide()},show:function(){this.getElement().show()},update:function(e){this.getElement().css("top",e)},remove:function(){this.getElement().remove()}};var d={showListView:function(){return!1},getTop:function(e,t,n,o){return e.getAnnotationPosition(t.getAnnotation(),n).y-o},sort:function(e){return e.sort(function(e,t){return e.getTop()-t.getTop()})},filter:function(e){return e}},c={showListView:function(){return!0},getTop:function(){return 0},_getDateCreated:function(e){for(var t=e.getAnnotation().DateCreated,n=0;n<e._replies.length;++n){var o=e._replies[n].getAnnotation().DateCreated;o>t&&(t=o)}return t},sort:function(e){return e.sort(function(e,t){return c._getDateCreated(t)-c._getDateCreated(e)})},filter:function(e){return e}},h={_searchTerm:"",showListView:function(){return!0},getTop:function(){return f},sort:function(e){return e},setSearchTerm:function(e){h._searchTerm=e.toLowerCase()},_searchAnnot:function(e){var t=e.getText().toLowerCase(),n=t.indexOf(h._searchTerm)!==-1;return n?(e.highlightText(h._searchTerm),e.forceUncollapsed()):(e.highlightText(),e.unforceUncollapsed(),e.collapseContents()),n},filter:function(e,t){return e.filter(function(e){for(var n=h._searchAnnot(e),o=0;o<e._replies.length;++o)n=h._searchAnnot(e._replies[o])||n;return n||t(e),n})}},u=function(e,t,o,i){this.readerControl=e,this.docViewer=e.docViewer,this.setDefaults(),this.noteMargin=10,this.viewerOffset=i,this.$dummyScrollElement=$("<div>").css({position:"absolute",width:1,height:1}),this.$notesPanelWrapper=o,this.$notesPanel=o.find("#notesPanel"),this.$notesPanel.append(this.$dummyScrollElement),this.$notesBar=o.find("#notesBar"),this.annotLinesPadding=18,this.$annotLines=o.find("#annotLines"),this.$scrollView=t,this.$docpad=t.find("#docpad");var a=this;a.notesScrollingCount=0,a.scrollViewScrollingCount=0,this.$scrollView.on("scroll",function(){return a.notesScrollingCount?void--a.notesScrollingCount:(a.alignViews(),void(a.focusedAnnotation&&a.updateFocusConnector()))}),this.$notesPanel.on("scroll",function(){return a.scrollViewScrollingCount>0?void--a.scrollViewScrollingCount:(++a.notesScrollingCount,a.sortStrategy.showListView()||a.$scrollView.scrollTop(a.$notesPanel.scrollTop()),void(a.focusedAnnotation&&a.updateFocusConnector()))}),this.docViewer.on("displayModeUpdated",function(){if(null!==a.docViewer.getDocument()){var e=a.displayModeManager.getDisplayMode();n(function(){e.isContinuous()?(a._showAllNotes(),a.forAllLines(function(e){e.show()})):a.showAnnotLinesVisiblePages(),a.updatePositionsWithoutAnimations(),a.updateAllAnnotLines()})}}),this.focusConnector=new s,this.$scrollView.append(this.focusConnector.getElements()),this.hideFocusConnector()};u.prototype={setDefaults:function(){this.annotManager=this.docViewer.getAnnotationManager(),this.displayModeManager=this.docViewer.getDisplayModeManager(),this.notes={},this.annotLines={},this.waitingForRootAnnot={},this.focusedAnnotation=null,this.sortStrategy=d},setSortStrategy:function(e){this.sortStrategy=e,this.$notesPanel.scrollTop(0),this.trigger("sortStrategyChanged"),this.updateAllPositions()},getSortStrategy:function(){return this.sortStrategy},_createNote:function(e,t){var n,o,i,s=this,l=this.annotManager.canModify(e),d=!this.annotManager.getReadOnly();if(e.isReply()){o=new a(e,l,d),t||o.forceUncollapsed();var c=this.annotManager.getRootAnnotation(e);if(null===c)this._setupWaitingReplies(o);else{this._getOrCreateNote(c,t).addReply(o,t);var h=this._getNote(c);if(i=this.waitingForRootAnnot[e.Id])for(n=0;n<i.length;++n)h.addReply(i[n],t)}}else{if(o=new r(e,l,d),i=this.waitingForRootAnnot[e.Id]){for(n=0;n<i.length;++n)o.addReply(i[n],t);delete this.waitingForRootAnnot[e.Id]}this.appendNote(o),o.on("clicked",function(){s.annotManager.isAnnotationSelected(e)||s._jumpToAndSelectAnnotation(e),s.alignViews(),s.showFocusConnector(),s.updateFocusConnector()}),o.on("reply",function(e,t){s.annotManager.createAnnotationReply(o.getAnnotation(),t)})}return this.notes[e.Id]=o,o.on("update cancel save",function(){s.updateAllPositions()}),o.on("save",function(t,n){s.annotManager.setNoteContents(e,n),e instanceof Annotations.FreeTextAnnotation&&s.annotManager.drawAnnotationsFromList([e])}),o.on("delete",function(){e.isReply()?s.annotManager.deleteAnnotation(e):(s._deleteAnnotationReplies(e),o.isEmpty()?s.annotManager.deleteAnnotation(e):o.trigger("save",""))}),!t&&o instanceof r&&e instanceof Annotations.StickyAnnotation&&(this.editNote(e,!0),this.selectNote(e),this.focusAnnotation(e)),T.fireEvent("noteCreated",[o.getAnnotation(),o.getContainer()]),o},_setupWaitingReplies:function(e){var t=e.getAnnotation();this.waitingForRootAnnot[t.InReplyTo]||(this.waitingForRootAnnot[t.InReplyTo]=[]),this.waitingForRootAnnot[t.InReplyTo].push(e);var n=this.waitingForRootAnnot[t.Id];if(n){for(var o=this.waitingForRootAnnot[t.InReplyTo],i=0;i<n.length;++i)o.push(n[i]);delete this.waitingForRootAnnot[t.Id]}},_forAllNotes:function(e,t,n){var o;for(var i in this.notes){o=this.notes[i];var a=o instanceof r;a&&("undefined"==typeof n||n.indexOf(o.getAnnotation().PageNumber-1)!==-1?t&&o.getAnnotation().Hidden?t.call(this,o):e.call(this,o):t.call(this,o))}},_getNote:function(e){return this.notes[e.Id]},_getOrCreateNote:function(e,t){var n=this._getNote(e);return n||(n=this._createNote(e,t)),n},appendNote:function(e){this.$notesPanel.append(e.getElement())},_jumpToAndSelectAnnotation:function(e){this.annotManager.deselectAllAnnotations(),this.annotManager.jumpToAnnotation(e),this.annotManager.selectAnnotation(e)},getAnnotationPosition:function(e,t){var n=e.PageNumber-1;return t.pageToWindow(new Annotations.Point(e.X+e.Width,e.Y),n)},updateOrCreateLine:function(e,t,n){if(!e.isReply()){var o=this.getLine(e);if(!o){var i=this;o=new l(e,function(){i._jumpToAndSelectAnnotation(e)}),this.$annotLines.append(o.getElement()),this.annotLines[e.Id]=o,T.fireEvent("annotationLineCreated",[e,o.getElement()])}var a=this.getAnnotationPosition(e,this.displayModeManager.getDisplayMode()),r=a.y/t,s=n-2*this.annotLinesPadding,d=r*s+this.annotLinesPadding;o.update(d)}},getLine:function(e){return this.annotLines[e.Id]},removeLine:function(e){var t=this.getLine(e);t&&(t.remove(),delete this.annotLines[e.Id])},forAllLines:function(e,t,n){for(var o in this.annotLines){var i=this.annotLines[o];"undefined"==typeof n||n.indexOf(i.getAnnotation().PageNumber-1)!==-1?t&&i.getAnnotation().Hidden?t.call(this,i):e.call(this,i):t.call(this,i)}},updateAllAnnotLines:function(){var e=this.$scrollView[0].scrollHeight,t=this.$notesBar.height();for(var n in this.annotLines){var o=this.annotLines[n];this.updateOrCreateLine(o.getAnnotation(),e,t)}},showAnnotLinesVisiblePages:function(){var e=this.displayModeManager.getDisplayMode().getVisiblePages();this.forAllLines(function(e){e.show()},function(e){e.hide()},e)},hideAllAnnotLines:function(){this.$annotLines.hide()},showAllAnnotLines:function(){this.$annotLines.show()},updateNotes:function(e,t){for(var n,o,i=this.$scrollView[0].scrollHeight,a=this.$notesBar.height(),r=0;r<e.length;++r)n=e[r],n.Listable&&(o=this._getOrCreateNote(n,t),o.updateText(),this.updateOrCreateLine(n,i,a));this.updateAllPositions()},removeNotes:function(e,t){for(var n,o,i=0;i<e.length;++i)n=e[i],t||this._deleteAnnotationReplies(n),o=this._getNote(n),o&&(o.remove(),delete this.notes[n.Id]),this.removeLine(n);this.updateAllPositions()},_deleteAnnotationReplies:function(e){var t=[];for(t.push(e);t.length>0;){for(var n=t.pop(),o=n.getReplies(),i=0;i<o.length;++i)t.push(o[i]);n!==e&&this.annotManager.deleteAnnotation(n,!1,!0)}},startAddingReply:function(e){T.showNotesPanel(!0);var t=S._getNote(e);t instanceof r&&(this._checkShouldSwitchSortMode(t),t.startAddingReply())},selectNote:function(e){var t=this._getNote(e);t&&t.select(this.annotManager.canModify(e))},deselectNote:function(e){var t=this._getNote(e);t&&t.deselect(!0)},deselectAllNotes:function(){this._forAllNotes(function(e){e.deselect(!1)})},editNote:function(e,t){if(e.Listable&&(this.readerControl.showNotesPanel(!0),!this.annotManager.getReadOnly())){var n=this._getOrCreateNote(e);this.annotManager.canModify(e)?(this._checkShouldSwitchSortMode(n),n.isEditing()?n.focusInput():n.switchToEditingMode(t)):n.startAddingReply(),this.updateAllPositions()}},_checkShouldSwitchSortMode:function(e){this.getSortStrategy()!==h||e.isVisible()||this.setSortStrategy(d)},unhighlightAllNotes:function(){for(var e in this.notes)this.notes[e].updateText()},_showAllNotes:function(){this._forAllNotes(function(e){e.getElement().removeClass("noteHidden")})},_getSortedNotes:function(){function e(e){e.getElement().addClass("noteHidden")}var t,n=[],o=this.viewerOffset,i=this.displayModeManager.getDisplayMode();return i.isContinuous()||(t=i.getVisiblePages()),this._showAllNotes(),this._forAllNotes(function(e){if(e.isVisible()){var t=this.sortStrategy.getTop(this,e,i,o);e.setTop(t),e.updateTopPosition(),n.push(e)}},e,t),n=this.sortStrategy.filter(n,e),n.forEach(function(e){e.recalculateHeight()}),this.sortStrategy.sort(n)},updateBottomMargin:function(e){var t,n=this._getLastPageContainer().parent(),o=parseFloat(n.css("margin-bottom"))||this.docViewer.getMargin(),i=!1;if(this._notesPanelVisible()&&e.length>0){var a=e[e.length-1],r=a.getTop()+a.getHeight(),s=parseFloat(this.$docpad.css("margin-bottom")),l=this.$scrollView[0].scrollHeight-Math.max(0,o-s);r>l&&(t=s+r-l,i=!0)}i&&!this.sortStrategy.showListView()||(t=this.docViewer.getMargin()),n.css("margin-bottom",t),t!==this.lastBottomMargin&&(this.lastBottomMargin=t,this.updateAllAnnotLines())},updateAllPositions:function(){if(this._notesPanelVisible()){var e=this._getSortedNotes(),t=this.focusedAnnotation?this._getNote(this.focusedAnnotation):null;if(null!==t&&"undefined"!=typeof t&&t.isVisible())if(this.sortStrategy.showListView()){this._adjustPositions(e),this.hideFocusConnector();var n=this.$notesPanel.scrollTop(),o=this.$notesPanel.height(),i=t.getTop();(i<n||i>n+o)&&this.$notesPanel.scrollTop(i)}else{var a=e.indexOf(t);this._adjustPositions(e.slice(0,a)),this._adjustPositionsReverse(e.slice(0,a+1)),this._adjustPositions(e.slice(a))}else this._adjustPositions(e),this.hideFocusConnector();this.updateBottomMargin(e),this.sortStrategy.showListView()?this.$dummyScrollElement.css("top",0):this.$dummyScrollElement.css("top",this.$scrollView[0].scrollHeight),S.alignViews(),t&&t.isVisible()&&this._notesPanelVisible()&&(this.updateFocusConnector(),this.showFocusConnector())}},_adjustPositionsReverse:function(e){for(var t,n,o,i=e.length-1;i>=0;--i){if(t=e[i],i!==e.length-1){if(n=e[i+1],o=n.getTop()-t.getHeight()-this.noteMargin,!(o<t.getTop()))break;t.setTop(o)}t.updateTopPosition()}},_adjustPositions:function(e){for(var t,n,o,i=0;i<e.length;++i)t=e[i],0!==i&&(n=e[i-1],o=n.getTop()+n.getHeight()+this.noteMargin,o>t.getTop()&&t.setTop(o)),t.updateTopPosition()},_notesPanelVisible:function(){return!this.$notesPanelWrapper.hasClass("hidden")},showFocusConnector:function(){this.sortStrategy.showListView()||this.annotManager.getMarkupOff()||this.focusConnector.show()},hideFocusConnector:function(){this.focusConnector.hide()},updateFocusConnector:function(){var e=this.displayModeManager.getDisplayMode(),t=this._getNote(this.focusedAnnotation),n=this.getAnnotationPosition(t.getAnnotation(),e),o=parseFloat(this.$scrollView.position().left),i=this.$scrollView.scrollLeft(),a=5,r=t.getTop()+this.viewerOffset+a,s=parseFloat(t.getElement().css("margin-left"))+this.$notesBar.width(),l=n.y-(r-a),d=this.$scrollView.width()+i+o+s-n.x-5,c=r-this.$notesPanel.scrollTop(),h=this.$notesPanelWrapper.width()-s;this.focusConnector.updatePosition(d,{top:c,right:h},l)},focusAnnotation:function(e){if(this.focusedAnnotation&&this.unFocusAnnotation(),this.focusedAnnotation=e,e.Listable){var t=this._getNote(e);t.showReplyBox()}},unFocusAnnotation:function(){if(this.focusedAnnotation&&this.focusedAnnotation.Listable){var e=this._getNote(this.focusedAnnotation);e.removeAllDeleteConfirmations(),e.hideReplyBox()}this.focusedAnnotation=null,this.hideFocusConnector()},updatePositionsWithoutAnimations:function(){this._forAllNotes(function(e){e._disableAnimations()}),this.updateAllPositions();for(var e in this.notes){var t=this.notes[e].getElement();t[0].offsetHeight;break}this._forAllNotes(function(e){e._enableAnimations()})},_getLastPageContainer:function(){var e;return e=this.displayModeManager.getDisplayMode().isContinuous()?this.docViewer.getPageCount()-1:this.docViewer.getCurrentPage()-1,this.$scrollView.find("#pageContainer"+e)},getPanelAdjustment:function(){return this.sortStrategy.showListView()?0:this.$notesPanel.width()-this.$notesPanel[0].scrollWidth},alignViews:function(){if(!this.sortStrategy.showListView()){var e=this.$scrollView.scrollTop(),t=this.$notesPanel.scrollTop();e!==t&&(++this.scrollViewScrollingCount,this.$notesPanel.scrollTop(this.$scrollView.scrollTop()))}},dispose:function(){for(var e in this.notes)this.notes[e].remove();this.forAllLines(function(e){e.remove()})}},$.extend(u.prototype,window.utils.eventHandler);var f,g=$(document),p=$("#notesPanelWrapper"),w=p.find("#notesPanel"),v=p.find("#notesBar"),m=v.find(".toggleNotesButton"),C=$("#DocumentViewer");m.on("click",function(){T.showNotesPanel(!T.notesPanelVisible())});var y=200,b=300,A=!1;p.resizable({handles:"w",resize:function(){if(p.css("left",""),A)return void p.width(b);T.shiftSidePanel(!1),S.hideFocusConnector();var e=p.width();if(e<y)T.showNotesPanel(!1),p.width(b),A=!0;else{var t=S.getPanelAdjustment();w.width(e+t)}},stop:function(){P.scrollViewUpdated(),o(),A=!1}}),p.resizable("disable");var T,P,M,x,S;g.on("viewerLoaded",function(){T=window.readerControl,P=T.docViewer,x=P.getDisplayModeManager(),P.on("fitModeUpdated rotationUpdated",function(){n(function(){S&&S.updateAllPositions()})}),P.on("pageNumberUpdated",function(){var e=x.getDisplayMode();e.isContinuous()||n(function(){S.updatePositionsWithoutAnimations(),S.showAnnotLinesVisiblePages(),S.updateAllAnnotLines()})}),$("#noteTypeRadio").buttonset();var e=$("#noteOptions");$("#noteOptionsButton").on("click",function(){e.fadeIn("fast"),f=e.outerHeight()}),e.find("#documentSortButton").on("click",function(){S.setSortStrategy(d)}),e.find("#timeSortButton").on("click",function(){S.setSortStrategy(c)});var t=e.find("#commentSearchBox");t.on("keyup",_.debounce(function(){var e=t.val().toLowerCase();return""===e?void S.setSortStrategy(d):(h.setSearchTerm(e),void S.setSortStrategy(h))},300)),e.find("#toggleAnnotationsButton").on("click",function(){var e=T.docViewer.getAnnotationManager();e.toggleAnnotations()}),e.find("#saveAnnotationsButton").on("click",function(){S.deselectAllNotes(),T.saveAnnotations()}),e.find("#noteOptionsCloseButton").on("click",function(){S.getSortStrategy()===h&&S.setSortStrategy(d),e.fadeOut("fast")})}),g.on("documentLoaded",function(){if(o(),S)S.dispose(),S.setDefaults();else{var n=$("#control").height()+P.getMargin();S=new u(T,C,p,n),S.on("sortStrategyChanged",function(){o(),S.getSortStrategy()===h?$("#noteTypeRadio input").prop("checked",!1).button("refresh"):($("#commentSearchBox").val(""),S.unhighlightAllNotes(),S.getSortStrategy()===c?$("#noteTypeRadio #timeRadio").prop("checked",!0).button("refresh"):S.getSortStrategy()===d&&$("#noteTypeRadio #documentRadio").prop("checked",!0).button("refresh"))}),g.on("notesPanelBecomingVisible",function(){t()}),g.on("notesPanelVisibilityChanged",function(t,n){e(n),n?(S.alignViews(),o()):(S.updateBottomMargin(),S.hideFocusConnector())}),g.on("sidePanelVisibilityChanged",function(){S.updateAllPositions()})}M=P.getAnnotationManager(),M.disableDefaultStickyNotes();var i=$("#toggleAnnotationsButton");M.on("annotationToggled",function(e,t){t?(i.attr("data-i18n","annotations.buttonShow").i18n(),S.hideFocusConnector()):i.attr("data-i18n","annotations.buttonHide").i18n()}),M.on("annotationHidden",function(){S.updateAllPositions(),S.forAllLines(function(e){e.show()},function(e){e.hide()})}),M.on("annotationChanged",function(e,t,n){"add"===n||"modify"===n?S.updateNotes(t,e.imported):"delete"===n&&S.removeNotes(t,e.imported)}),M.on("annotationDoubleClicked",function(e,t){t instanceof Annotations.FreeTextAnnotation||!t.Listable||S.editNote(t)}),M.on("annotationSelected",function(e,t,n){if(null===t&&"deselected"===n)S.deselectAllNotes();else for(var o=0;o<t.length;++o){var i=t[o];"selected"===n?S.selectNote(i):S.deselectNote(i)}var a=M.getSelectedAnnotations();1===a.length?S.focusAnnotation(a[0]):S.unFocusAnnotation(),S.updateAllPositions()})}),g.on("startAddingReply",function(e,t){S.startAddingReply(t)}),$(window).on("resize",o),w.on("click",function(e){e.target===this&&M.deselectAllAnnotations()})}}),function(e){"use strict";var t=e.PDFTron.WebViewer.ToolMode;e.BaseReaderControl=function(n){var o=this;this.enableAnnotations=n.enableAnnot,this.enableOffline=n.enableOffline,this.docId=n.docId,this.hasBeenClosed=!1,this.serverUrl=n.serverUrl;var i=_.isUndefined(this.serverUrl)||_.isNull(this.serverUrl);if(!i||_.isUndefined(ReaderControl.config)||_.isUndefined(ReaderControl.config.serverURL)||(this.serverUrl=ReaderControl.config.serverURL),this.userPreferences=e.ControlUtils.userPreferences.getViewerPreferences(),this.currUser="",!_.isUndefined(ReaderControl.config)&&!_.isUndefined(ReaderControl.config.defaultUser)){if(this.currUser=ReaderControl.config.defaultUser,!_.isUndefined(ReaderControl.config.customStyle))if($.isArray(ReaderControl.config.customStyle))for(var a=0;a<ReaderControl.config.customStyle.length;a++)$("<link/>").appendTo("head").attr({rel:"stylesheet",type:"text/css",href:ReaderControl.config.customStyle[a]});else $("<link>").appendTo("head").attr({rel:"stylesheet",type:"text/css",href:ReaderControl.config.customStyle});_.isUndefined(ReaderControl.config.customScript)||$.getScript(ReaderControl.config.customScript,function(e,t,n){})}this.currUser=n.user||this.currUser,this.isAdmin=n.isAdmin,this.readOnly=n.readOnly,this.docViewer=new e.CoreControls.DocumentViewer,this.docViewer.setOptions({enableAnnotations:this.enableAnnotations}),this.pageOrientations={Auto:0,Portrait:1,Landscape:2};var r=e.Tools;this.toolModeMap={},this.toolModeMap[t.Pan]=new r.PanTool(this.docViewer),this.toolModeMap[t.PanAndAnnotationEdit]=new r.PanTool(this.docViewer),this.toolModeMap[t.TextSelect]=new r.TextSelectTool(this.docViewer),this.toolModeMap[t.AnnotationEdit]=new r.AnnotationEditTool(this.docViewer),this.toolModeMap[t.AnnotationCreateEllipse]=new r.EllipseCreateTool(this.docViewer),this.toolModeMap[t.AnnotationCreateFreeHand]=new r.FreeHandCreateTool(this.docViewer),this.toolModeMap.AnnotationCreateSignature=new r.SignatureCreateTool(this.docViewer),this.toolModeMap[t.AnnotationCreateLine]=new r.LineCreateTool(this.docViewer),this.toolModeMap.AnnotationCreateArrow=new r.ArrowCreateTool(this.docViewer),this.toolModeMap[t.AnnotationCreateRectangle]=new r.RectangleCreateTool(this.docViewer),this.toolModeMap[t.AnnotationCreateSticky]=new r.StickyCreateTool(this.docViewer),this.toolModeMap[t.AnnotationCreateTextHighlight]=new r.TextHighlightCreateTool(this.docViewer),this.toolModeMap[t.AnnotationCreateTextStrikeout]=new r.TextStrikeoutCreateTool(this.docViewer),this.toolModeMap[t.AnnotationCreateTextUnderline]=new r.TextUnderlineCreateTool(this.docViewer),
this.toolModeMap.AnnotationCreateTextSquiggly=new r.TextSquigglyCreateTool(this.docViewer),this.toolModeMap[t.AnnotationCreatePolyline]=new r.PolylineCreateTool(this.docViewer),this.toolModeMap[t.AnnotationCreatePolygon]=new r.PolygonCreateTool(this.docViewer),this.toolModeMap.AnnotationCreatePolygonCloud=new r.PolygonCloudCreateTool(this.docViewer),this.toolModeMap[t.AnnotationCreateCallout]=new r.CalloutCreateTool(this.docViewer),this.toolModeMap[t.AnnotationCreateFreeText]=new r.FreeTextCreateTool(this.docViewer),this.toolModeMap[t.AnnotationCreateCustom]=new r.AnnotationEditTool(this.docViewer);var s=e.ControlUtils.userPreferences;s.registerTool(this.toolModeMap[t.AnnotationCreateEllipse],"ellipse",Annotations.EllipseAnnotation),s.registerTool(this.toolModeMap[t.AnnotationCreateFreeHand],"freehand",Annotations.FreeHandAnnotation),s.registerTool(this.toolModeMap[t.AnnotationCreateLine],"line",Annotations.LineAnnotation,function(e){return"None"===e.getEndStyle()&&"None"===e.getStartStyle()}),s.registerTool(this.toolModeMap.AnnotationCreateArrow,"arrow",Annotations.LineAnnotation,function(e){return"OpenArrow"===e.getEndStyle()||"OpenArrow"===e.getStartStyle()}),s.registerTool(this.toolModeMap[t.AnnotationCreateRectangle],"rectangle",Annotations.RectangleAnnotation),s.registerTool(this.toolModeMap[t.AnnotationCreateSticky],"sticky",Annotations.StickyAnnotation),s.registerTool(this.toolModeMap[t.AnnotationCreatePolyline],"polyline",Annotations.PolylineAnnotation),s.registerTool(this.toolModeMap[t.AnnotationCreatePolygon],"polygon",Annotations.PolygonAnnotation,function(e){return"cloudy"!==e.Style||"PolygonCloud"!==e.Intent}),s.registerTool(this.toolModeMap.AnnotationCreatePolygonCloud,"polygoncloud",Annotations.PolygonAnnotation,function(e){return"cloudy"===e.Style&&"PolygonCloud"===e.Intent}),s.registerTool(this.toolModeMap[t.AnnotationCreateCallout],"callout",Annotations.FreeTextAnnotation,function(e){return e.getIntent()===Annotations.FreeTextAnnotation.Intent.FreeTextCallout}),s.registerTool(this.toolModeMap[t.AnnotationCreateFreeText],"freetext",Annotations.FreeTextAnnotation,function(e){return e.getIntent()!==Annotations.FreeTextAnnotation.Intent.FreeTextCallout}),s.registerTool(this.toolModeMap[t.AnnotationCreateTextHighlight],"highlight",Annotations.TextHighlightAnnotation),s.registerTool(this.toolModeMap[t.AnnotationCreateTextStrikeout],"strikeout",Annotations.TextStrikeoutAnnotation),s.registerTool(this.toolModeMap[t.AnnotationCreateTextUnderline],"underline",Annotations.TextUnderlineAnnotation),s.registerTool(this.toolModeMap.AnnotationCreateTextSquiggly,"squiggly",Annotations.TextSquigglyAnnotation),this.defaultToolMode=this.toolModeMap[t.Pan];var l=this.toolModeMap.AnnotationCreateSignature;l.on("annotationAdded",function(){o.setToolMode(t.Pan)}),this.docViewer.on("documentLoaded",_(this.onDocumentLoaded).bind(this)),this.docViewer.on("notify",e.ControlUtils.getNotifyFunction),this.enableAnnotations&&null!==o.serverUrl&&this.docViewer.setInternalAnnotationsTransform(function(e,t){var n={};null!==o.docId&&o.docId.length>0&&(n={did:o.docId}),$.ajax({url:o.serverUrl,cache:!1,data:n,success:function(n){t(_.isNull(n)||_.isUndefined(n)?e:n)},error:function(n,o,i){console.warn("Annotations could not be loaded from the server."),t(e)},dataType:"xml"})})};var n=function(){console.warn("Function not implemented by this viewer")};e.BaseReaderControl.prototype=$.extend(new e.WebViewerInterface,{onDocumentLoaded:function(){if(this.hasBeenClosed)return void this.closeDocument();var e=this.docViewer.getAnnotationManager();if(e.setCurrentUser(this.currUser),e.setIsAdminUser(this.isAdmin),e.setReadOnly(this.readOnly),this.enableOffline&&(Modernizr.indexeddb||Modernizr.websqldatabase))if(this.startOffline)this.offlineReady();else{var t=this;this.docViewer.getDocument().initOfflineDB(function(){t.offlineReady()})}},loadDocument:function(t,n){var o,i,a;n&&(o=n.streaming,i=n.decrypt,a=n.decryptOptions);var r=e.ControlUtils.getQueryStringMap(!window.utils.ieWebViewLocal),s=r.getString("p");this.startOffline=r.getBoolean("startOffline",!1);var l,d=r.getBoolean("azureWorkaround",!1);try{var c=e.CoreControls.PartRetrievers.CacheHinting;l=this.startOffline?new CoreControls.PartRetrievers.WebDBPartRetriever:e.utils.ieWebViewLocal?new e.CoreControls.PartRetrievers.WinRTPartRetriever(t,c.CACHE,i,a):t&&0===t.indexOf("iosrange://")?new e.CoreControls.PartRetrievers.IOSPartRetriever(t,c.CACHE,i,a):t&&0===t.indexOf("content://")?new e.CoreControls.PartRetrievers.AndroidContentPartRetriever(t,c.CACHE,i,a):null!==s?new e.CoreControls.PartRetrievers.ExternalHttpPartRetriever(t,s):o===!0?new e.CoreControls.PartRetrievers.StreamingPartRetriever(t,c.CACHE,i,a):d?new e.CoreControls.PartRetrievers.AzurePartRetriever(t,c.CACHE,i,a):new e.CoreControls.PartRetrievers.HttpPartRetriever(t,c.CACHE,i,a)}catch(h){console.error(h)}var u=this;n&&n.customHeaders&&l.setCustomHeaders(n.customHeaders),l.setErrorCallback(function(e){u.fireEvent("error",["xodLoad",e,i18n.t("error.load")])}),this.hasBeenClosed=!1,this.docViewer.loadAsync(l,this.docId)},offlineReady:function(){n()},fireEvent:function(e,t){$(document).trigger(e,t)},exportAnnotations:function(e){if(null===this.serverUrl)return void console.warn("Server URL not defined; not configured for server-side annotation saving.");e.start();var t="?did="+this.docId;null===this.docId&&(t="");var n=this.docViewer.getAnnotationManager().exportAnnotations();$.ajax({type:"POST",url:this.serverUrl+t,data:{data:n},success:e.success,error:function(t,n,o){console.warn("Failed to send annotations to server."),e.error()},complete:e.complete})},copyButtonHandler:function(){if(window.clipboardData)window.clipboardData.setData("Text",this.docViewer.getSelectedText());else{$("#clipboard").select();try{document.execCommand("copy")}catch(e){console.warn("copy is not supported by browser"),alert("error")}}},getPagesToPrint:function(e){var t=this.getPageCount(),n=(e+"").replace(/\s+/g,""),o=[];if(0===n.length){for(var i=1;i<=t;i++)o.push(i);return o}for(var a,r,s,l=n.split(","),d=0;d<l.length;d++)if(a=l[d].split("-"),1===a.length)o.push(parseInt(a[0],10));else if(2===a.length){if(r=parseInt(a[0],10),s=""===a[1]?t:parseInt(a[1],10),s<r)continue;for(var c=r;c<=s;c++)o.push(c)}return o.filter(function(e,n,o){return o.indexOf(e)===n&&e>0&&e<=t}).sort(function(e,t){return e-t})},prepareDocument:function(e,t,n,o){function i(){var c=e[d],h=a.docViewer.getDocument(),u=a.docViewer.getCompleteRotation(c)-a.docViewer.getRotation(c),f=h.getPageInfo(c-1),g=0,p=0;t===a.pageOrientations.Portrait?(g=u,f={width:f.height,height:f.width}):t===a.pageOrientations.Landscape?(p=1,g=(u+1)%4,0!==u&&(f={width:f.height,height:f.width})):t===a.pageOrientations.Auto&&f.width>f.height&&(0===u?(p=1,g=1):p=4-u);var w=a.printFactor;h.loadCanvasAsync(c-1,w,p,function(t){var h=t.getContext("2d"),u=window.GetPageMatrix(w,g,f);h.setTransform(u.m_a,u.m_b,u.m_c,u.m_d,u.m_h,u.m_v),a.docViewer.getAnnotationManager().drawAnnotations(c,t),s=t.toDataURL(),l=$("<img>").attr("src",s).css({"max-height":"100%","max-width":"100%"}).load(function(){a.preparingForPrint&&(r.append(l),a.fireEvent("printProgressChanged",[d+1,e.length]),d++,d<e.length?i():(o(r),window.utils.unsetCanvasMultiplier(),a.preparingForPrint=!1))}),n&&(l.css("display","block"),d>0&&l.css("page-break-after","always"))},function(){},1)}var a=this,r=n?$('<div style="height: 100%; display: block"></div>'):$("#print-display");CoreControls.SetCanvasMode(CoreControls.CanvasMode.PageCanvas),r.empty(),window.utils.setCanvasMultiplier(1);var s,l,d=0;a.fireEvent("printProgressChanged",[0,e.length]),i()},startPrintJob:function(e,t,n,o){if(!this.preparingForPrint){var i=this.getPagesToPrint(e);if(0===i.length)return void alert(i18n.t("print.invalidPageSelectionMsg"));this.preparingForPrint=!0,this.prepareDocument(i,t,n,o)}},endPrintJob:function(){this.preparingForPrint=!1,$("#print-display").empty()},getDocumentViewer:function(){return this.docViewer},getCurrentPageNumber:function(){return this.docViewer.getCurrentPage()},setCurrentPageNumber:function(e){this.docViewer.setCurrentPage(e)},getPageCount:function(){return this.docViewer.getPageCount()},goToFirstPage:function(){this.docViewer.displayFirstPage()},goToLastPage:function(){this.docViewer.displayLastPage()},goToNextPage:function(){var e=this.docViewer.getCurrentPage();e<=0||(e+=1,this.docViewer.setCurrentPage(e))},goToPrevPage:function(){var e=this.docViewer.getCurrentPage();e<=1||(e-=1,this.docViewer.setCurrentPage(e))},getZoomLevel:function(){return this.docViewer.getZoom()},setZoomLevel:function(e){this.docViewer.zoomTo(e)},getToolMode:function(){var e=this.docViewer.getToolMode();for(var t in this.toolModeMap)if(e===this.toolModeMap[t])return t;return null},setToolMode:function(e){var t=this.toolModeMap[e];t&&this.docViewer.setToolMode(t)},setAnnotationUser:function(e){var t=this.docViewer.getAnnotationManager();this.currUser=e,t.setCurrentUser(this.currUser)},getAnnotationUser:function(){var e=this.docViewer.getAnnotationManager();return e.getCurrentUser()},setAdminUser:function(e){var t=this.docViewer.getAnnotationManager();this.isAdmin=e,t.setIsAdminUser(this.isAdmin)},isAdminUser:function(){var e=this.docViewer.getAnnotationManager();return e.getIsAdminUser()},setReadOnly:function(e){var t=this.docViewer.getAnnotationManager();this.readOnly=e,t.setReadOnly(this.readOnly)},isReadOnly:function(){var e=this.docViewer.getAnnotationManager();return e.getReadOnly()},closeDocument:function(){this.hasBeenClosed=!0,this.docViewer.closeDocument()}})}(window),function(e){"use strict";e.ReaderControl=e.ReaderControl||{};var t=XODText,n=e.PDFTron.WebViewer.ToolMode;e.ReaderControl=function(t){e.BaseReaderControl.call(this,t);var o=this;this.eventsBound=!1,this.thumbContainerWidth=170,this.thumbContainerHeight=200,this.requestedThumbs={},this.lastRequestedThumbs=[],this.clickedThumb=-1,this.hasBeenClosed=!1,this.clickedSearchResult=-1,this.clickedBookMark=-1;var i=70,a=37,r=38,s=39,l=40,d=34,c=33,h=67,u=86,f=83,g=84,p=[187,61],w=[189,173];t.hideAnnotationPanel&&(ReaderControl.config.ui.hideAnnotationPanel=!0),t.pageHistory||($("#backPage").hide(),$("#forwardPage").hide()),this.initUI(),t.hideToolbar||setTimeout(function(){o.setToolbarVisibility(!0)},0);var v=this.toolModeMap[n.AnnotationCreateSticky];v.on("annotationAdded",function(e,t){o.setToolMode(n.AnnotationEdit)}),$(e).keydown(function(t){var v=t.metaKey||t.ctrlKey,m=o.docViewer.getCurrentPage(),C=e.utils.isEditableElement($(document.activeElement));C||(t.which===a?m>1&&(o.docViewer.setCurrentPage(m-1),o.trackPageHistory(m-1)):t.which===s?m<=o.docViewer.getPageCount()&&(o.docViewer.setCurrentPage(m+1),o.trackPageHistory(m+1)):t.which===r?(t.preventDefault(),y(-1,!1,!0)):t.which===l?(t.preventDefault(),y(1,!1,!0)):t.which===c?(t.preventDefault(),y(-1,!0,!0)):t.which===d&&(t.preventDefault(),y(1,!0,!0)));var b=o.docViewer.getAnnotationManager();if(v){if(t.which===i){if($("#control").is(":visible"))return document.getElementById("searchBox").focus(),!1}else _.contains(p,t.which)?(T(o.getZoomLevel()+.25),t.preventDefault()):_.contains(w,t.which)?(T(o.getZoomLevel()-.25),t.preventDefault()):C||(t.which===h&&o.enableAnnotations?b&&b.updateCopiedAnnotations():t.which===u&&o.enableAnnotations&&b&&b.pasteCopiedAnnotations());if(80===t.keyCode)return o.print(),!1}else t.altKey&&(t.which===f&&o.enableAnnotations?o.saveAnnotations():t.which===g&&o.enableAnnotations&&b&&(b.toggleAnnotations(),o.setToolMode(n.TextSelect)))});var m=$("#control").outerHeight(),C=$("#DocumentViewer");C.bind("mousewheel",function(e,t){if(e.ctrlKey||e.altKey){var n=o.sidePanelVisible()?$("#sidePanel").width():0;return t<0?o.docViewer.zoomToMouse(A(.8*o.getZoomLevel()),n,m):o.docViewer.zoomToMouse(A(1.25*o.getZoomLevel()),n,m),void e.preventDefault()}var i=o.docViewer.getDisplayModeManager().getDisplayMode();i.isContinuous()||(t<0?y(1):t>0&&y(-1))});var y=function(e,t,n){var i,a=C.scrollTop(),r=t?window.innerHeight-$("#control").outerHeight():30;if(e>0){var s=a+C.height()+1;s>=C[0].scrollHeight?(i=b(e),i>=0&&o.docViewer.setCurrentPage(i+1)):n&&C.scrollTop(a+r)}else Math.abs(a)<=1?(i=b(e),i>=0&&(o.docViewer.setCurrentPage(i+1),C.scrollTop(C[0].scrollHeight))):n&&C.scrollTop(a-r)},b=function(t){var n,i=o.docViewer.getDisplayModeManager().getDisplayMode(),a=i.mode===e.CoreControls.DisplayModes.Single?1:2;n=i.mode===e.CoreControls.DisplayModes.CoverFacing?Math.floor(o.docViewer.getCurrentPage()/a):Math.floor((o.docViewer.getCurrentPage()-1)/a),n+=t;var r=n*a;return i.mode===e.CoreControls.DisplayModes.CoverFacing?0===r?0:r<o.docViewer.getPageCount()+1?r-1:-1:r<o.docViewer.getPageCount()?r:-1},A=function(e){return e<=o.MIN_ZOOM?e=o.MIN_ZOOM:e>o.MAX_ZOOM&&(e=o.MAX_ZOOM),e},T=function(e){o.setZoomLevel(A(e))};this.$thumbnailViewContainer=$("#thumbnailView"),this.$thumbnailViewContainer.scroll(function(){clearTimeout(o.thumbnailRenderTimeout),o.thumbnailRenderTimeout=setTimeout(function(){o.docViewer.getRenderingPipeline().hasPipeline("ReaderControl.updateThumbnails")&&o.docViewer.getRenderingPipeline().pushChange("ReaderControl.updateThumbnails",{type:"updateThumbnails"})},80)}),$("#lastPage").bind("click",function(){o.docViewer.displayLastPage()}),$("#zoomBox").keyup(function(e){if(13===e.which){var t=this.value,n=parseInt(t,10);if(isNaN(n))alert("'"+t+"' is not a valid zoom level.");else{var o=n/100;T(o)}}}),$("#zoomOut").click(function(){var e=o.getZoomLevel();e>1&&e-.25<1?e=1:e-=.25,T(e)}),$("#zoomIn").click(function(){var e=o.getZoomLevel();e<1&&e+.25>1?e=1:e+=.25,T(e)}),o.docViewer.on("zoomUpdated",function(e,t){var n=Math.round(100*t);$("#zoomBox").val(n+"%"),$("#slider").slider("value")!==n&&$("#slider").slider({value:n}),o.fireEvent("zoomChanged",[t])}),o.resize(),$(window).resize(function(e){e&&e.target!==window||(o.resize(),(o.sidePanelVisible()||o.notesPanelVisible())&&o.shiftSidePanel(),$("#thumbnailView").trigger("scroll"))}),$("#slider").slider({slide:function(e,t){var n=parseInt(t.value,10);isNaN(n)?alert("'"+n+"' is not a valid zoom level."):(clearTimeout(o.zoomSliderTimeout),o.zoomSliderTimeout=setTimeout(function(){T(n/100)},50))}}),$("#pageNumberBox").keyup(function(e){if(13===e.which){var t=this.value,n=parseInt(t,10);isNaN(n)||n>o.docViewer.getPageCount()||n<=0?$("#pageNumberBox").val(o.docViewer.getCurrentPage()):(o.docViewer.setCurrentPage(n),o.trackPageHistory(n))}}),o.docViewer.on("beforeDocumentLoaded",function(){o.docViewer.getPageCount()>=1e3&&o.setLayoutMode(e.CoreControls.DisplayModes.Single)}),o.docViewer.on("layoutChanged",function(e,t){$("#totalPages").text("/"+o.docViewer.getPageCount()),o.docViewer.getRenderingPipeline().pushChange("ReaderControl.updateThumbnails",{type:"applyPageChangesToThumbnails",changes:t}),o.docViewer.getRenderingPipeline().pushChange("ReaderControl.updateThumbnails",{type:"updateThumbnails"})}),o.docViewer.on("bookmarksUpdated",function(){o.updateBookmarkView()}),o.docViewer.on("toolModeUpdated",function(e,t,n){o.fireEvent("toolModeChanged",[t,n])}),o.docViewer.on("pageNumberUpdated",function(e,t){$("#pageNumberBox").val(t);var n=t-1;o.clickedThumb!==-1&&$("#thumbContainer"+o.clickedThumb).removeClass("ui-state-active");var i=$("#thumbContainer"+n);if("undefined"!=typeof o.thumbnailsElement){var a=o.thumbnailsElement.scrollTop,r=o.thumbnailsElement.offsetHeight,s=o.thumbnailsElement.offsetWidth-$.position.scrollbarWidth(),l=a+r,d=i.outerHeight(!0),c=i.outerWidth(!0),h=Math.floor(s/c),u=Math.floor(n/h)*d,f=u+d;u<a?o.thumbnailsElement.scrollTop=u:f>l&&(o.thumbnailsElement.scrollTop=u+d-r)}o.clickedThumb=n,i.addClass("ui-state-active"),o.fireEvent("pageChanged",[t])}),$("#layoutModeDropDown .content").on("click","li",function(){var e=$(this).data("layout-mode");e&&o.setLayoutMode(e)}),$("#rotateGroup").on("click","[data-rotate]",function(){var e=$(this).data("rotate");"cc"===e?o.rotateClockwise():"ccw"===e&&o.rotateCounterClockwise()});var P=new Drop({target:document.querySelector("#layoutModeDropDown .drop-target"),content:document.querySelector("#layoutModeDropDown .content"),position:"bottom center",openOn:"hover",classes:"drop-theme-arrows-bounce layout-mode-dropdown-content",tetherOptions:{targetOffset:"10px 0"}});P.once("open",function(){o.docViewer.trigger("displayModeUpdated");var e=$(this.drop);e.i18n(),e.css("z-index",50)}),P.on("close",function(){$(this.drop).css({left:-1e3,top:-1e3,transform:""})}),$("#fitWidth").on("click",function(){o.docViewer.setFitMode(o.docViewer.FitMode.FitWidth)}),$("#fitPage").on("click",function(){o.docViewer.setFitMode(o.docViewer.FitMode.FitPage)}),$("#fullScreenButton").on("click",function(){var e=document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement;if(e)document.exitFullscreen?document.exitFullscreen():document.msExitFullscreen?document.msExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen();else{var t=document.documentElement;t.requestFullscreen?t.requestFullscreen():t.msRequestFullscreen?t.msRequestFullscreen():t.mozRequestFullScreen?t.mozRequestFullScreen():t.webkitRequestFullScreen&&(t.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT),setTimeout(function(){document.webkitCurrentFullScreenElement||t.webkitRequestFullScreen()},200))}}),o.docViewer.on("textSelected",function(){var e=o.docViewer.getSelectedText(),t=$("#clipboard"),n=t.get(0);n.value=e,e.length>0?(t.show(),n.focus(),n.selectionStart=0,n.setSelectionRange(0,n.value.length)):t.hide()}),o.docViewer.on("displayModeUpdated",function(){var e=o.docViewer.getDisplayModeManager().getDisplayMode();$(".layout-mode-dropdown-content #layoutModes [data-layout-mode]").removeClass("active");var t=$(".layout-mode-dropdown-content #layoutModes [data-layout-mode="+e.mode+"]");t.addClass("active"),o.fireEvent("layoutModeChanged",[e])}),o.docViewer.on("fitModeUpdated",function(e,t){var n=$("#fitWidth"),i=$("#fitPage");t===o.docViewer.FitMode.FitWidth?(n.addClass("active"),i.removeClass("active")):t===o.docViewer.FitMode.FitPage?(n.removeClass("active"),i.addClass("active")):(n.removeClass("active"),i.removeClass("active")),o.fireEvent("fitModeChanged",[t])}),o.docViewer.on("pageComplete",function(e,t){o.fireEvent("pageCompleted",[t+1])}),o.docViewer.on("beginRendering",function(){o.beginRendering()}),o.docViewer.on("finishedRendering",function(){o.finishedRendering()}),$(document).on("error",function(e,t,n){o.onError(e,t,n)})},e.ReaderControl.prototype={MAX_ZOOM:5,MIN_ZOOM:.05,printFactor:1,MIN_SIDE_PANEL_WIDTH:195,DEFAULT_SIDE_PANEL_WIDTH:200,initUI:function(){var e=this;$("#toggleSidePanel").on("click",function(){e.setShowSideWindow(!e.sidePanelVisible())}),$("#toggleNotesPanel").on("click",function(){e.showNotesPanel(!e.notesPanelVisible())}),$("#slider").slider({min:100*e.MIN_ZOOM,max:100*e.MAX_ZOOM,value:100,animate:!0}),$("#optionsMenuList").hide().menu(),context.init({compress:!0}),$.widget("ui.tabs",$.ui.tabs,{updateHeight:function(e){"undefined"==typeof e&&(e=$("#tabs .ui-tabs-panel"));var t=$("#ui-display").height(),n=0;$("#tabs").children(":visible:not(.ui-tabs-panel)").each(function(){n+=$(this).outerHeight(!0)});var o=4,i=t-n-o;e.each(function(){var e=$(this),t=e.find(".tab-panel-stretch").css("height","100%");if(!e.is(":visible"))return void e.css("height",window.innerHeight);var n=e.innerHeight()-e.height();e.css("height",i-n),t.each(function(){var e=$(this),t=0;if(e.is(":visible")){e.css("visibility","visible"),e.children(".tab-panel-item-fixed").each(function(){t+=$(this).outerHeight(!0)});var n=e.innerHeight();e.children(".tab-panel-item-stretch").height(n-t)}})}),this._trigger("afterUpdateHeight")}});var t=$("#tabs");t.tabs({cache:!0,show:{effect:"fade",duration:250},beforeActivate:function(e,t){t.oldTab.find("span").removeClass("active"),t.newTab.find("span").addClass("active")},activate:function(e,n){var o=$(n.newPanel);t.tabs("updateHeight",o),o.find("#searchView").length>0&&o.find("#fullSearchBox").focus()},afterUpdateHeight:function(){$("#thumbnailView").is(":visible")&&$("#thumbnailView").trigger("scroll")},create:function(e,t){var n=setInterval(function(){var e=0;$("#tabs").children(":visible:not(.ui-tabs-panel)").each(function(){e+=$(this).outerHeight(!0)});var o=$("#tabs").is(":visible");o&&($("#tabs").tabs("updateHeight",t.panel),clearInterval(n))},500)}}),(!this.enableAnnotations||ReaderControl.config.ui.hideAnnotationPanel||ReaderControl.config.ui.hideSidePanel)&&($("#toggleNotesPanel").parent().hide(),$("#notesPanelWrapper").hide()),Modernizr.fullscreen||$("#fullScreenButton").hide(),ReaderControl.config.ui.hidePrint&&$("#printButton").hide(),ReaderControl.config.ui.hideControlBar||(ReaderControl.config.ui.hideDisplayModes&&$("#layoutModeDropDown").parent().hide(),ReaderControl.config.ui.hideTextSearch&&$("#searchControl").parent().hide(),ReaderControl.config.ui.hideZoom&&$("#zoomBox").parent().hide());var n=!1,o=$("#sidePanel");o.hide(),o.resizable({handles:"e",resize:function(){return n?void o.width(e.DEFAULT_SIDE_PANEL_WIDTH):(e.shiftSidePanel(!1),void(o.width()<e.MIN_SIDE_PANEL_WIDTH&&(e.setShowSideWindow(!1,!1),o.width(e.DEFAULT_SIDE_PANEL_WIDTH),n=!0)))},stop:function(){e.docViewer.scrollViewUpdated(),n=!1}}),ReaderControl.config.ui.hideSidePanel&&(document.getElementById("toggleSidePanel").style.visibility="hidden"),$.extend({alert:function(e,t){$(document.createElement("div")).html(e).dialog({close:function(){$(this).remove()},dialogClass:"alert",title:t,modal:!0,resizable:!1})}})},onError:function(e,t,n){var o=$("<div>").attr({id:"passwordDialog"});$("<label>").attr({"for":"passwordInput"}).text(n).appendTo(o),o.dialog({modal:!0,resizable:!1,closeOnEscape:!1,buttons:{OK:function(){$(this).dialog("close")}}})},setContextMenu:function(e){function t(e){function t(e,t){i.push({text:e,action:function(e){e.preventDefault(),o.docViewer.setToolMode(t)}})}for(var n in e)t(n,e[n])}var o=this;context.settings({click:!1,right:!1,minWidth:!0});var i=[{header:"contextMenu.changeToolHeader"}];t({"contextMenu.pan":this.toolModeMap[n.Pan],"contextMenu.textSelect":this.toolModeMap[n.TextSelect]}),this.enableAnnotations&&!e&&t({"contextMenu.highlight":this.toolModeMap[n.AnnotationCreateTextHighlight],"contextMenu.underline":this.toolModeMap[n.AnnotationCreateTextUnderline],"contextMenu.freeHand":this.toolModeMap[n.AnnotationCreateFreeHand],"contextMenu.freeText":this.toolModeMap[n.AnnotationCreateFreeText],"contextMenu.arrow":this.toolModeMap.AnnotationCreateArrow,"contextMenu.note":this.toolModeMap[n.AnnotationCreateSticky],"contextMenu.signature":this.toolModeMap.AnnotationCreateSignature}),context.attach("#DocumentViewer",i),context.getElement().i18n()},getViewerHeight:function(){var e=window.innerHeight,t=$("#control");return t.is(":visible")&&(e-=t.outerHeight()),e},resize:function(){var e=$(document.getElementById("DocumentViewer")),t=this.getViewerHeight();e.height(t),$("#tabs").tabs("updateHeight");var n=$("#sidePanel"),o=window.innerWidth-$("#control .right-aligned").width()-45,i=Math.max(Math.min(o,.45*window.innerWidth),this.MIN_SIDE_PANEL_WIDTH);n.resizable("option","maxWidth",i),n.width()>i&&n.width(i)},onDocumentLoaded:function(){if(this.hasBeenClosed)return void this.closeDocument();e.BaseReaderControl.prototype.onDocumentLoaded.call(this);var t=this,n=t.eventsBound;t.clearSidePanelData(),t.resize(),n||ReaderControl.config.ui.hideSidePanel||t.setShowSideWindow(this.userPreferences.showSideWindow,!1),t.initBookmarkView(),t.initThumbnailView(),t.initSearchView(),t.setInterfaceDefaults(),n||(t.eventsBound=!0,t.bindEvents(),this.setContextMenu(this.readOnly)),this.pageHistory=[this.docViewer.getCurrentPage()],this.pageHistoryTracker=0,$("#forwardPage").removeClass("back-forward-enabled").addClass("back-forward-disabled"),$("#backPage").removeClass("back-forward-enabled").addClass("back-forward-disabled");var o=e.Actions.GoTo.prototype.onTriggered;e.Actions.GoTo.prototype.onTriggered=function(){o.apply(this,arguments),t.trackPageHistory(this.dest.page)};var i=e.Actions.Named.prototype.onTriggered;e.Actions.Named.prototype.onTriggered=function(){switch(i.apply(this,arguments),this.action){case"NextPage":t.trackPageHistory(t.docViewer.getCurrentPage()+1);break;case"PrevPage":t.trackPageHistory(t.docViewer.getCurrentPage()-1);break;case"FirstPage":t.trackPageHistory(1);break;case"LastPage":t.trackPageHistory(t.docViewer.getPageCount())}};var a=t.docViewer.getAnnotationManager();a.on("annotationPopupStateChanged",function(e,t,n,o){o&&setTimeout(function(){var e=n.find(".popup-comment");e.flexible()},0)}),a.on("annotationPopupCreated",function(e,t,n,o){t.isReply()&&o.flexible()}),a.on("annotationPopupDeleted",function(e,t,n,o){o.flexible("remove")}),Annotations.ControlHandle.selectionAccuracyPadding=3,Annotations.SelectionAlgorithm.canvasVisibilityPadding=10,t.fireEvent("documentLoaded")},offlineReady:function(){function e(e){var t=$("#toggleOfflineButton");e?(t.attr("data-i18n","[title]offline.disableOffline").i18n(),t.addClass("active")):(t.attr("data-i18n","[title]offline.enableOffline").i18n(),t.removeClass("active"))}var t=$("<div>").addClass("group");$("#control .right-aligned").prepend(t),$("<span>").attr({id:"offlineDownloadButton","class":"glyphicons download","data-i18n":"[title]offline.downloadOfflineViewing"}).data("downloading",!1).appendTo(t).i18n(),$("<span>").attr({id:"toggleOfflineButton","class":"glyphicons cloud_minus","data-i18n":"[title]offline.enableOffline"}).appendTo(t).i18n();var n=this.docViewer.getDocument();$("#offlineDownloadButton").click(function(){var e=$(this),t=e.data("downloading");t?(e.data("downloading",!1),n.cancelOfflineModeDownload()):(e.data("downloading",!0),n.storeOffline(function(){e.data("downloading",!1),e.removeClass("circle_remove").addClass("download"),n.isDownloaded()&&$("#toggleOfflineButton").removeClass("disabled"),e.attr("data-i18n","[title]offline.downloadOfflineViewing").i18n()}),e.removeClass("download").addClass("circle_remove"),e.attr("data-i18n","[title]offline.cancelDownload").i18n())}),$("#toggleOfflineButton").click(function(){if($(this).hasClass("disabled"))return!1;var t=!n.getOfflineModeEnabled();n.setOfflineModeEnabled(t),e(t)}),n.getOfflineModeEnabled()&&e(!0),n.isDownloaded()||$("#toggleOfflineButton").addClass("disabled")},updateAnnotations:function(){if(null===this.serverUrl)return void console.warn("Server URL was not specified.");var e=this.docViewer.getAnnotationManager(),t=this.serverUrl;null!==this.docId&&(t+="?did="+this.docId);var n=e.getAnnotCommand();$.ajax({type:"POST",url:t,data:{data:n},contentType:"xml",success:function(e){},error:function(e,t,n){},dataType:"xml"})},saveAnnotations:function(){var e=this;return new Promise(function(t,n){var o;e.exportAnnotations({start:function(){o=$("#overlayMessage"),o.attr("data-i18n","annotations.savingAnnotations"),o.i18n(),o.dialog({dialogClass:"no-title",draggable:!1,resizable:!1,minHeight:50,minWidth:window.innerWidth/3,show:{effect:"fade",duration:400},hide:{effect:"fade",duration:1e3}})},success:function(e){o.attr("data-i18n","annotations.saveSuccess"),o.i18n(),t()},error:function(e,t,i){console.warn("Failed to send annotations to server."),o.attr("data-i18n","annotations.saveError"),o.i18n(),n()},complete:function(){setTimeout(function(){o.dialog("close")},1e3)}})})},initBookmarkView:function(){this.updateBookmarkView()},updateBookmarkView:function(){function e(n,o,i){for(var a=0;a<n.length;a++){var r=document.createElement("span");r.id="bookmark"+i,r.innerHTML=n[a].getName();var s;n[a].getChildren().length>0?(s=$('<li class="closed"></li>'),r.className="Node"):(s=$("<li></li>"),r.className="Leaf");var l=$(r),d=$("<div class='bookmarkWrapper' id=bookmarkWrapper"+i+"></div>");if(s.append(d.append(l)),d.data("data",{bookmark:n[a],id:i++}).click(function(){var e=$(this).data("data").bookmark;e.isValid()&&(t.clickedBookmark!==-1&&($("#bookmarkWrapper"+t.clickedBookmark).removeClass("ui-state-active"),t.clickedBookmark=-1),t.clickedBookmark=$(this).data("data").id,$(this).addClass("ui-state-active"),t.docViewer.displayBookmark(e),t.trackPageHistory(e.pageNumber))}),o.append(s),n[a].getChildren().length>0){var c=$("<ul></ul>");s.append(c),i=e(n[a].getChildren(),c,i)}}return 0===a&&($("#bookmarkView").append('<div style="padding:5px 3px;" data-i18n="sidepanel.outlineTab.noOutlines"></div>'),$("#bookmarkView").i18n()),i}var t=this,n=this.docViewer.getDocument();n.getBookmarks().then(function(n){$("#bookmarkView").empty(),$("#bookmarkView").off("mouseenter").on("mouseenter","div.bookmarkWrapper",function(){$(t).addClass("ui-state-hover")}).off("mouseleave").on("mouseleave","div.bookmarkWrapper",function(){$(t).removeClass("ui-state-hover")}),e(n,$("#bookmarkView"),0),$("#bookmarkView").treeview()},function(e){console.warn("Error retrieving bookmarks",e)})},initThumbnailView:function(){var e=this;e.requestedThumbs={},e.lastRequestedThumbs=[],e.thumbNailPages=0,e.haveThumbs={},$("#thumbnailView").off("mouseenter").on("mouseenter","div.ui-widget-content",function(){$(this).addClass("ui-state-hover")}).off("mouseleave").on("mouseleave","div.ui-widget-content",function(){$(this).removeClass("ui-state-hover")}),e.docViewer.getRenderingPipeline().registerHandlers("ReaderControl.updateThumbnails",{read:function(t){var n=e.getVisibleThumbs();return{visibleThumbs:n}},write:function(t,n){n.forEach(function(n){"appendThumb"===n.type?e.haveThumbs[n.pageIndex]&&e.receivedThumb(n.thumb,n.pageIndex):"updateThumbnails"===n.type?(e.updateThumbnailPages(),e.updateThumbnailView(t.visibleThumbs)):"applyPageChangesToThumbnails"===n.type&&e.applyPageChangesToThumbnails(n.changes)})}}),this.thumbnailsElement=this.$thumbnailViewContainer.get(0),this.docViewer.getRenderingPipeline().pushChange("ReaderControl.updateThumbnails",{type:"updateThumbnails"})},createThumbnailContainer:function(e){var t=this,n=document.createElement("div");n.id="thumbContainer"+e,n.style.height=t.thumbContainerHeight+"px",n.style.width=t.thumbContainerWidth+"px",n.className="thumbContainer ui-widget-content";var o=document.createElement("div");o.className="thumbdiv";var i=document.createElement("span");i.style.height="150px",i.style.display="block",o.appendChild(i),n.appendChild(o);var a=document.createElement("div");return a.style.textAlign="center",a.innerHTML=e+1,n.appendChild(a),n.addEventListener("click",function(){var n=$(this);t.clickedThumb!==-1&&$("#thumbContainer"+t.clickedThumb).removeClass("ui-state-active"),t.clickedThumb=e,n.addClass("ui-state-active"),setTimeout(function(){t.docViewer.setCurrentPage(e+1),t.trackPageHistory(e+1)},0)}),n},invalidateThumbnail:function(e){e in this.requestedThumbs&&(this.cancelThumbnail(this.requestedThumbs[e]),delete this.requestedThumbs[e]),delete this.haveThumbs[e],$("#thumbContainer"+e).find(".thumb").remove()},applyPageChangesToThumbnails:function(e){var t=this;e.removed.forEach(function(e){t.invalidateThumbnail(e-1)}),e.contentChanged.forEach(function(e){t.invalidateThumbnail(e-1)}),Object.keys(e.moved).forEach(function(e){t.invalidateThumbnail(e-1)})},updateThumbnailPages:function(){var e=this.docViewer.getPageCount();if(this.thumbNailPages<e){for(var t=document.createDocumentFragment(),n=this.thumbNailPages;n<e;++n)t.appendChild(this.createThumbnailContainer(n));this.thumbnailsElement.appendChild(t)}else if(this.thumbNailPages>e){var o=document.createRange();o.setStartBefore(this.thumbnailsElement.children[e]),o.setEndAfter(this.thumbnailsElement.children[this.thumbNailPages-1]),o.deleteContents()}this.thumbNailPages=e},initSearchView:function(){$("#fullSearchView").off("mouseenter").on("mouseenter","div.searchResultLine",function(){$(this).addClass("ui-state-hover")}).off("mouseleave").on("mouseleave","div.searchResultLine",function(){$(this).removeClass("ui-state-hover")})},beginRendering:function(){for(var e in this.requestedThumbs)this.cancelThumbnail(this.requestedThumbs[e]);
for(var t=this.lastRequestedThumbs.length,n=0;n<t;++n)delete this.requestedThumbs[this.lastRequestedThumbs[n]];this.requestedThumbs={},this.lastRequestedThumbs=[],this.viewerRendering=!0},finishedRendering:function(){this.viewerRendering=!1,this.docViewer.getRenderingPipeline().hasPipeline("ReaderControl.updateThumbnails")&&this.docViewer.getRenderingPipeline().pushChange("ReaderControl.updateThumbnails",{type:"updateThumbnails"})},cancelThumbnail:function(e){this.docViewer.getDocument().cancelLoadThumbnail(e)},updateThumbnailView:function(e){var t=this;e=e||t.getVisibleThumbs();for(var n,o=0;o<t.lastRequestedThumbs.length;o++)n=t.lastRequestedThumbs[o],t.requestedThumbs[n]&&!_.contains(e,n)&&(t.cancelThumbnail(t.requestedThumbs[n]),delete t.requestedThumbs[n]);t.lastRequestedThumbs=e,t.appendThumbs(e)},receivedThumb:function(e,t){var n=this;delete n.requestedThumbs[t];var o,i,a;e.width>e.height?(a=e.width/150,i=Math.round(e.height/a),o=150):(a=e.height/150,o=Math.round(e.width/a),i=150),e.style.width=o+"px",e.style.height=i+"px",e.className="thumb";var r=$("#thumbContainer"+t);r.find(".thumbdiv").empty().append(e);var s=document.createElement("div");s.className="thumbPad";var l=n.thumbContainerHeight-i,d=parseInt(l/2,10);s.style.marginBottom=d+"px",r.prepend(s)},appendThumbs:function(e){var t=this;if(!t.viewerRendering)for(var n=this.docViewer.getDocument(),o=0;o<e.length;o++)!function(){var i=e[o];if(!(t.requestedThumbs[i]||$("#thumbContainer"+i).find(".thumb").length>0)){var a=n.loadThumbnailAsync(i,function(e){t.haveThumbs[i]=!0,delete t.requestedThumbs[i],t.docViewer.getRenderingPipeline().pushChange("ReaderControl.updateThumbnails",{type:"appendThumb",thumb:e,pageIndex:i})});t.requestedThumbs[i]=a}}()},getVisibleThumbs:function(){if(null===this.docViewer.getDocument())return[];var e=[],t=this.thumbnailsElement.offsetHeight,n=this.thumbnailsElement.offsetWidth-$.position.scrollbarWidth(),o=this.$thumbnailViewContainer.find("#thumbContainer0").outerHeight(!0),i=this.$thumbnailViewContainer.find("#thumbContainer0").outerWidth(!0);if("undefined"==typeof this.thumbnailsElement)return e;var a=this.thumbnailsElement.scrollTop,r=a+t,s=Math.floor(n/i),l=n>0&&0===s;l&&(s=1);var d=Math.floor(a/o*s),c=Math.ceil(r/o*s)-1,h=c-d+1,u=d-h;u<0&&(u=0);var f=this.docViewer.getPageCount(),g=c+h;g>=f&&(g=f-1);for(var p=u;p<=g;p++)e.push(p);return e},sidePanelVisible:function(){return!!this._showSideWindow},shiftSidePanel:function(e){"undefined"==typeof e&&(e=!0);var t=$("#DocumentViewer"),n=$("#notesPanelWrapper"),o="none"===n.css("display"),i=this.sidePanelVisible()?$("#sidePanel").width():0,a=o?0:n.width();e?($(".right-content").animate({"margin-left":i},150),t.animate({"margin-right":a},150)):($(".right-content").css({"margin-left":i}),t.css({"margin-right":a}))},clearSidePanelData:function(){$("#fullSearchView").empty(),$("#bookmarkView").empty(),$("#thumbnailView").empty()},searchText:function(e,t){var n=this;""!==e&&(t=t|n.docViewer.SearchMode.e_page_stop|n.docViewer.SearchMode.e_highlight,n.docViewer.textSearchInit(e,t,!1))},fullTextSearch:function(e){var n=[];$("#fullSearchView").empty();var o=this,i=0;if(""!==e){var a=o.docViewer.SearchMode.e_page_stop|o.docViewer.SearchMode.e_ambient_string|o.docViewer.SearchMode.e_highlight;$("#wholeWordSearch").prop("checked")&&(a|=o.docViewer.SearchMode.e_whole_word),$("#caseSensitiveSearch").prop("checked")&&(a|=o.docViewer.SearchMode.e_case_sensitive),o.docViewer.textSearchInit(e,a,!0,function(e){if(e.resultCode===t.ResultCode.e_found){n.push(e.page_num);var a=$('<div id="searchResultLine'+i+'">').addClass("searchResultLine ui-widget-content");$("<span>").text(e.ambient_str.slice(0,e.result_str_start)).appendTo(a),$("<b>").text(e.ambient_str.slice(e.result_str_start,e.result_str_end)).appendTo(a),$("<span>").text(e.ambient_str.slice(e.result_str_end,e.ambient_str.length)).appendTo(a),a.data("data",{result:e,quads:e.quads,searchResultLineId:i++}).click(function(){o.clickedSearchResult!==-1&&($("#searchResultLine"+o.clickedSearchResult).removeClass("ui-state-active"),o.clickedSearchResult=-1),o.clickedSearchResult=$(this).data("data").searchResultLineId,$(this).addClass("ui-state-active"),o.docViewer.displaySearchResult($(this).data("data").result)}).appendTo($("#fullSearchView")),1===i&&a.click()}else if(e.resultCode===t.ResultCode.e_done){var r=$("#fullSearchView");r.is(":empty")&&(r.append("<div data-i18n='sidepanel.searchTab.noResults'></div>"),r.i18n())}})}},trackPageHistory:function(e){var t=this;t.pageHistoryTracker+1<t.pageHistory.length&&(t.pageHistory=t.pageHistory.slice(0,t.pageHistoryTracker+1)),t.pageHistory[t.pageHistory.length-1]!==e&&(t.pageHistoryTracker+=1,t.pageHistory.push(e),$("#backPage").addClass("back-forward-enabled").removeClass("back-forward-disabled"),$("#forwardPage").addClass("back-forward-disabled").removeClass("back-forward-enabled"))},bindEvents:function(){var e=this;$("#backPage").on("click",function(){e.pageHistoryTracker>0&&(e.pageHistoryTracker-=1,e.docViewer.setCurrentPage(e.pageHistory[e.pageHistoryTracker]),e.pageHistoryTracker>0?$("#backPage").addClass("back-forward-enabled").removeClass("back-forward-disabled"):$("#backPage").addClass("back-forward-disabled").removeClass("back-forward-enabled"),$("#forwardPage").addClass("back-forward-enabled").removeClass("back-forward-disabled"))}),$("#forwardPage").on("click",function(){e.pageHistoryTracker<e.pageHistory.length-1&&(e.pageHistoryTracker+=1,e.docViewer.setCurrentPage(e.pageHistory[e.pageHistoryTracker]),$("#backPage").addClass("back-forward-enabled").removeClass("back-forward-disabled"),e.pageHistoryTracker<e.pageHistory.length-1?$("#forwardPage").addClass("back-forward-enabled").removeClass("back-forward-disabled"):$("#forwardPage").addClass("back-forward-disabled").removeClass("back-forward-enabled"))}),$("#prevPage").on("click",function(){var t=e.docViewer.getCurrentPage();t>1&&(e.docViewer.setCurrentPage(t-1),e.trackPageHistory(t-1))}),$("#nextPage").on("click",function(){var t=e.docViewer.getCurrentPage();t<=e.docViewer.getPageCount()&&(e.docViewer.setCurrentPage(t+1),e.trackPageHistory(t+1))}),$("#searchButton").on("click",function(){e.searchText($("#searchBox").val())}),$("#searchBox").on("keypress",function(t){if(13===t.which){var n=$(this).val();t.shiftKey?e.searchText(n,e.docViewer.SearchMode.e_search_up):e.searchText(n)}}),$("#fullSearchButton").on("click",function(){e.fullTextSearch($("#fullSearchBox").val())}),$("#fullSearchBox").on("keypress",function(t){13===t.which&&e.fullTextSearch($(this).val())}),e.bindPrintEvents()},getAllPageNumbers:function(){for(var e=[],t=1;t<=this.getPageCount();t++)e.push(t);return e},endPrintJob:function(){BaseReaderControl.prototype.endPrintJob.apply(this,arguments),$("#invalidPageSelectionError").hide(),$("#printProgress").hide(),$(".progressLabel").hide()},print:function(){function e(){if($("#allPages").prop("checked"))return i.getAllPageNumbers();var e=$("#selectedPagesInput").val();return i.getPagesToPrint(e)}function t(e){var t=$("#printStartButton");0===e?($("#invalidPageSelectionError").show(),t.prop("disabled",!0)):($("#invalidPageSelectionError").hide(),t.prop("disabled",!1))}function n(){o=e(),$(".numberPagesLabel").attr("data-i18n","print.totalPageCount").data("i18n-options",{count:o.length}).i18n(),t(o.length)}var o,i=this;$("#numberPagesToPrint").show(),$(".numberPagesLabel").show(),n();for(var a=[$("#allPages"),$("#selectedPages")],r=0;r<a.length;r++)a[r].on("change",n);var s=$("#selectedPagesInput"),l=_.throttle(n,200,{leading:!1});s.on("keyup",l),s.on("click",function(){$("#selectedPages").prop("checked",!0),n()}),$("#printDialog").dialog({modal:!0,resizable:!1,show:{effect:"scale",duration:100},hide:{effect:"scale",duration:100},open:function(){$("#allPages").prop("checked",!0),$("#selectedPagesInput").val(""),n()},close:function(){i.endPrintJob()},buttons:[{id:"printStartButton",text:i18n.t("print.print"),click:function(){i.startPrintJob(o,i.pageOrientations.Auto,!1,function(){window.print()})}},{text:i18n.t("print.done"),click:function(){$(this).dialog("close")}}]})},printHandler:function(){var e=this;e.print()},bindPrintEvents:function(){var e=this,t=$("#printProgress"),n=$(".progressLabel");$("#printButton").on("click",function(){e.printHandler()}),$(document).on("printProgressChanged",function(e,o,i){t.show().progressbar({value:o/i*100}),n.show().attr("data-i18n","print.preparingPages").data("i18n-options",{current:o,total:i}).i18n()})},getPageContainer:function(e){return $("#DocumentViewer").find("#pageContainer"+e)},setInterfaceDefaults:function(){var e=this.docViewer.getCurrentPage()-1;$("#totalPages").text("/"+this.docViewer.getPageCount());var t=Math.round(100*this.docViewer.getZoom());$("#zoomBox").val(t+"%"),$("#slider").slider({value:t}),$("#pageNumberBox").val(e+1),this.docViewer.setToolMode(this.defaultToolMode),this.clickedThumb=e,$("#thumbContainer"+e).addClass("ui-state-active")},setVisibleTab:function(e){$("#tabs").tabs("option","active",e)},getShowSideWindow:function(){return!!this._showSideWindow},setShowSideWindow:function(t,n){_.isUndefined(n)&&(n=!0),e.ControlUtils.userPreferences.setViewerPreference("showSideWindow",t);var o=$("#sidePanel"),i=$("#toggleSidePanel"),a=n?{effect:"slide",duration:150}:void 0;t?(o.show(a),i.addClass("customicons collapse_left").removeClass("collapse"),$("#ui-display").addClass("left-panel-visible")):(o.hide(a),i.addClass("collapse").removeClass("customicons collapse_left"),$("#ui-display").removeClass("left-panel-visible")),this._showSideWindow=t,this.shiftSidePanel(n);var r=this,s=n?250:0;setTimeout(function(){r.docViewer.scrollViewUpdated(),r.fireEvent("sidePanelVisibilityChanged",t)},s)},notesPanelVisible:function(){return!!this._showNotesPanel},showNotesPanel:function(e){var t=this;this._showNotesPanel=e;var n=$("#notesPanelWrapper"),o=n.find("#notesPanel"),i=$("#toggleNotesPanel");e?(n.removeClass("hidden"),o.removeClass("hidden"),i.addClass("active"),this.fireEvent("notesPanelBecomingVisible")):(n.addClass("hidden"),o.addClass("hidden"),i.removeClass("active")),this.shiftSidePanel(),setTimeout(function(){t.docViewer.scrollViewUpdated(),t.fireEvent("notesPanelVisibilityChanged",e)},250)},setToolbarVisibility:function(e){e?$("#control").show():$("#control").hide(),this.resize()},rotateClockwise:function(e){this.docViewer.rotateClockwise(e)},rotateCounterClockwise:function(e){this.docViewer.rotateCounterClockwise(e)},fitWidth:function(){this.docViewer.setFitMode(this.docViewer.FitMode.FitWidth)},fitPage:function(){this.docViewer.setFitMode(this.docViewer.FitMode.FitPage)},fitZoom:function(){this.docViewer.setFitMode(this.docViewer.FitMode.Zoom)},getFitMode:function(){return this.docViewer.getFitMode()},setFitMode:function(e){this.docViewer.setFitMode(e)},getLayoutMode:function(){return this.docViewer.getDisplayModeManager().getDisplayMode().mode},setLayoutMode:function(t){var n=new e.CoreControls.DisplayMode(this.docViewer,t);this.docViewer.getDisplayModeManager().setDisplayMode(n)},closeDocument:function(){if(e.BaseReaderControl.prototype.closeDocument.call(this),this.docViewer.getDocument())for(var t in this.requestedThumbs)this.cancelThumbnail(this.requestedThumbs[t]);this.clearSidePanelData()},SetSearchModes:function(e){e&&(e.CaseSensitive&&$("#caseSensitiveSearch").prop("checked",!0),e.WholeWord&&$("#wholeWordSearch").prop("checked",!0))}},e.ReaderControl.prototype=$.extend({},e.BaseReaderControl.prototype,e.ReaderControl.prototype)}(window),$(function(){window.ControlUtils.initialize(function(){$("#ui-display").children().hide(),$("#unsupportedErrorMessage").show()})}),ReaderControl.config={serverURL:"annotationHandler.php",defaultUser:"Guest"},ReaderControl.config.ui={hideAnnotationPanel:!1,hideControlBar:!1,hideSidePanel:!1,hideDisplayModes:!1,hideZoom:!1,hideTextSearch:!1,hidePrint:!1};