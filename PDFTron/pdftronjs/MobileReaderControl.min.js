!function(e){"use strict";e.PDFTron=e.PDFTron||{},e.PDFTron.WebViewer=e.PDFTron.WebViewer||{},e.PDFTron.WebViewer.ToolMode={Pan:"Pan",TextSelect:"TextSelect",PanAndAnnotationEdit:"PanAndAnnotationEdit",AnnotationEdit:"AnnotationEdit",AnnotationCreateCustom:"AnnotationCreateCustom",AnnotationCreateEllipse:"AnnotationCreateEllipse",AnnotationCreateFreeHand:"AnnotationCreateFreeHand",AnnotationCreateLine:"AnnotationCreateLine",AnnotationCreateRectangle:"AnnotationCreateRectangle",AnnotationCreateSticky:"AnnotationCreateSticky",AnnotationCreateTextHighlight:"AnnotationCreateTextHighlight",AnnotationCreateTextStrikeout:"AnnotationCreateTextStrikeout",AnnotationCreateTextUnderline:"AnnotationCreateTextUnderline",AnnotationCreatePolyline:"AnnotationCreatePolyline",AnnotationCreatePolygon:"AnnotationCreatePolygon",AnnotationCreatePolygonCloud:"AnnotationCreatePolygonCloud",AnnotationCreateCallout:"AnnotationCreateCallout",AnnotationCreateFreeText:"AnnotationCreateFreeText"};var t=function(){},n=function(){console.warn("Unsupported method for this viewer type.")};t.prototype={fitHeight:function(){n()},fitPage:function(){n()},fitWidth:function(){n()},fitZoom:function(){n()},getCurrentPageNumber:function(){n()},setCurrentPageNumber:function(e){n()},getLayoutMode:function(){n()},setLayoutMode:function(e){n()},getPageCount:function(){n()},getShowSideWindow:function(){n()},setShowSideWindow:function(e){n()},getToolMode:function(){n()},setToolMode:function(e){n()},getFitMode:function(){n()},setFitMode:function(e){n()},getZoomLevel:function(){n()},setZoomLevel:function(){n()},goToFirstPage:function(){n()},goToLastPage:function(){n()},goToNextPage:function(){n()},goToPrevPage:function(){n()},loadDocument:function(e){n()},rotateClockwise:function(){n()},rotateCounterClockwise:function(){n()},searchText:function(e,t){n()}},e.WebViewerInterface=t}(window),function(e){"use strict";e.ControlUtils={},e.console=e.console||{log:function(){},warn:function(){},error:function(){},assert:function(){}};var t=function(e){return"undefined"==typeof e},n=function(){var e=window.location.href,t=e.indexOf("#");return t>=0?e.substring(t+1):""};e.ControlUtils.getQueryStringMap=function(e){t(e)&&(e=!0);for(var o={},i=e?n():window.location.search.substring(1),a=i.split("&"),r=0;r<a.length;r++){var s=a[r].split("=");o[s[0]]=s[1]}return{getBoolean:function(e,n){var i=o[e];return t(i)?t(n)?null:n:(i=i.toLowerCase(),"true"===i||"yes"===i||"1"===i||"false"!==i&&"no"!==i&&"0"!==i&&!!e)},getString:function(e,n){var i=o[e];return t(i)?t(n)?null:n:decodeURIComponent(i)}}},e.ControlUtils.initialize=function(e){function t(){var e=o.getBoolean("toolbar"),t=o.getBoolean("useSharedWorker",!1);null!==e&&(ReaderControl.config.ui.hideControlBar=!e),window.readerControl=new ReaderControl({enableAnnot:o.getBoolean("a",!1),enableOffline:o.getBoolean("offline",!1),docId:o.getString("did"),serverUrl:o.getString("server_url"),user:o.getString("user"),isAdmin:o.getBoolean("admin",!1),readOnly:o.getBoolean("readonly",!1),hideToolbar:ReaderControl.config.ui.hideControlBar,showFilePicker:o.getBoolean("filepicker",!1),pdfType:r,preloadWorker:o.getBoolean("preloadWorker",!0),useDownloader:o.getBoolean("useDownloader",!0),hideAnnotationPanel:o.getBoolean("hideAnnotationPanel",!1),pageHistory:o.getBoolean("pageHistory",!0)});var n=o.getString("d");"undefined"!=typeof Android&&"undefined"!=typeof Android.getXodContentUri&&(n=Android.getXodContentUri());var i=o.getBoolean("streaming",!1),a=o.getBoolean("auto_load",!0);window.readerControl.fireEvent("viewerLoaded");var s=o.getString("p");if(null!==n&&a!==!1||s){var d;try{t&&window.parent.WebViewer&&(d=window.parent.WebViewer.workerTransportPromise())}catch(l){console.warn(l),"SecurityError"===l.name&&console.warn("workerTransportPromise option cannot be used with CORS")}o.getBoolean("startOffline")?($.ajaxSetup({cache:!0}),window.readerControl.loadDocument(n,{streaming:!1})):i===!0?window.readerControl.loadDocument(n,{streaming:i}):window.ControlUtils.byteRangeCheck(function(e){206!==e&&(i=!0,console.warn("HTTP range requests not supported. Switching to streaming mode.")),window.readerControl.loadDocument(n,{streaming:i,workerTransportPromise:d})},function(){window.readerControl.loadDocument(n,{streaming:!0,workerTransportPromise:d})})}}function n(){null!==i&&i.length>0?$.getScript(i).done(function(e,n){t()}).fail(function(e,n,o){console.warn("Config script could not be loaded. The default configuration will be used."),t()}):t()}if($(window).on("hashchange",function(){window.location.reload()}),window.ControlUtils.i18nInit(function(){window.CanvasRenderingContext2D||e()}),window.CanvasRenderingContext2D){var o=window.ControlUtils.getQueryStringMap(!window.utils.ieWebViewLocal),i=o.getString("config"),a=o.getString("xdomain_urls");null!==a&&window.ControlUtils.initXdomain(a);var r=o.getString("pdf");if("pnacl"===r||"ems"===r||"jsworker"===r||"auto"===r){var s=["external/FileSaver.min.js","pdf/PDFReaderControl.js"],d=s.map(function(e){if("jsworker"===r&&"external/FileSaver.min.js"===e)return null;var t=new $.Deferred,n=document.createElement("script");n.type="text/javascript";var o=document.getElementsByTagName("body")[0];return o.appendChild(n),n.onload=function(){t.resolve()},n.src=e,t});$.when.apply(null,d).done(function(){ReaderControl.config=DesktopReaderControl.config,n()})}else n()}},e.ControlUtils.getCustomData=function(){var t=e.ControlUtils.getQueryStringMap(),n=t.getString("custom");return null===n?null:n},e.ControlUtils.getI18nOptions=function(e){var t={useCookie:!1,useDataAttrOptions:!0,defaultValueFromContent:!1,fallbackLng:"en",resGetPath:"Resources/i18n/__ns__-__lng__.json"};return e||(t.lng="en"),t},e.ControlUtils.i18nInit=function(t){i18n.init(e.ControlUtils.getI18nOptions(),function(){$(document).trigger("i18nready"),t&&t(),$("body").i18n()})},e.ControlUtils.initXdomain=function(e){var t=JSON.parse(e),n=$("<script>").attr("src","external/xdomain.js");t.url&&n.attr("slave",t.url),$("head").append(n),t.url||xdomain.slaves(t)},e.ControlUtils.getNotifyFunction=function(e,t){switch(t){case"permissionEdit":alert(i18n.t("annotations.permissionEdit"));break;case"permissionDelete":alert(i18n.t("annotations.permissionDelete"));break;case"readOnlyCreate":alert(i18n.t("annotations.readOnlyCreate"));break;case"readOnlyDelete":alert(i18n.t("annotations.readOnlyDelete"));break;case"readOnlyEdit":alert(i18n.t("annotations.readOnlyEdit"));break;case"markupOffCreate":alert(i18n.t("annotations.markupOffCreate"));break;case"endOfDocumentSearch":alert(i18n.t("endOfDocument"))}},e.ControlUtils.byteRangeCheck=function(e,t){$.ajax({url:window.location.href,type:"GET",cache:!1,headers:{Range:"bytes=0-0"},success:function(t,n,o){e(o.status)},error:function(){t()}})};var o={toolList:[],viewerPreferences:{showSideWindow:!0},registerTool:function(t,n,o,i){var a={tool:t,name:n,annotationCheck:function(e){var t=e.elementName===o.prototype.elementName;return t&&i&&(t=i(e)),t}},r=this._importToolData(n);r&&r.defaultEditMode?a.defaultEditMode=r.defaultEditMode:a.defaultEditMode=e.ControlUtils.editMode.basic;var s=new o;s.StrokeColor&&(r&&r.colors?a.colors=r.colors:a.colors=["#FF0000","#FF8000","#FFFF00","#00FF00","#008000","#00FFFF","#0000FF","#FF00FF","#000000","#FFFFFF"]),s.FillColor&&(r&&r.fillColors?a.fillColors=r.fillColors:a.fillColors=["#FF0000","#FF8000","#FFFF00","#00FF00","#008000","#00FFFF","#0000FF","#FF00FF","#000000","#FFFFFF","transparent"]),s.TextColor&&(r&&r.textColors?a.textColors=r.textColors:a.textColors=["#FF0000","#FF8000","#FFFF00","#00FF00","#008000","#00FFFF","#0000FF","#FF00FF","#000000","#FFFFFF"]),r&&r.defaults&&(t.defaults=r.defaults),this.toolList.push(a)},_getMatchingTools:function(e){for(var t=[],n=this.toolList.length,o=0;o<n;++o)this.toolList[o].annotationCheck(e)&&t.push(this.toolList[o]);return t},getToolColors:function(e){var t=this._getMatchingTools(e);if(1===t.length)return{colors:t[0].colors,fillColors:t[0].fillColors,textColors:t[0].textColors}},getAdvancedToolColors:function(){return["#F8E0E0","#F8ECE0","#F7F8E0","#E0F8E0","#E0F8F7","#E0E0F8","#ECE0F8","#F8E0F7","#FFFFFF","#F5A9A9","#F5D0A9","#F2F5A9","#A9F5A9","#A9F5F2","#A9A9F5","#D0A9F5","#F5A9F2","#E6E6E6","#FA5858","#FAAC58","#F4FA58","#58FA58","#58FAF4","#4848FA","#AC58FA","#FA58F4","#BDBDBD","#FF0000","#FF8000","#FFFF00","#00FF00","#00FFFF","#0000FF","#8000FF","#FF00FF","#808080","#B40404","#B45F04","#AEB404","#04B404","#04B4AE","#0404B4","#5F04B4","#B404AE","#585858","#800000","#804000","#808000","#008000","#008080","#000080","#400080","#800080","#444444","#610B0B","#61380B","#5E610B","#0B610B","#0B615E","#0B0B61","#380B61","#610B5E","#2E2E2E","#2A0A0A","#2A1B0A","#292A0A","#0A2A0A","#0A2A29","#0A0A2A","#1B0A2A","#2A0A29","#000000"]},_getColorList:function(e,t){var n=null,o=this._getMatchingTools(e);return 1===o.length&&("StrokeColor"===t?n=o[0].colors:"FillColor"===t?n=o[0].fillColors:"TextColor"===t&&(n=o[0].textColors)),{tool:o[0],colorList:n}},addToolColor:function(e,t,n){var o=this._getColorList(e,t),i=o.colorList;null!==i&&i.indexOf(n)===-1&&("FillColor"===t?i.splice(-1,0,n):i.push(n),this._exportToolData(o.tool))},removeToolColor:function(e,t,n){var o=this._getColorList(e,t),i=o.colorList;if(null!==i){var a=i.indexOf(n);a>-1&&(i.splice(a,1),this._exportToolData(o.tool))}},getDefaultToolEditingMode:function(e){var t=this._getMatchingTools(e);return 1===t.length?t[0].defaultEditMode:null},setDefaultToolEditingMode:function(e,t){var n=this._getMatchingTools(e);1===n.length&&(n[0].defaultEditMode=t,this._exportToolData(n[0]))},defaultToolValueChanged:function(e,t,n){var o=this._getMatchingTools(e);1===o.length&&(o[0].tool.defaults[t]=n,this._exportToolData(o[0]))},_exportTool:function(e){var t={defaultEditMode:e.defaultEditMode};e.colors&&(t.colors=e.colors),e.fillColors&&(t.fillColors=e.fillColors),e.textColors&&(t.textColors=e.textColors),t.defaults=e.tool.defaults,this._storePreference("toolData-"+e.name,t)},_exportToolData:function(e){_.isUndefined(e)?this.toolList.forEach(this._exportTool):this._exportTool(e)},_importToolData:function(e){return this._getPreference("toolData-"+e)},getViewerPreferences:function(){return this.viewerPreferences=this._getPreference("viewerPreferences")||this.viewerPreferences,this.viewerPreferences},setViewerPreference:function(e,t){this.viewerPreferences[e]=t,this._storePreference("viewerPreferences",this.viewerPreferences)},_storePreference:function(e,t){try{localStorage[e]=JSON.stringify(t)}catch(n){console.warn("localStorage could not be accessed. "+n.message)}},_getPreference:function(e){var t;try{t=localStorage[e]}finally{return t?JSON.parse(t):null}}};e.ControlUtils.userPreferences=o,e.ControlUtils.editMode={basic:"Basic",advanced:"Advanced"},$(document).on("defaultToolValueChanged",function(e,t,n,i){o.defaultToolValueChanged(t,n,i)}),e.ControlUtils.getSelectedAnnotation=function(){var e=readerControl.docViewer.getAnnotationManager(),t=e.getSelectedAnnotations();if(t.length<=0)return null;var n=t[0];return e.canModify(n)?n:null},e.ControlUtils.PropertyManager=function(t,n,o){this.annotationProperty=t,this.$slider=n,this.$radioContainer=o,this.displayUnit="",this.annotationPropertyModifier=function(e){return e};var i=this;o.find("[data-value]").each(function(){var t=$(this),n=t.attr("data-value");t.on("click",function(){i.update(n),readerControl.fireEvent("defaultToolValueChanged",[e.ControlUtils.getSelectedAnnotation(),i.annotationProperty,i.annotationPropertyModifier(n)])})})},e.ControlUtils.PropertyManager.prototype={setDisplayUnit:function(e){this.displayUnit=e},setAnnotationPropertyModifier:function(e){this.annotationPropertyModifier=e},update:function(t,n){n=!!_.isUndefined(n)||n;var o=this.$radioContainer.find('[data-value="'+t+'"]');if(o.length>0?o.prop("checked",!0):this.$radioContainer.find("[data-value]").prop("checked",!1),this.$radioContainer.find(".propertyValue").text(Math.round(t)+this.displayUnit),n){var i=e.ControlUtils.getSelectedAnnotation();if(i){i[this.annotationProperty]=this.annotationPropertyModifier(t);var a=readerControl.docViewer.getAnnotationManager();a.trigger("annotationChanged",[[i],"modify"]),a.updateAnnotation(i),e.ControlUtils.updateAnnotPreview(i)}}}};var i;e.ControlUtils.setPreviewCanvas=function(e,t,n){i=new a(e,t,n)},e.ControlUtils.updateAnnotPreview=function(e){i.update(e)};var a=function(e,t,n){this.canvas=e,this.ctx=this.canvas.getContext("2d"),this.width=t,this.height=n};a.prototype={drawRectangle:function(e,t){var n=this.ctx.lineWidth;this.ctx.save(),this.ctx.beginPath(),this.ctx.moveTo(n,n),this.ctx.lineTo(this.width-n,n),this.ctx.lineTo(this.width-n,this.height-n),this.ctx.lineTo(n,this.height-n),this.ctx.closePath(),this.ctx.clip(),this.ctx.moveTo(0,0),this.ctx.fillRect(0,0,this.width,this.height),t&&(this.ctx.fillStyle=t.toString(),this.ctx.textAlign="center",this.ctx.textBaseline="middle",this.ctx.fillText("Aa",this.width/2,this.height/2)),this.ctx.restore(),e>0&&(this.ctx.lineWidth*=2,this.ctx.strokeRect(0,0,this.width,this.height))},drawCircle:function(){var e=.5*this.width,t=.5*this.height,n=.5*this.width,o=this.ctx.lineWidth;this.ctx.beginPath(),this.ctx.arc(e,t,n-o,0,2*Math.PI),this.ctx.fill(),this.ctx.beginPath(),this.ctx.arc(e,t,n-o/2,0,2*Math.PI),this.ctx.stroke()},drawHorizontalLine:function(){this.ctx.beginPath(),this.ctx.moveTo(0,this.height/2),this.ctx.lineTo(this.width,this.height/2),this.ctx.stroke()},drawDiagonalLine:function(){var e=10;this.ctx.beginPath(),this.ctx.moveTo(e,this.height-e),this.ctx.lineTo(this.width-e,e),this.ctx.stroke()},drawCurvedLine:function(){this.ctx.lineCap="round",this.ctx.beginPath(),this.ctx.moveTo(1/8*this.width,.5*this.height),this.ctx.bezierCurveTo(5/16*this.width,3/8*this.height,5/16*this.width,3/8*this.height,.5*this.width,.5*this.height),this.ctx.bezierCurveTo(.6875*this.width,5/8*this.height,.6875*this.width,5/8*this.height,7/8*this.width,.5*this.height),this.ctx.stroke()},drawStickyNote:function(e){var t=Math.max(e.Width/this.width,e.Height/this.height),n=.75/t;this.ctx.translate(.125*this.width,.125*this.height),this.ctx.scale(n,n),e.draw(this.ctx)},update:function(e){var t=e.StrokeThickness,n=e.StrokeColor,o=e.FillColor,i=e.Opacity,a=e.TextColor,r=e.FontSize;this.ctx.save(),this.ctx.clearRect(0,0,this.width,this.height),t&&(this.ctx.lineWidth=t),n&&(this.ctx.strokeStyle=n.toString()),o&&(this.ctx.fillStyle=o.toString()),_.isUndefined(i)||(this.ctx.globalAlpha=i),_.isUndefined(r)||(this.ctx.font=r+" Arial"),e instanceof Annotations.TextMarkupAnnotation&&!(e instanceof Annotations.TextHighlightAnnotation)||e instanceof Annotations.PolylineAnnotation?this.drawHorizontalLine():e instanceof Annotations.LineAnnotation?this.drawDiagonalLine():e instanceof Annotations.FreeHandAnnotation?this.drawCurvedLine():e instanceof Annotations.StickyAnnotation?this.drawStickyNote(e):e instanceof Annotations.RectangleAnnotation||e instanceof Annotations.FreeTextAnnotation||e instanceof Annotations.PolygonAnnotation?this.drawRectangle(t,a):e instanceof Annotations.EllipseAnnotation?this.drawCircle():o?this.drawRectangle(t,a):this.drawHorizontalLine(),this.ctx.restore()}}}(window),function(e){"use strict";var t=e.PDFTron.WebViewer.ToolMode;e.BaseReaderControl=function(n){var o=this;this.enableAnnotations=n.enableAnnot,this.enableOffline=n.enableOffline,this.docId=n.docId,this.hasBeenClosed=!1,this.serverUrl=n.serverUrl;var i=_.isUndefined(this.serverUrl)||_.isNull(this.serverUrl);if(!i||_.isUndefined(ReaderControl.config)||_.isUndefined(ReaderControl.config.serverURL)||(this.serverUrl=ReaderControl.config.serverURL),this.userPreferences=e.ControlUtils.userPreferences.getViewerPreferences(),this.currUser="",!_.isUndefined(ReaderControl.config)&&!_.isUndefined(ReaderControl.config.defaultUser)){if(this.currUser=ReaderControl.config.defaultUser,!_.isUndefined(ReaderControl.config.customStyle))if($.isArray(ReaderControl.config.customStyle))for(var a=0;a<ReaderControl.config.customStyle.length;a++)$("<link/>").appendTo("head").attr({rel:"stylesheet",type:"text/css",href:ReaderControl.config.customStyle[a]});else $("<link>").appendTo("head").attr({rel:"stylesheet",type:"text/css",href:ReaderControl.config.customStyle});_.isUndefined(ReaderControl.config.customScript)||$.getScript(ReaderControl.config.customScript,function(e,t,n){})}this.currUser=n.user||this.currUser,this.isAdmin=n.isAdmin,this.readOnly=n.readOnly,this.docViewer=new e.CoreControls.DocumentViewer,this.docViewer.setOptions({enableAnnotations:this.enableAnnotations}),this.pageOrientations={Auto:0,Portrait:1,Landscape:2};var r=e.Tools;this.toolModeMap={},this.toolModeMap[t.Pan]=new r.PanTool(this.docViewer),this.toolModeMap[t.PanAndAnnotationEdit]=new r.PanTool(this.docViewer),this.toolModeMap[t.TextSelect]=new r.TextSelectTool(this.docViewer),this.toolModeMap[t.AnnotationEdit]=new r.AnnotationEditTool(this.docViewer),this.toolModeMap[t.AnnotationCreateEllipse]=new r.EllipseCreateTool(this.docViewer),this.toolModeMap[t.AnnotationCreateFreeHand]=new r.FreeHandCreateTool(this.docViewer),this.toolModeMap.AnnotationCreateSignature=new r.SignatureCreateTool(this.docViewer),this.toolModeMap[t.AnnotationCreateLine]=new r.LineCreateTool(this.docViewer),this.toolModeMap.AnnotationCreateArrow=new r.ArrowCreateTool(this.docViewer),this.toolModeMap[t.AnnotationCreateRectangle]=new r.RectangleCreateTool(this.docViewer),this.toolModeMap[t.AnnotationCreateSticky]=new r.StickyCreateTool(this.docViewer),this.toolModeMap[t.AnnotationCreateTextHighlight]=new r.TextHighlightCreateTool(this.docViewer),this.toolModeMap[t.AnnotationCreateTextStrikeout]=new r.TextStrikeoutCreateTool(this.docViewer),this.toolModeMap[t.AnnotationCreateTextUnderline]=new r.TextUnderlineCreateTool(this.docViewer),this.toolModeMap.AnnotationCreateTextSquiggly=new r.TextSquigglyCreateTool(this.docViewer),this.toolModeMap[t.AnnotationCreatePolyline]=new r.PolylineCreateTool(this.docViewer),this.toolModeMap[t.AnnotationCreatePolygon]=new r.PolygonCreateTool(this.docViewer),this.toolModeMap.AnnotationCreatePolygonCloud=new r.PolygonCloudCreateTool(this.docViewer),this.toolModeMap[t.AnnotationCreateCallout]=new r.CalloutCreateTool(this.docViewer),this.toolModeMap[t.AnnotationCreateFreeText]=new r.FreeTextCreateTool(this.docViewer),this.toolModeMap[t.AnnotationCreateCustom]=new r.AnnotationEditTool(this.docViewer);var s=e.ControlUtils.userPreferences;s.registerTool(this.toolModeMap[t.AnnotationCreateEllipse],"ellipse",Annotations.EllipseAnnotation),s.registerTool(this.toolModeMap[t.AnnotationCreateFreeHand],"freehand",Annotations.FreeHandAnnotation),s.registerTool(this.toolModeMap[t.AnnotationCreateLine],"line",Annotations.LineAnnotation,function(e){return"None"===e.getEndStyle()&&"None"===e.getStartStyle()}),s.registerTool(this.toolModeMap.AnnotationCreateArrow,"arrow",Annotations.LineAnnotation,function(e){return"OpenArrow"===e.getEndStyle()||"OpenArrow"===e.getStartStyle()}),s.registerTool(this.toolModeMap[t.AnnotationCreateRectangle],"rectangle",Annotations.RectangleAnnotation),s.registerTool(this.toolModeMap[t.AnnotationCreateSticky],"sticky",Annotations.StickyAnnotation),s.registerTool(this.toolModeMap[t.AnnotationCreatePolyline],"polyline",Annotations.PolylineAnnotation),s.registerTool(this.toolModeMap[t.AnnotationCreatePolygon],"polygon",Annotations.PolygonAnnotation,function(e){return"cloudy"!==e.Style||"PolygonCloud"!==e.Intent}),s.registerTool(this.toolModeMap.AnnotationCreatePolygonCloud,"polygoncloud",Annotations.PolygonAnnotation,function(e){return"cloudy"===e.Style&&"PolygonCloud"===e.Intent}),s.registerTool(this.toolModeMap[t.AnnotationCreateCallout],"callout",Annotations.FreeTextAnnotation,function(e){return e.getIntent()===Annotations.FreeTextAnnotation.Intent.FreeTextCallout}),s.registerTool(this.toolModeMap[t.AnnotationCreateFreeText],"freetext",Annotations.FreeTextAnnotation,function(e){return e.getIntent()!==Annotations.FreeTextAnnotation.Intent.FreeTextCallout}),s.registerTool(this.toolModeMap[t.AnnotationCreateTextHighlight],"highlight",Annotations.TextHighlightAnnotation),s.registerTool(this.toolModeMap[t.AnnotationCreateTextStrikeout],"strikeout",Annotations.TextStrikeoutAnnotation),s.registerTool(this.toolModeMap[t.AnnotationCreateTextUnderline],"underline",Annotations.TextUnderlineAnnotation),s.registerTool(this.toolModeMap.AnnotationCreateTextSquiggly,"squiggly",Annotations.TextSquigglyAnnotation),this.defaultToolMode=this.toolModeMap[t.Pan];var d=this.toolModeMap.AnnotationCreateSignature;d.on("annotationAdded",function(){o.setToolMode(t.Pan)}),this.docViewer.on("documentLoaded",_(this.onDocumentLoaded).bind(this)),this.docViewer.on("notify",e.ControlUtils.getNotifyFunction),this.enableAnnotations&&null!==o.serverUrl&&this.docViewer.setInternalAnnotationsTransform(function(e,t){var n={};null!==o.docId&&o.docId.length>0&&(n={did:o.docId}),$.ajax({url:o.serverUrl,cache:!1,data:n,success:function(n){t(_.isNull(n)||_.isUndefined(n)?e:n)},error:function(n,o,i){console.warn("Annotations could not be loaded from the server."),t(e)},dataType:"xml"})})};var n=function(){console.warn("Function not implemented by this viewer")};e.BaseReaderControl.prototype=$.extend(new e.WebViewerInterface,{onDocumentLoaded:function(){if(this.hasBeenClosed)return void this.closeDocument();var e=this.docViewer.getAnnotationManager();if(e.setCurrentUser(this.currUser),e.setIsAdminUser(this.isAdmin),e.setReadOnly(this.readOnly),this.enableOffline&&(Modernizr.indexeddb||Modernizr.websqldatabase))if(this.startOffline)this.offlineReady();else{var t=this;this.docViewer.getDocument().initOfflineDB(function(){t.offlineReady()})}},loadDocument:function(t,n){var o,i,a;n&&(o=n.streaming,i=n.decrypt,a=n.decryptOptions);var r=e.ControlUtils.getQueryStringMap(!window.utils.ieWebViewLocal),s=r.getString("p");this.startOffline=r.getBoolean("startOffline",!1);var d,l=r.getBoolean("azureWorkaround",!1);try{var c=e.CoreControls.PartRetrievers.CacheHinting;d=this.startOffline?new CoreControls.PartRetrievers.WebDBPartRetriever:e.utils.ieWebViewLocal?new e.CoreControls.PartRetrievers.WinRTPartRetriever(t,c.CACHE,i,a):t&&0===t.indexOf("iosrange://")?new e.CoreControls.PartRetrievers.IOSPartRetriever(t,c.CACHE,i,a):t&&0===t.indexOf("content://")?new e.CoreControls.PartRetrievers.AndroidContentPartRetriever(t,c.CACHE,i,a):null!==s?new e.CoreControls.PartRetrievers.ExternalHttpPartRetriever(t,s):o===!0?new e.CoreControls.PartRetrievers.StreamingPartRetriever(t,c.CACHE,i,a):l?new e.CoreControls.PartRetrievers.AzurePartRetriever(t,c.CACHE,i,a):new e.CoreControls.PartRetrievers.HttpPartRetriever(t,c.CACHE,i,a)}catch(u){console.error(u)}var p=this;n&&n.customHeaders&&d.setCustomHeaders(n.customHeaders),d.setErrorCallback(function(e){p.fireEvent("error",["xodLoad",e,i18n.t("error.load")])}),this.hasBeenClosed=!1,this.docViewer.loadAsync(d,this.docId)},offlineReady:function(){n()},fireEvent:function(e,t){$(document).trigger(e,t)},exportAnnotations:function(e){if(null===this.serverUrl)return void console.warn("Server URL not defined; not configured for server-side annotation saving.");e.start();var t="?did="+this.docId;null===this.docId&&(t="");var n=this.docViewer.getAnnotationManager().exportAnnotations();$.ajax({type:"POST",url:this.serverUrl+t,data:{data:n},success:e.success,error:function(t,n,o){console.warn("Failed to send annotations to server."),e.error()},complete:e.complete})},copyButtonHandler:function(){if(window.clipboardData)window.clipboardData.setData("Text",this.docViewer.getSelectedText());else{$("#clipboard").select();try{document.execCommand("copy")}catch(e){console.warn("copy is not supported by browser"),alert("error")}}},getPagesToPrint:function(e){var t=this.getPageCount(),n=(e+"").replace(/\s+/g,""),o=[];if(0===n.length){for(var i=1;i<=t;i++)o.push(i);return o}for(var a,r,s,d=n.split(","),l=0;l<d.length;l++)if(a=d[l].split("-"),1===a.length)o.push(parseInt(a[0],10));else if(2===a.length){if(r=parseInt(a[0],10),s=""===a[1]?t:parseInt(a[1],10),s<r)continue;for(var c=r;c<=s;c++)o.push(c)}return o.filter(function(e,n,o){return o.indexOf(e)===n&&e>0&&e<=t}).sort(function(e,t){return e-t})},prepareDocument:function(e,t,n,o){function i(){var c=e[l],u=a.docViewer.getDocument(),p=a.docViewer.getCompleteRotation(c)-a.docViewer.getRotation(c),h=u.getPageInfo(c-1),g=0,f=0;t===a.pageOrientations.Portrait?(g=p,h={width:h.height,height:h.width}):t===a.pageOrientations.Landscape?(f=1,g=(p+1)%4,0!==p&&(h={width:h.height,height:h.width})):t===a.pageOrientations.Auto&&h.width>h.height&&(0===p?(f=1,g=1):f=4-p);var w=a.printFactor;u.loadCanvasAsync(c-1,w,f,function(t){var u=t.getContext("2d"),p=window.GetPageMatrix(w,g,h);u.setTransform(p.m_a,p.m_b,p.m_c,p.m_d,p.m_h,p.m_v),a.docViewer.getAnnotationManager().drawAnnotations(c,t),s=t.toDataURL(),d=$("<img>").attr("src",s).css({"max-height":"100%","max-width":"100%"}).load(function(){a.preparingForPrint&&(r.append(d),a.fireEvent("printProgressChanged",[l+1,e.length]),l++,l<e.length?i():(o(r),window.utils.unsetCanvasMultiplier(),a.preparingForPrint=!1))}),n&&(d.css("display","block"),l>0&&d.css("page-break-after","always"))},function(){},1)}var a=this,r=n?$('<div style="height: 100%; display: block"></div>'):$("#print-display");CoreControls.SetCanvasMode(CoreControls.CanvasMode.PageCanvas),r.empty(),window.utils.setCanvasMultiplier(1);var s,d,l=0;a.fireEvent("printProgressChanged",[0,e.length]),i()},startPrintJob:function(e,t,n,o){if(!this.preparingForPrint){var i=this.getPagesToPrint(e);if(0===i.length)return void alert(i18n.t("print.invalidPageSelectionMsg"));this.preparingForPrint=!0,this.prepareDocument(i,t,n,o)}},endPrintJob:function(){this.preparingForPrint=!1,$("#print-display").empty()},getDocumentViewer:function(){return this.docViewer},getCurrentPageNumber:function(){return this.docViewer.getCurrentPage()},setCurrentPageNumber:function(e){this.docViewer.setCurrentPage(e)},getPageCount:function(){return this.docViewer.getPageCount()},goToFirstPage:function(){this.docViewer.displayFirstPage()},goToLastPage:function(){this.docViewer.displayLastPage()},goToNextPage:function(){var e=this.docViewer.getCurrentPage();e<=0||(e+=1,this.docViewer.setCurrentPage(e))},goToPrevPage:function(){var e=this.docViewer.getCurrentPage();e<=1||(e-=1,this.docViewer.setCurrentPage(e))},getZoomLevel:function(){return this.docViewer.getZoom()},setZoomLevel:function(e){this.docViewer.zoomTo(e)},getToolMode:function(){var e=this.docViewer.getToolMode();for(var t in this.toolModeMap)if(e===this.toolModeMap[t])return t;return null},setToolMode:function(e){var t=this.toolModeMap[e];t&&this.docViewer.setToolMode(t)},setAnnotationUser:function(e){var t=this.docViewer.getAnnotationManager();this.currUser=e,t.setCurrentUser(this.currUser)},getAnnotationUser:function(){var e=this.docViewer.getAnnotationManager();return e.getCurrentUser()},setAdminUser:function(e){var t=this.docViewer.getAnnotationManager();this.isAdmin=e,t.setIsAdminUser(this.isAdmin)},isAdminUser:function(){var e=this.docViewer.getAnnotationManager();return e.getIsAdminUser()},setReadOnly:function(e){var t=this.docViewer.getAnnotationManager();this.readOnly=e,t.setReadOnly(this.readOnly)},isReadOnly:function(){var e=this.docViewer.getAnnotationManager();return e.getReadOnly()},closeDocument:function(){this.hasBeenClosed=!0,this.docViewer.closeDocument()}})}(window),function(e){"use strict";var t=e.utils.fCmp,n=XODText,o=e.PDFTron.WebViewer.ToolMode,i={color:"StrokeColor",fillColor:"FillColor",textColor:"TextColor"},a=i.color,r=!1,s=window.ControlUtils.editMode,d=s.basic,l=window.ControlUtils.userPreferences;e.ReaderControl=function(t){e.BaseReaderControl.call(this,t);var n=this,i=window.navigator.userAgent;n.isAndroid=i.indexOf("Android")>-1,n.androidBrowser=n.isAndroid&&i.indexOf("Chrome")===-1&&i.indexOf("Firefox")===-1;var a=i.indexOf("UIWebView")>-1,r=navigator.userAgent.match(/(iPad|iPhone|iPod)/i);if((window.opera||n.androidBrowser||10===e.utils.ie||11===e.utils.ie||r)&&(n.useTransformFallback=!0),_.isUndefined(window.devicePixelRatio)&&e.utils.ie&&window.innerWidth<1024&&e.utils.setCanvasMultiplier(2),window.opera||n.androidBrowser||e.utils.ieWebView||a)a&&FastClick.attach(document.getElementById("pageHeader"));else for(var s=document.getElementsByClassName("useFastClick"),d=0;d<s.length;d++)FastClick.attach(s[d]);n.isAndroid||$("#printButton").show(),e.CoreControls.SetCanvasMode(e.CoreControls.CanvasMode.ViewportCanvas),n.docViewer.setViewportRenderMode(!1),Annotations.ControlHandle.selectionAccuracyPadding=10,Annotations.SelectionAlgorithm.canvasVisibilityPadding=20,Annotations.SelectionModel.selectionAccuracyPadding=10,Annotations.ControlHandle.handleWidth=16,this.pageDisplayModes={Single:0,Double:1},this.pageDisplay=this.pageDisplayModes.Double,this.isCoverMode=!1,n.isCopySupported=!(!window.utils.ie&&!window.chrome),this.touchedPoint=null,n.$viewerPage=$("#viewerPage"),n.$viewer=$("#viewer"),n.$slider=$("#slider"),n.$slider.slider(),n.$preview=$("#preview"),n.$viewerWrapper=$("#viewerWrapper"),n.$wrapper=$("#wrapper"),n.$thumbContainer=$("#thumbContainer"),n.$pageIndicator=$("#sliderWrapper").find("input"),n.$goToPagePopup=$("#goToPagePopup").popup().trigger("create"),n.$pageNumberInput=n.$goToPagePopup.find("#pageNumberInput"),n.$menuWrapper=$("#menuWrapper"),n.$bookmarkView=$("#bookmarkView"),n.$bookmarkList=$("#bookmarkList"),n.$pageHeader=$("#pageHeader"),n.$printPopup=$("#printPopup").popup({afterclose:function(){$("#printPageNumberInput").val(""),n.cancelPrintJob()}}).trigger("create"),n.$printPageNumberInput=n.$printPopup.find("#printPageNumberInput"),n.$clipboard=$("#clipboard"),n.$clipboardWrapper=$("#clipboardWrapper"),n.$searchInput=$("#searchInput"),n.$fixedToolbars=$("[data-position='fixed']"),n.$defaultMenuContext=$("#defaultMenuContext"),n.$searchMenuContext=$("#searchMenuContext"),n.$annotCreateButton=$("#annotCreateButton"),n.$annotCreateMenuContext=$("#annotCreateMenuContext"),n.$annotEditPopup=$("#annotEditPopup"),n.$annotEditPopup.popup({tolerance:"0,2"}).trigger("create"),n.$addNewColor=n.$annotEditPopup.find("#addNewColor"),n.$annotEditButtons=n.$annotEditPopup.find("#annotEditButtons"),n.$annotQuickMenu=$("#annotQuickMenuPopup"),n.$annotQuickMenu.popup({tolerance:"0,2"}),$("#annotQuickMenuPopup-screen").addClass("needsclick"),n.$annotQuickMenuButtons=n.$annotQuickMenu.find("#annotQuickMenuButtons"),n.$annotQuickMenuGrid=n.$annotQuickMenu.find("#annotQuickMenuGrid"),n.$signaturePopup=$("#signaturePopup").popup().trigger("create"),n.$signatureSelectionContainer=n.$annotEditPopup.find("#signatureSelectionContainer").controlgroup(),n.$textSelectionContainer=n.$annotEditPopup.find("#textSelectionContainer").controlgroup(),n.$thicknessSlider=$("#thicknessSlider").slider(),n.$opacitySlider=$("#opacitySlider").slider(),n.$fontSizeSlider=$("#fontSizeSlider").slider(),n.$annotList=$("#annotList"),n.$noAnnotations=$('<li class="noannotations"></li>'),n.$noAnnotations.attr("data-i18n","mobile.annotations.noAnnotations").i18n().appendTo(n.$annotList),n.$annotList.listview({autodividers:!0,autodividersSelector:function(e){var t=n.$annotList.attr("data-mode");if("thread"===t)return i18n.t("mobile.annotations.threadedViewTitle");if("single"===t)return null;var o=$(e).data("pagenumber");return"undefined"!=typeof o?i18n.t("annotations.pageNumber",{number:o}):null}}),$(".showAllAnnotButton").hide().click(function(){n.viewAnnotsListMode()});var l=this.toolModeMap[o.AnnotationCreateSticky];l.on("annotationAdded",function(e,t){n.setToolMode(o.AnnotationEdit),n.annotationManager.selectAnnotation(t),n.showAnnotationEditPopup()}),n.buttonIdsToToolModes={editAnnotButton:this.toolModeMap[o.AnnotationEdit],createStickyButton:this.toolModeMap[o.AnnotationCreateSticky],createHighlightButton:this.toolModeMap[o.AnnotationCreateTextHighlight],createUnderlineButton:this.toolModeMap[o.AnnotationCreateTextUnderline],createStrikeoutButton:this.toolModeMap[o.AnnotationCreateTextStrikeout],createSquigglyButton:this.toolModeMap.AnnotationCreateTextSquiggly,
createSignatureButton:this.toolModeMap.AnnotationCreateSignature,createFreetextButton:this.toolModeMap[o.AnnotationCreateFreeText],createRectangleButton:this.toolModeMap[o.AnnotationCreateRectangle],createEllipseButton:this.toolModeMap[o.AnnotationCreateEllipse],createLineButton:this.toolModeMap[o.AnnotationCreateLine],createArrowButton:this.toolModeMap.AnnotationCreateArrow,createFreehandButton:this.toolModeMap[o.AnnotationCreateFreeHand],textSelectButton:this.toolModeMap[o.TextSelect]};var c=_.throttle(window.Tools.TextTool.prototype.select,50);window.Tools.TextTool.prototype.select=function(){c.apply(this,arguments)},n.doc=null,n.nPages=null,n.hasThumbs=!1,n.eventsBound=!1,n.offsetSwipe=0,n.vWOffset=0,n.vwxPos=0,n.currentPageIndex=0,n.currentPageZoom=null,n.currentPageMinZoom=null,n.currentPageMaxZoom=null,n.minZooms=[],n.zoomedWrapper=null,n.transformOffset=null,n.pagesRendering=[],n.snapComplete=!1,n.isSliding=!1,n.isPinching=!1,n.recentlyZoomed=!1,n.shouldRerender=!1,n.lastRequestedThumbnail=null,n.lastWidth=window.innerWidth,n.lastHeight=window.innerHeight,n.distRatio=1,n.oldScale=1,n.newScale=1,n.oldPinchCenter={x:0,y:0},n.oldDist=1,n.newDist=null,n.oldTouch={x:0,y:0},n.c=null,n.n=null,n.p=null,n.rerenderPages=null,n.nPagesPerWrapper=1,n.searchMode=null,n.annotMode=!1,n.setToolbarContext("top"),n.docViewer.on("displayPageLocation",function(e,t,o,i){clearTimeout(n.swipeTimeout),n.offsetSwipe=0,n.setCurrentPage(parseInt(t,10)-1)}),n.docViewer.on("changePage",function(e,t){n.setCurrentPage(parseInt(t,10)-1)}),n.docViewer.on("linkReady",function(t,n){var o=$(n);e.utils.ie&&o.on("tap",function(e){e.stopImmediatePropagation()}),o.addClass("unselectable")}),n.docViewer.on("pageNumberUpdated",function(e,t){n.$slider.val(t).slider("refresh"),n.fireEvent("pageChanged",{pageNumber:t})}),n.docViewer.on("toolModeUpdated",function(e,t,o){var i=n.$annotCreateMenuContext.find("a");i.removeClass("active");var a="";for(var r in n.toolModeMap)if(t===n.toolModeMap[r]){a=r;break}a&&n.$annotCreateMenuContext.find("[data-toolmode="+a+"]").addClass("active"),n.fireEvent("toolModeChanged",[t,o])}),n.docViewer.on("textSelected",function(e,t,o){n.$clipboard.val(o),o.length>0?n.$clipboardWrapper.show():n.$clipboardWrapper.hide()}),$(n.docViewer.el).css("cursor","default"),n.initUI(),n.initViewer()},e.ReaderControl.prototype={onDocumentLoaded:function(){var t=this;t.doc=t.docViewer.getDocument(),e.BaseReaderControl.prototype.onDocumentLoaded.call(this),t.docViewer.setToolMode(t.defaultToolMode),t.eventsBound||(t.eventsBound=!0,t.bindEvents()),t.nPages=t.docViewer.getPageCount(),t.currentPageIndex=0,t.setPageMode();var n=(e.innerWidth-t.$preview.width())/2;t.$preview.css("left",n+"px"),t.$slider.attr("max",t.nPages),t.margin=t.docViewer.getMargin(),t.hasThumbs=t.doc.includesThumbnails(),t.hasThumbs||(t.$preview.css("height","auto"),t.$thumbContainer.hide()),t.setMinZooms(),t.updateCurrentZooms(t.currentPageIndex);var i=t.doc.getPageInfo(t.currentPageIndex),a=t.docViewer.getPageZoom(t.currentPageIndex);t.$viewer.css("width",i.width*a+"px"),t.$viewer.css("height",i.height*a+"px"),t.currentPageIndex=t.docViewer.getCurrentPage()-1,t.setCurrentPage(t.currentPageIndex),t.$viewer.css("visibility","visible"),t.initBookmarkView(),t.annotationManager=t.docViewer.getAnnotationManager(),t.toolModeMap[o.AnnotationCreateRectangle].defaults.StrokeThickness=3,t.toolModeMap[o.AnnotationCreateEllipse].defaults.StrokeThickness=3,t.toolModeMap[o.AnnotationCreateLine].defaults.StrokeThickness=3,t.toolModeMap.AnnotationCreateArrow.defaults.StrokeThickness=3,t.annotationManager.disableDefaultStickyNotes(),t.annotationManager.disableFreeTextEditing(),t.enableAnnotations&&(t.annotationManager.on("annotationSelected",function(e,n,i){var a=t.docViewer.getAnnotationManager(),r=a.getSelectedAnnotations(),s=!0,d=t.docViewer.getToolMode();if(d===t.toolModeMap[o.Pan]&&(s=r.length>0),t.annotMode=s,t.$annotCreateMenuContext.is(":visible")||t.setMenuTapToggle(!s),"selected"===i&&1===n.length){var l=n[0],c=l.PageNumber-1,u=t.adjustedPageIndex(t.currentPageIndex),p=u+t.nPagesPerWrapper-1;(c<u||c>p)&&t.setCurrentPage(c)}}),t.annotationManager.on("annotationChanged",function(e,n,o){for(var i,a=0;a<n.length;++a)if(i=n[a],i.Listable)if("add"===o){t.$noAnnotations.hide();var r=t.createAnnotationListItem(i);(i.isReply()||i.Hidden)&&r.addClass("annotlist-hidden")}else"delete"===o&&(t.getAnnotationNoteContainer(i).remove(),i.getReplies().forEach(function(e){t.getAnnotationNoteContainer(e).removeClass("annotlist-hidden")}),t.annotationManager.getAnnotationsList().length>0?t.$noAnnotations.hide():t.$noAnnotations.show(),t.threadAnnot===i&&t.viewAnnotsListMode());t.$annotList.hasClass("ui-listview")&&t.refreshAnnotationList()}),t.annotationManager.on("annotationHidden",function(e,n,o){n.forEach(function(e){var n=t.$annotList.find('li[data-id="'+e.Id+'"]');o?n.addClass("annotlist-hidden"):n.removeClass("annotlist-hidden")}),t.refreshAnnotationList()}),t.annotationManager.on("addReply",function(e,n,o,i){t.createAnnotationListItem(n,o,i),t.refreshAnnotationList()}),t.annotationManager.on("deleteReply",function(e,n,o){t.getAnnotationNoteContainer(n,o).remove(),n.getReplies().forEach(function(e){t.getAnnotationNoteContainer(e,o).remove()})}),t.annotationManager.on("setNoteText",function(e,n,o){var i=t.getAnnotationNoteContainer(n,o).children(".annotContainer"),a=n.getContents();i.find("textarea.comment-text").val(a),i.find("span.comment-text").text(a)}),$("#annotationOptions").show(),t.$annotCreateButton.show(),$("#annotListButton").show(),$(".annotBookmarkToggleGroup").show(),t.$annotList.empty(),t.$noAnnotations.appendTo(t.$annotList).show(),t.refreshAnnotationList(),t.$defaultMenuContext.controlgroup()),t.fireEvent("documentLoaded")},bindEvents:function(){function t(e){T.pageDisplay=e,T.setPageMode(),T.setMinZooms(),T.setCurrentPage(T.currentPageIndex)}function n(){var e;if($("#printAuto").prop("checked")?e=T.pageOrientations.Auto:$("#printPortrait").prop("checked")?e=T.pageOrientations.Portrait:$("#printLandscape").prop("checked")&&(e=T.pageOrientations.Landscape),T.startPrintJob($("#printPageNumberInput").val(),e,!1,function(){window.print()}),T.preparingForPrint){var t=T.$printPopup.find(".progress-bar");t.show(),t.find(".ui-slider-bg").addClass("ui-btn-active")}}function c(){T.annotationManager.getMarkupOff()&&(T.annotationManager.toggleAnnotations(),$("#cbShowAnnotations").prop("checked",!0).checkboxradio("refresh"))}function u(e){var t=$('<li class="light" data-color="'+e+'"></li>'),n=$("<div>");return"transparent"===e?n.addClass("color-transparent"):n.css("background",e),t.append(n),t}function p(e){r=e,r?(I.addClass("removing"),E.find("li").each(function(e,t){var n=t.getAttribute("data-color");if(null!==n&&"transparent"!==n){var o=$(t);o.find("div.color-selected").remove(),o.prepend('<div class="color-removing"></div>')}})):(I.removeClass("removing"),E.find("div.color-removing").remove(),C(a))}function h(e,t){var n=window.ControlUtils.getSelectedAnnotation();if(n){var o=T.colorHexToRGB(e.attr("data-color"));if(o){var i=a;if(r){var s=T.colorToHex(o);"transparent"!==s&&(l.removeToolColor(n,i,s),e.remove())}else f(t),g(e),n[a]=o,T.annotationManager.updateAnnotation(n),T.annotationManager.trigger("annotationChanged",[[n],"modify"]),T.fireEvent("defaultToolValueChanged",[n,i,o]),window.ControlUtils.updateAnnotPreview(n)}}}function g(e){e.prepend('<div class="color-selected"></div>')}function f(e){e.find("div.color-selected").remove()}function w(e,t){var n=T.colorToHex(e);f(t),g(t.find('li[data-color="'+n+'"]'))}function v(){T.$addNewColor.hide(),T.$annotEditPopup.find("#annotEditProperties").show()}function C(e){var t=window.ControlUtils.getSelectedAnnotation();if(t){var n,o,s=l.getToolColors(t);a=e,e===i.color?(n=T.$annotEditPopup.find("#colorButton"),o=s.colors):e===i.fillColor?(n=T.$annotEditPopup.find("#fillColorButton"),o=s.fillColors):e===i.textColor&&(n=T.$annotEditPopup.find("#textColorButton"),o=s.textColors),I.removeClass("removing"),r=!1,T.$annotEditPopup.find(".colorButton").removeClass("active"),n.addClass("active"),m();var d=T.$annotEditPopup.find("#colorMenu");d.find("[data-color]").remove(),E.find("[data-color]").remove(),o.forEach(function(e){W.before(u(e))});var c=t[e];w(c,E),w(c,F),T.setEditPopupLocation(t)}}function P(e){d=e,C(a),d===s.basic?(Y.addClass("ui-btn-active"),O.show(),Q.removeClass("ui-btn-active"),H.hide(),U.parent().insertBefore(O.find("#basicPropertyContainer"))):d===s.advanced&&(Q.addClass("ui-btn-active"),H.show(),Y.removeClass("ui-btn-active"),O.hide(),U.parent().insertBefore(H.find("#advancedPropertyContainer"))),T.setEditPopupLocation(window.ControlUtils.getSelectedAnnotation())}function m(){var e=F.find('[data-color="transparent"]');a===i.fillColor?e.show():e.hide()}function x(){j.prop("checked",!1).checkboxradio("refresh"),T.$signaturePopup.popup("open")}function M(e,t,n){var o=readerControl.docViewer.getAnnotationManager();T.$textSelectionContainer.find("#"+e).on("click",function(){for(var e in K)if(K.hasOwnProperty(e)){var i=parseInt(e,10),a=K[i],r=new t;r.PageNumber=i+1,r.Quads=a,r.Author=readerControl.getAnnotationUser(),r.StrokeColor=n.defaults.StrokeColor,window.Tools.TextAnnotationCreateTool.AUTO_SET_TEXT&&r.setContents(readerControl.docViewer.getSelectedText()),o.addAnnotation(r)}readerControl.docViewer.clearSelection(),T.closeEditPopup()})}function A(){var e=parseInt(T.$pageNumberInput.val(),10)||T.docViewer.getCurrentPage();T.$pageNumberInput.val("");var t=T.docViewer.getPageCount();e=e>t?t:e,T.$goToPagePopup.popup("close"),T.setCurrentPage(e-1),window.scrollTo(0,0)}var T=this;T.$viewerPage.bind("swipeleft swiperight",_(this.onSwipe).bind(this)),T.$slider.on("slidestart",_(this.onSliderStart).bind(this)),T.$slider.on("change",_(this.onSliderMove).bind(this)),T.$slider.on("slidestop",_(this.onSliderEnd).bind(this)),T.$viewerPage.bind("touchstart",_(this.onTouchStart).bind(this)),T.$viewerPage.bind("touchmove",_(this.onTouchMove).bind(this)),T.$viewerPage.bind("touchend",_(this.onTouchEnd).bind(this)),$(window).bind("resize",_(this.onResize).bind(this)),$(window).bind("orientationchange",_(this.onOrientationChange).bind(this)),T.$wrapper.bind("vmousedown",_(this.onToolMouseDown).bind(this)),T.$wrapper.bind("vmouseup",_(this.onToolMouseUp).bind(this)),T.$wrapper.bind("contextmenu MSHoldVisual",function(e){e.preventDefault()}),T.$wrapper.bind("taphold",_(this.onTapHold).bind(this)),T.$wrapper.bind("tap",_(this.onTap).bind(this));var y=_.throttle(_(this.onDoubleTap).bind(this),100,{trailing:!1});T.$wrapper.bind("dblclick",y),e.utils.ie||e.utils.isEdge||T.$wrapper.bind("doubletap",y),T.$bookmarkList.on("click","a",_(this.onBookmarkSelect).bind(this)),$.vmouse.resetTimerDuration=400,e.utils.ie&&$("body").on("blur",function(e){e.stopImmediatePropagation(),e.preventDefault()});var b=$("#displaySingle"),S=$("#displayDouble");b.on("checkboxradiocreate",function(){T.pageDisplay===T.pageDisplayModes.Single?b.prop("checked",!0):T.pageDisplay===T.pageDisplayModes.Double&&S.prop("checked",!0)}),b.on("click",function(){t(T.pageDisplayModes.Single)}),S.on("click",function(){t(T.pageDisplayModes.Double)});var k=$("#cbHighRes");k.on("checkboxradiocreate",function(){window.utils.getCanvasMultiplier()>1&&k.prop("checked",!0)}),k.on("change",function(){var e=$(this).prop("checked")?2:1;window.utils.setCanvasMultiplier(e),T.docViewer.removeContent(),T.setCurrentPage(T.currentPageIndex)}),$("#cbShowAnnotations").on("checkboxradiocreate",function(){$(this).prop("checked",!0)}),$(".goToAnnotationPanelButton").on("click",function(){T.changeVisiblePage("annotationDialog")}),$(".goToBookmarkPanelButton").on("click",function(){T.changeVisiblePage("bookmarkDialog")}),T.$customDialogs=$(".custom-dialog"),T.$customDialogs.on("pagecreate",function(){var e=$(this);e.find('div[data-role="header"]').css("-webkit-transform","translateZ(0)"),e.append('<div class="dialogOverlay">')}),T.$customDialogs.on("swiperight",function(t){e.utils.isEditableElement($(t.target))||T.changeVisiblePage("viewerPage")}),T.$customDialogs.click(function(e){$(e.target).hasClass("dialogOverlay")&&T.changeVisiblePage("viewerPage")}),T.$customDialogs.find(".closeBtn").on("mousedown",function(){T.changeVisiblePage("viewerPage")}),T.$viewerPage.on("pagebeforeshow",function(e,t){t.prevPage.hasClass("custom-dialog")&&T.reshowMenu(),"annotationDialog"===t.prevPage.attr("id")&&T.showAnnotationList()}),document.ontouchmove=function(e){$.mobile.activePage.hasClass("custom-dialog")||e.preventDefault()},$("#printButton").on("click",function(){T.$printPopup.popup("open",{y:0})}),$("#printCancelButton").on("click",function(){T.preparingForPrint?T.cancelPrintJob():T.$printPopup.popup("close")}),$("#printForm").submit(function(){return n(),!1}),$("#pageNumberPrintButton").on("click",n),$(document).on("printProgressChanged",function(e,t,n){var o=t/n;T.$printPopup.find("#print-progress").val(100*o).slider("refresh");var i=T.$printPopup.find(".progress-label");i.attr("data-i18n","print.preparingPages").data("i18n-options",{current:t,total:n}).i18n()}),$("#searchButton").click(function(){T.$defaultMenuContext.hide(),T.$searchMenuContext.fadeIn("fast"),T.$searchInput.focus(),T.setToolbarContext("search"),T.setMenuTapToggle(!1)}),$("#searchCancelButton").click(function(){T.$searchMenuContext.hide(),T.$defaultMenuContext.fadeIn("fast"),T.setToolbarContext("top"),T.setMenuTapToggle(!0)}),$("#searchRightButton").click(function(){var e=T.$searchInput.val();T.searchText(e)}),$("#searchLeftButton").click(function(){var e=T.$searchInput.val();T.searchText(e,T.docViewer.SearchMode.e_page_stop|T.docViewer.SearchMode.e_highlight|T.docViewer.SearchMode.e_search_up)}),$("#cbShowAnnotations").change(function(){T.annotationManager.toggleAnnotations()}),$("#saveAnnotationsBtn").click(function(){T.exportAnnotations({start:function(){$.mobile.loading("show",{text:i18n.t("annotations.savingAnnotations"),textVisible:!0})},success:function(e){$.mobile.loading("show",{text:i18n.t("annotations.saveSuccess"),textVisible:!0,textonly:!0})},error:function(e,t,n){console.warn("Failed to send annotations to server."),$.mobile.loading("show",{text:i18n.t("annotations.saveError"),textVisible:!0,textonly:!0})},complete:function(){setTimeout(function(){$.mobile.loading("hide")},1e3)}})}),$("#annotListButton").on("click",function(){c()}),T.$annotCreateButton.on("click",function(){c(),T.endAnnotationQuickMode(),T.$defaultMenuContext.hide(),T.readOnly&&(T.$annotCreateMenuContext.find("a").hide(),T.$annotCreateMenuContext.find("#editAnnotButton").show(),T.$annotCreateMenuContext.find("#textSelectButton").show(),T.$annotCreateMenuContext.find("#annotCreateCancelButton").show()),T.$annotCreateMenuContext.fadeIn("fast"),T.setToolbarContext("tools"),T.setMenuTapToggle(!1)}),$("#annotCreateCancelButton").click(function(){T.docViewer.clearSelection(),T.annotationManager.deselectAllAnnotations(),T.$defaultMenuContext.fadeIn("fast"),T.$annotCreateMenuContext.hide(),T.setToolbarContext("top"),T.setMenuTapToggle(!0)}),T.$annotCreateMenuContext.on("click",function(e){var t=$(e.target).closest("a"),n=t.attr("id");if(t.hasClass("active"))return T.docViewer.setToolMode(T.defaultToolMode),void(T.annotMode=!1);var i=T.buttonIdsToToolModes[n];_.isUndefined(i)||(T.docViewer.setToolMode(i),T.annotMode=!0),"annotCreateCancelButton"===n?(T.docViewer.setToolMode(T.defaultToolMode),T.annotMode=!1,T.$defaultMenuContext.show(),T.setToolbarContext("top"),T.$annotCreateMenuContext.hide()):"textSelectButton"===n&&(T.docViewer.getToolMode()!==T.toolModeMap[o.TextSelect]?T.setToolMode(o.TextSelect):T.docViewer.clearSelection()),T.closeEditPopup()}),T.$annotEditPopup.find("#editDoneButton").click(function(){T.annotationManager.deselectAllAnnotations(),T.closeEditPopup()}),T.$annotEditPopup.find("#editDeleteButton").click(function(){T.deleteSelectedAnnotations(),T.docViewer.getToolMode()===T.toolModeMap[o.Pan]&&(T.annotMode=!1),"top"===T.toolbarContext&&T.setMenuTapToggle(!0)}),T.$annotEditPopup.find("#editNoteButton").click(function(){var e=T.annotationManager.getSelectedAnnotations();if(e&&!(e.length<1)){var t=e[0],n=T.mayEditAnnotation(t);0===t.getReplies().length&&n?T.viewAnnotsSingleMode(t,"thread"):T.viewAnnotsThreadMode(t,"thread")}}),T.$annotEditPopup.find("#editStyleButton").on("click",function(){var e=T.annotationManager.getSelectedAnnotations();if(1===e.length){var t=e[0],n=T.$annotEditPopup.find("#colorType").show(),o=n.find(".colorButton").show(),a=0;_.isNull(t.TextColor)||_.isUndefined(t.TextColor)?T.$annotEditPopup.find("#textColorButton").hide():(C(i.textColor),a++),_.isNull(t.FillColor)||_.isUndefined(t.FillColor)?T.$annotEditPopup.find("#fillColorButton").hide():(C(i.fillColor),a++),_.isNull(t.StrokeColor)||_.isUndefined(t.StrokeColor)?T.$annotEditPopup.find("#colorButton").hide():(C(i.color),a++),_.isNull(t.StrokeThickness)||_.isUndefined(t.StrokeThickness)?T.$annotEditPopup.find(".thicknessPicker").hide():(T.$annotEditPopup.find(".thicknessPicker").show(),Z.update(t.StrokeThickness,!1)),t instanceof Annotations.TextHighlightAnnotation?(T.$annotEditPopup.find(".opacityPicker").hide(),U.hide()):(T.$annotEditPopup.find(".opacityPicker").show(),N.update(100*t.Opacity,!1),U.show()),t.FontSize?(T.$annotEditPopup.find(".fontSizePicker").show(),z.update(parseFloat(t.FontSize),!1)):T.$annotEditPopup.find(".fontSizePicker").hide(),T.$annotEditButtons.hide(),T.$annotEditPopup.find("#annotEditProperties").show(),a<=1?n.hide():2===a?o.css("width","50%"):3===a&&o.css("width","33%"),window.ControlUtils.updateAnnotPreview(t),P(l.getDefaultToolEditingMode(t)),T.setEditPopupLocation(t)}});var E=T.$annotEditPopup.find("#basicProperties .colorPicker"),F=T.$annotEditPopup.find("#advancedProperties .colorPicker"),V=T.$annotEditPopup.find("#addNewColor .colorPicker"),B=l.getAdvancedToolColors();B.forEach(function(e){var t=u(e);V.append(t),F.append(t.clone())}),F.append(u("transparent"));var W=T.$annotEditPopup.find("#addColorButton");W.on("click",function(e){e.stopImmediatePropagation(),R.addClass("disabled"),f(V),T.$annotEditPopup.find("#annotEditProperties").hide(),T.$addNewColor.show()}),T.$addNewColor.find("#cancelAddColor").on("click",function(){v()});var R=T.$addNewColor.find("#selectAddColor");R.on("click",function(){if(!$(this).hasClass("disabled")){var e=window.ControlUtils.getSelectedAnnotation(),t=V.find(".color-selected").parent().attr("data-color");l.addToolColor(e,a,t),C(a),h(E.find('li[data-color="'+t+'"]'),E),v(),T.setEditPopupLocation(e)}}),V.on("click","li",function(){f(V),g($(this)),R.removeClass("disabled")});var I=T.$annotEditPopup.find("#removeColorButton");I.on("click",function(e){e.stopImmediatePropagation(),p(!r)}),T.$annotEditPopup.find("#colorButton").on("click",function(){C(i.color)}),T.$annotEditPopup.find("#fillColorButton").on("click",function(){C(i.fillColor)}),T.$annotEditPopup.find("#textColorButton").on("click",function(){C(i.textColor)}),E.on("click","li",function(){h($(this),E)}),F.on("click","li",function(){h($(this),F)});var L=function(){window.ControlUtils.PropertyManager.apply(this,arguments)};L.prototype=$.extend({},window.ControlUtils.PropertyManager.prototype,{update:function(e){window.ControlUtils.PropertyManager.prototype.update.apply(this,arguments),this.$slider.val(parseFloat(e)).slider("refresh"),this.$radioContainer.find("[data-value]").checkboxradio("refresh"),this.$slider.closest("table").find(".propertyValue").text(Math.round(e)+this.displayUnit)}});var D=document.getElementById("annotPreviewCanvas"),U=$(D);window.ControlUtils.setPreviewCanvas(D,D.width,D.height);var O=T.$annotEditPopup.find("#basicProperties"),H=T.$annotEditPopup.find("#advancedProperties"),Z=new L("StrokeThickness",T.$thicknessSlider,O.find("#thicknessRadio"));Z.setDisplayUnit("pt"),T.$thicknessSlider.change(function(){var e=T.annotationManager.getSelectedAnnotations();if(!(e.length<=0)){var t=e[0];Z.update(T.$thicknessSlider[0].value),T.fireEvent("defaultToolValueChanged",[t,"StrokeThickness",t.StrokeThickness])}});var N=new L("Opacity",T.$opacitySlider,O.find("#opacityRadio"));N.setDisplayUnit("%"),N.setAnnotationPropertyModifier(function(e){return e/100}),T.$opacitySlider.change(function(){var e=T.annotationManager.getSelectedAnnotations();if(!(e.length<=0)){var t=e[0];N.update(T.$opacitySlider[0].value),T.fireEvent("defaultToolValueChanged",[t,"Opacity",t.Opacity])}});var z=new L("FontSize",T.$fontSizeSlider,O.find("#fontSizeRadio"));z.setAnnotationPropertyModifier(function(e){return e+"pt"}),T.$fontSizeSlider.change(function(){var e=T.annotationManager.getSelectedAnnotations();if(!(e.length<=0)){var t=e[0];z.update(T.$fontSizeSlider[0].value),T.fireEvent("defaultToolValueChanged",[t,"FontSize",t.FontSize])}});var X=T.$thicknessSlider.add(T.$opacitySlider).add(T.$fontSizeSlider);X.on("slidestop",function(){var e=T.annotationManager.getSelectedAnnotations();if(!(e.length<=0)){var t=e[0];T.annotationManager.trigger("annotationChanged",[[t],"modify"])}});var Y=T.$annotEditPopup.find("#basicPropertyEdit");Y.on("click",function(){P(s.basic),l.setDefaultToolEditingMode(window.ControlUtils.getSelectedAnnotation(),s.basic)});var Q=T.$annotEditPopup.find("#advancedPropertyEdit");Q.on("click",function(){P(s.advanced),l.setDefaultToolEditingMode(window.ControlUtils.getSelectedAnnotation(),s.advanced),m()}),T.$annotQuickMenu.on("click",function(e){var t=$(e.target).closest("a");if(t.length>0){var n=t.data("toolmode");T.setToolMode(n),T.annotMode=!0,T.annotQuickCreate=!0,T.$annotQuickMenu.popup("close");var o=T.docViewer.getAnnotationManager();o.on("annotationChanged.quickMenu",function(e,t,n){e.imported||"add"!==n||setTimeout(function(){T.endAnnotationQuickMode(),o.selectAnnotation(t[0]),T.showAnnotationEditPopup()},0)})}}),T.$signaturePopup.popup({beforeposition:function(){var e=window.utils.getCanvasMultiplier(),t=.9*window.innerWidth,n=.85*window.innerHeight;G.attr({width:t*e,height:n*e}).css({width:t,height:n})},afteropen:function(){q.openSignature()},afterclose:function(){q.clearSignatureCanvas()}}),T.$signaturePopup.find("#signatureCancelButton").on("click",function(){T.$signaturePopup.popup("close")}),T.$signaturePopup.find("#signatureClearButton").on("click",function(){q.clearSignatureCanvas()}),T.$signaturePopup.find("#signatureAddButton").on("click",function(){var e=j.prop("checked"),t=q.addSignature(e);t&&T.$signaturePopup.popup("close")}),$("#mySignatureButton").on("click",function(){q.addDefaultSignature(),T.closeEditPopup()}),$("#newSignatureButton").on("click",function(){T.closeEditPopup(),x()});var j=$("#makeDefaultSignature"),q=readerControl.toolModeMap.AnnotationCreateSignature;q.on("locationSelected",function(e,t){if(q.hasDefaultSignature()){T.$annotEditButtons.hide(),T.$signatureSelectionContainer.show(),T.$annotEditPopup.popup("option","arrow","b");var n=readerControl.docViewer.getDisplayModeManager().getDisplayMode(),o=n.pageToWindow({x:t.x,y:t.y},t.pageIndex);T.$annotEditPopup.popup("close"),T.$annotEditPopup.popup("open",{x:o.x,y:o.y})}else x()});var G=T.$signaturePopup.find("#signatureCanvas");q.setSignatureCanvas(G);var J=30,K=null,ee=T.$textSelectionContainer.find("#copyButton");T.isCopySupported||(ee.hide(),T.$textSelectionContainer.controlgroup()),ee.on("click",function(){T.copyButtonHandler(),T.closeEditPopup()});var te=readerControl.toolModeMap.TextSelect;if(te.on("selectionComplete",function(e,t,n){if(T.docViewer.getAnnotationManager().getReadOnly()||!readerControl.enableAnnotations){if(!T.isCopySupported)return;ee.siblings().hide(),T.$textSelectionContainer.controlgroup()}T.$annotEditButtons.hide(),T.$textSelectionContainer.show(),T.$annotEditPopup.popup("option","arrow","b"),K=n;var o=t.quad,i={x:(o.x1+o.x3)/2,y:o.y1,pageIndex:t.pageIndex},a=readerControl.docViewer.getDisplayModeManager().getDisplayMode(),r=a.pageToWindow({x:i.x,y:i.y},i.pageIndex);T.$annotEditPopup.popup("close"),T.$annotEditPopup.popup("open",{x:r.x,y:r.y-J})}),M("selectHighlightButton",Annotations.TextHighlightAnnotation,readerControl.toolModeMap.AnnotationCreateTextHighlight),M("selectStrikeoutButton",Annotations.TextStrikeoutAnnotation,readerControl.toolModeMap.AnnotationCreateTextStrikeout),M("selectUnderlineButton",Annotations.TextUnderlineAnnotation,readerControl.toolModeMap.AnnotationCreateTextUnderline),M("selectSquigglyButton",Annotations.TextSquigglyAnnotation,readerControl.toolModeMap.AnnotationCreateTextSquiggly),T.$pageIndicator.on("click",function(){T.$goToPagePopup.popup("open",{y:0}),T.$pageNumberInput.focus()}),T.$goToPagePopup.find("#pageNumberGoButton").on("click",A),$("#goToPageForm").submit(function(){return A(),!1}),T.isAndroid){var ne=$('<input data-role="none" type="text" style="margin-left:-9999px;position:absolute"/>'),oe=$('<input data-role="none" style="height: 0px; width: 0px; border: none; padding: 0px;position: absolute" tabindex="999" type="submit" />');ne.focus(function(){$("#goToPageForm").submit()}),$("#goToPageForm").append(ne,oe)}var ie=$(T.$searchInput.get(0).form);ie.click(function(){T.$searchInput.focus()}),ie.submit(function(){var e=T.$searchInput.val();try{T.searchText(e),T.$searchInput.blur()}catch(t){}finally{return!1}})},initUI:function(){this.$pageIndicator.prop("readonly",!0),$("#annotEditPopup-screen").remove()},initViewer:function(){var t=this;t.displayMode=new e.CoreControls.DisplayMode(t.docViewer,e.CoreControls.DisplayModes.Custom),$.extend(t.displayMode,{windowToPage:function(o,i){var a=t.docViewer.getPageZoom(i),r=t.displayMode.getPageTransform(i),s=new n.Point2D;s.x=o.x-r.x,s.y=o.y-r.y;var d=e.GetPageMatrix(a,t.docViewer.getCompleteRotation(i+1),{width:t.docViewer.getPageWidth(i),height:t.docViewer.getPageHeight(i)},0,!1);d=d.inverse();var l=d.mult(s);return{pageIndex:i,x:l.x,y:l.y}},pageToWindow:function(n,o){var i=t.docViewer.getPageZoom(o),a=t.displayMode.getPageTransform(o),r=e.GetPageMatrix(i,t.docViewer.getCompleteRotation(o+1),{width:t.docViewer.getPageWidth(o),height:t.docViewer.getPageHeight(o)},0,!1);return n=r.mult(n),{pageIndex:o,x:n.x+a.x,y:n.y+a.y}},getSelectedPages:function(e,n){var o=null,i=null;return t.forEachPageInWrapper(t.currentPageIndex,function(a){var r=t.displayMode.getPageTransform(a),s=t.doc.getPageInfo(a),d=t.docViewer.getPageZoom(a),l={x1:r.x,y1:r.y,x2:r.x+s.width*d,y2:r.y+s.height*d};e.x<=l.x2&&e.x>=l.x1&&e.y<=l.y2&&e.y>=l.y1&&(o=a),n.x<=l.x2&&n.x>=l.x1&&n.y<=l.y2&&n.y>=l.y1&&(i=a)}),{first:o,last:i}},getVisiblePages:function(){var e=[],n=t.adjustedPageIndex(t.currentPageIndex),o=function(t){e.push(t)};return t.forEachPageInWrapper(n,o,!0),n+t.nPagesPerWrapper<t.nPages&&t.forEachPageInWrapper(n+t.nPagesPerWrapper,o,!0),n-1>=0&&t.forEachPageInWrapper(n-1,o,!0),e},getPageTransform:function(e){var n=t.getPageData(e);if(null!==t.transformOffset){var o=t.transformOffset.left,i=t.transformOffset.top,a=n.x-n.xShift,r=t.getSnapLocation(o+a,i+n.y,n.totalWidth,n.maxHeight);n.x=r.left+t.vWOffset+n.xShift,n.y=r.top}return{x:n.x,y:n.y,width:n.fitWidth,height:n.fitHeight}},getPageOffset:function(e){var n=t.getPageData(e);return{x:n.x,y:n.y}}}),t.docViewer.getDisplayModeManager().setDisplayMode(t.displayMode),t.docViewer.defaults.DisplayMode=t.displayMode;var o=t.docViewer.FitMode.FitPage;t.docViewer.setFitMode(o),t.docViewer.defaults.FitMode=o,e.CoreControls.SetCachingLevel(2),e.CoreControls.SetPreRenderLevel(0),t.docViewer.setMargin(0),t.docViewer.on("pageComplete",function(e,n,o){t.canvasToAppend=o;var i=t.pagesRendering.indexOf(n);if(i>-1&&t.pagesRendering.splice(i,1),t.rerenderPages)!t.pagesRendering.length&&t.rerenderPages&&t.snapComplete&&t.rerenderPages();else{var a=$("#pageContainer"+n);t.appendCanvas(a.parent(),n)}t.androidBrowser&&t.c.$e.find("canvas").each(function(){var e=$(this);"none"===e.css("transform")&&e.css("transform","translateZ(0)")}),t.fireEvent("pageCompleted",[n+1])})},cancelPrintJob:function(){CoreControls.SetCanvasMode(CoreControls.CanvasMode.ViewportCanvas),this.docViewer.setPagesPerCanvas(this.nPagesPerWrapper,this.isCoverMode),this.$printPopup.find("#print-progress").val(0).slider("refresh").closest(".progress-bar").hide(),this.$printPopup.find(".progress-label").text(""),this.endPrintJob()},offlineReady:function(){function e(e){n.prop("checked",e).checkboxradio("refresh")}var t=this;$("#offlineOptions").show();var n=$("#cbEnableOfflineMode").checkboxradio();t.$defaultMenuContext.trigger("create"),t.$defaultMenuContext.controlgroup(),n.change(function(){var e=!t.doc.getOfflineModeEnabled();t.doc.setOfflineModeEnabled(e)}),t.doc.getOfflineModeEnabled()&&e(!0),$("#offlineDownloadBtn").click(function(){var e=$(this),o=$("#optionsDialog").find(".progress-bar");o.show(),o.find(".ui-slider-bg").addClass("ui-btn-active");var i=e.data("downloading");i?(e.data("downloading",!1),t.doc.cancelOfflineModeDownload()):(e.data("downloading",!0),e.attr("data-i18n","[value]offline.cancelDownload").i18n().button("refresh"),t.doc.storeOffline(function(){e.data("downloading",!1),e.attr("data-i18n","[value]offline.downloadOfflineViewing").i18n().button("refresh"),o.hide(),$("#download-progress").val(0).slider("refresh"),t.doc.isDownloaded()&&n.checkboxradio("enable")},function(e){$("#download-progress").val(100*e).slider("refresh")}))}),t.doc.isDownloaded()||n.attr("disabled",!0)},forEachPageInWrapper:function(e,t,n){var o,i,a=this,r=a.docViewer.getRightToLeftPages(),s=a.adjustedPageIndex(e);if(r&&!n)for(o=a.nPagesPerWrapper-1;o>=0;--o)i=s+o,i>=a.nPages||i<0||t(i);else for(o=0;o<a.nPagesPerWrapper&&(i=s+o,!(i>=a.nPages));++o)i<0||t(i)},endAnnotationQuickMode:function(){this.annotMode=!1,this.annotQuickCreate=!1,this.setToolMode(o.Pan),this.docViewer.getAnnotationManager().off("annotationChanged.quickMenu")},setToolbarContext:function(e){this.toolbarContext=e,this.$pageHeader.attr("data-context",e)},changeVisiblePage:function(e){$.mobile.changePage("#"+e,{transition:"none",changeHash:!1})},setMenuTapToggle:function(e){this.$fixedToolbars.toolbar("option","tapToggle",e)},reshowMenu:function(){this.$fixedToolbars.hasClass("ui-fixed-hidden")&&this.$fixedToolbars.toolbar("show")},setPageMode:function(){this.pageDisplay===this.pageDisplayModes.Single?this.nPagesPerWrapper=1:this.pageDisplay===this.pageDisplayModes.Double&&(window.innerWidth>window.innerHeight?this.nPagesPerWrapper=2:this.nPagesPerWrapper=1),this.docViewer.setPagesPerCanvas(this.nPagesPerWrapper,this.isCoverMode)},updateCurrentZooms:function(e){var t=this,n=t.docViewer.getPageZoom(e);t.currentPageZoom=n,t.currentPageMinZoom=t.minZooms[e];var o=(window.devicePixelRatio>1,5);t.currentPageMaxZoom=t.currentPageMinZoom*o},setMinZooms:function(){for(var e=this,t=0;t<e.nPages;t++){var n=t,o=e.getFitPageZoom(n);e.docViewer.setPageZoom(n,o),e.minZooms[t]=o}},setCurrentToMinZoom:function(){var e=this;e.forEachPageInWrapper(e.currentPageIndex,function(t){e.docViewer.setPageZoom(t,e.minZooms[t])})},clearPages:function(e){e.find("[id^=pageWidgetContainer]").detach()},appendCanvas:function(e,t){var n=this,o=e.find("[class^='canvas'], [class*=' canvas']");o=o.length>0?o[0]:null;var i=Math.min(n.adjustedPageIndex(t)+n.nPagesPerWrapper-1,n.nPages-1)===t;!i&&n.isZoomedIn()||($(n.canvasToAppend).css("position","absolute"),e.append(n.canvasToAppend),o===n.canvasToAppend?o=null:null!==o&&($(o).attr("style",""),$(o).remove()),i&&n.docViewer.returnCanvas(t,o))},createPageWrapper:function(e,t){var n=this,o=n.wrapperToPage(e),i=$('<div style="top:0px; z-index:0; background-color: #929292;" class="pageContainer"></div>');i.attr("id","pageWrapper"+e);var a=0;n.forEachPageInWrapper(o,function(e){var t=n.displayMode.getPageTransform(e),o=Math.ceil(t.width),r=$('<div style="position: absolute; float: left; z-index: 0; background-color: white " class="pageContainer"></div>');r.attr("id","pageContainer"+e).width(o).height(t.height),r.addClass("loading"),n.transform(r,t.x,t.y),i.append(r),t.height>a&&(a=t.height)}),i.width(window.innerWidth),i.height(window.innerHeight);var r=-n.vWOffset+t,s=0;return n.transform(i,r,s),{$e:i,tX:r,
tY:s,i:e}},getFitPageZoom:function(e){var t=this,n=0,o=0;t.forEachPageInWrapper(e,function(e){var i=t.doc.getPageInfo(e);o=i.height>o?i.height:o,n+=i.width});var i=parseFloat(window.innerHeight-2*t.margin)/o,a=parseFloat(window.innerWidth-2*t.margin)/n,r=i<a?i:a;return r},zoomAbort:function(){var e=this;e.pagesRendering=[],e.rerenderPages=null,e.snapComplete=!1,e.zoomedWrapper=null,e.newScale=1,e.oldScale=1},unZoomWrapper:function(){var e=this;if(e.zoomedWrapper){e.setCurrentToMinZoom(),e.clearTransform(e.zoomedWrapper.$e.find("canvas")),e.zoomedWrapper.$e.remove();var t=e.pageToWrapper(e.currentPageIndex);e.c=e.createPageWrapper(t,0),e.$viewer.append(e.c.$e),e.zoomAbort()}},addPages:function(e,t){var n=this,o=n.wrapperToPage(t);n.forEachPageInWrapper(o,function(t){e.push(t)},!0)},pageToWrapper:function(e){return this.isCoverMode&&this.nPagesPerWrapper>1?0===e?0:Math.floor((e+1)/this.nPagesPerWrapper):Math.floor(e/this.nPagesPerWrapper)},wrapperToPage:function(e){return this.isCoverMode&&this.nPagesPerWrapper>1?0===e?-1:e*this.nPagesPerWrapper-1:e*this.nPagesPerWrapper},adjustedPageIndex:function(e){var t=this.pageToWrapper(e);return this.wrapperToPage(t)},numberOfWrappers:function(){var e=this.isCoverMode&&this.nPagesPerWrapper>1?1:0;return Math.ceil((this.nPages+e)/this.nPagesPerWrapper)},getPageData:function(e){var t,n,o=this,i=o.getFitPageZoom(e),a=0,r=0,s=0;o.forEachPageInWrapper(e,function(d){var l=o.doc.getPageInfo(d),c=l.width*i,u=l.height*i;e===d&&(s=a,t=c,n=u),a+=c,u>r&&(r=u)});var d=o.getSnapLocation(0,0,a,r),l=d.left+o.vWOffset+s,c=d.top,u=o.docViewer.getPageZoom(e)/i;return{x:l*u,y:c*u,xShift:s*u,totalWidth:a*u,maxHeight:r*u,fitWidth:t,fitHeight:n}},setCurrentPage:function(t){var n=this;n.transformOffset=null,n.c&&n.clearTransform(n.c.$e.find("canvas")),n.setCurrentToMinZoom(),n.zoomedWrapper&&n.zoomAbort(),t!==n.currentPageIndex&&n.closeEditPopup(),n.currentPageIndex=t,n.updateCurrentZooms(n.currentPageIndex);var o=n.pageToWrapper(t);n.docViewer.removeContent();var i=[];n.addPages(i,o),n.c=n.createPageWrapper(o,0),n.$viewer.append(n.c.$e);var a=n.docViewer.getRightToLeftPages()?-1:1;if(o<n.numberOfWrappers()-1){var r=o+1;n.addPages(i,r),n.n=n.createPageWrapper(r,a*e.innerWidth),n.$viewer.append(n.n.$e)}else n.n=null;if(o>0){var s=o-1;n.addPages(i,s),n.p=n.createPageWrapper(s,-1*a*e.innerWidth),n.$viewer.append(n.p.$e)}else n.p=null;n.docViewer.updateView(i,t),n.$slider.val(t+1).slider("refresh")},cancelPageRenders:function(){var e=this;null!==e.rerenderPages&&(e.rerenderPages=null,e.forEachPageInWrapper(e.currentPageIndex,function(t){e.docViewer.stopPageRender(t)}))},onSwipe:function(t){var n=this;if(!(n.isInToolbar(t.target)||n.isSliding||n.annotMode||n.isPinching||n.isZoomedIn()||n.recentlyZoomed||n.isWidgetTargetType(t.target.type))){var o,i=n.docViewer.getRightToLeftPages(),a=i?-1:1,r=i?"swiperight":"swipeleft",s=i?"swipeleft":"swiperight";if(t.type===s&&n.p)o=-1,n.offsetSwipe--;else{if(t.type!==r||!n.n)return;o=1,n.offsetSwipe++}n.unZoomWrapper();var d=n.docViewer.getCurrentPage()-1,l=n.pageToWrapper(d)+n.offsetSwipe,c=Math.max(0,n.wrapperToPage(l));n.currentPageIndex=c,n.updateCurrentZooms(n.currentPageIndex);var u=null,p=n.c;1===o?(n.c=n.n,u=n.p):(n.c=n.p,u=n.n),n.vWOffset=n.vWOffset+-1*a*o*e.innerWidth,n.$viewerWrapper.stop(),n.$viewerWrapper.addClass("animated"),n.transform(n.$viewerWrapper,n.vWOffset,0),n.vwxPos=n.vWOffset;var h=l+o,g=l-o;u&&(u.$e.detach(),n.docViewer.updateVisiblePages());var f=null;if(h>=0&&h<n.numberOfWrappers()){var w=a*o*e.innerWidth;f=n.createPageWrapper(h,w)}1===o?(n.n=f,n.p=p,n.n&&n.$viewer.append(n.n.$e)):(n.p=f,n.n=p,n.p&&n.$viewer.prepend(n.p.$e)),n.$slider.val(c+1).slider("refresh"),clearTimeout(n.swipeTimeout),n.swipeTimeout=setTimeout(function(){n.offsetSwipe=0;var e=[];n.addPages(e,l),h>=0&&h<n.numberOfWrappers()&&n.addPages(e,h),g>=0&&g<n.numberOfWrappers()&&n.addPages(e,g),n.docViewer.updateView(e,c)},250)}},onSliderStart:function(){var e=this;e.isSliding=!0,1!==e.nPages&&(e.$preview.css("opacity","1"),e.$preview.css("z-index","9999"))},onSliderMove:function(){var e=this;if(e.isSliding!==!1){var t=e.$slider.get(0).value,n=$("#textdiv");n.attr("data-i18n","mobile.thumbnailPageNumber"),n.data("i18n-options",{current:t,total:e.nPages}),n.i18n(),e.hasThumbs&&(clearTimeout(e.getThumbnailTimeout),e.getThumbnailTimeout=setTimeout(function(){var t=e.$slider.get(0).value-1,n=e.$thumbContainer.get(0);e.lastRequestedThumbnail&&e.doc.cancelLoadThumbnail(e.lastRequestedThumbnail),e.lastRequestedThumbnail=e.doc.loadThumbnailAsync(t,function(t){var o,i,a;for(t.width>t.height?(o=t.width/150,a=t.height/o,i=150):(o=t.height/150,i=t.width/o,a=150),t.style.width=i+"px",t.style.height=a+"px";n.hasChildNodes();)n.removeChild(n.firstChild);e.$thumbContainer.css("width",i+"px"),e.$thumbContainer.css("height",a+"px"),e.$preview.css("width",i+"px"),e.$preview.css("height",a+17+"px"),e.$thumbContainer.prepend(t),e.lastRequestedThumbnail=null})},15))}},onSliderEnd:function(){var e=this;if(e.isSliding){e.isSliding=!1;var t=e.$slider.get(0).value;t!==e.docViewer.getCurrentPage()&&e.setCurrentPage(t-1),e.$preview.css("opacity","0"),e.$preview.css("z-index","0"),e.$slider.slider("refresh")}},getTapHotSpotWidth:function(){var t=e.innerWidth/4;return t>80?80:t},onTap:function(t){var n=this;if(n.annotQuickCreate&&n.endAnnotationQuickMode(),n.showAnnotationEditPopup(),"text"===t.target.type||"number"===t.target.type)return!0;var o=e.innerWidth,i=t.pageX,a=t.pageY,r=n.getTapHotSpotWidth(),s=40;if(this.annotMode)n.$annotCreateMenuContext.is(":visible")&&n.reshowMenu();else if(a>s){if(i<r)return n.$wrapper.trigger("swiperight"),!1;if(o-i<r)return n.$wrapper.trigger("swipeleft"),!1}return!0},onDoubleTap:function(t){var n,o=this;n=t.originalEvent.changedTouches?{x:t.originalEvent.changedTouches[0].clientX,y:t.originalEvent.changedTouches[0].clientY}:{x:t.originalEvent.clientX,y:t.originalEvent.clientY};var i=o.getTapHotSpotWidth();if(!(n.x<i||e.innerWidth-n.x<i)&&0===o.offsetSwipe){o.newScale=1,o.oldScale=1;var a=3,r=o.docViewer.getPageZoom(o.currentPageIndex),s=a*o.getFitPageZoom(o.currentPageIndex);if(r<s){var d=o.c.$e.offset(),l=o.c.$e.width(),c=o.c.$e.height(),u=n.x-d.left-l/2,p=n.y-d.top-c/2,h=u*(s/r),g=p*(s/r),f=u-h,w=p-g;o.c.tX+=f,o.c.tY+=w,o.setZoomLevel(s,!1)}else o.setZoomLevel(o.minZooms[o.currentPageIndex],!1);t.stopImmediatePropagation()}},isWidgetTargetType:function(e){return"textarea"===e||"checkbox"===e||"button"===e||"submit"===e},isInToolbar:function(e){return $(e).closest("#pageHeader, #pageFooter").length>0},isZoomedIn:function(){var e=this.docViewer.getPageZoom(this.currentPageIndex),n=this.minZooms[this.currentPageIndex];return e>n&&!t(e,n)},isPageScrolled:function(){return this.vwxPos!==this.vWOffset},onTapHold:function(){this.docViewer.getToolMode()===this.toolModeMap[o.Pan]&&!this.isReadOnly()&&this.enableAnnotations&&(window.innerWidth<=640?(this.$annotQuickMenuButtons.hide(),this.$annotQuickMenuGrid.show()):(this.$annotQuickMenuButtons.show().controlgroup(),this.$annotQuickMenuGrid.hide()),this.$annotQuickMenu.popup("open",this.touchedPoint))},onResize:function(){this.closeEditPopup(),this.$annotQuickMenu.popup("close"),this.$signaturePopup.popup("close");var t=this,n=e.innerWidth,o=e.innerHeight,i=o!==t.lastHeight,a=n!==t.lastWidth,r="none"!==t.$defaultMenuContext.css("display")||"none"!==t.$annotCreateMenuContext.css("display");if(o<t.lastHeight&&!a&&r)return void(t.lastHeight=o);var s=a||i;if(s||window.opera){window.scrollTo(0,0),t.lastWidth=n,t.lastHeight=o,clearTimeout(t.swipeTimeout),t.setPageMode(),t.setMinZooms(),t.updateCurrentZooms(t.currentPageIndex);var d=(e.innerWidth-t.$preview.width())/2;t.$preview.css("left",d+"px"),t.setCurrentPage(t.currentPageIndex),t.annotMode&&t.reshowMenu()}},onOrientationChange:function(e){this.onResize(e)},restartTouchTimeout:function(){var e=this;clearTimeout(e.touchTimeout),e.touchTimeout=setTimeout(_(e.onTouchEnd).bind(e),1e3,{originalEvent:{touches:[]}})},onTouchStart:function(e){var t=this;if(t.restartTouchTimeout(),t.docViewer.trigger("PAUSE"),t.c.$e.removeClass("animated"),e.originalEvent.touches.length>1){if(t.isPageScrolled())return;t.isPinching=!0;var n=e.originalEvent.touches[0],o=e.originalEvent.touches[1],i=o.clientX,a=o.clientY,r=n.clientX,s=n.clientY;t.oldPinchCenter.x=(r+i)/2,t.oldPinchCenter.y=(s+a)/2,t.oldDist=Math.sqrt((r-i)*(r-i)+(s-a)*(s-a))}else 1===e.originalEvent.touches.length&&(t.oldTouch.x=e.originalEvent.touches[0].clientX,t.oldTouch.y=e.originalEvent.touches[0].clientY)},transform:function(e,n,o,i){var a=this;if(t(n,0)&&(n=0),t(o,0)&&(o=0),a.useTransformFallback)e.css("top",o),e.css("left",n),_.isUndefined(i)||e.css("transform","scale("+i+")");else{var r="translate("+n+"px,"+o+"px)",s="translate3d("+n+"px,"+o+"px, 0px)";if(!_.isUndefined(i)){var d=" scale("+i+")";r+=d,s+=d}a.androidBrowser?e.css("transform",s):e.css("transform",s)}},clearTransform:function(e){e.css({transform:"",left:"",top:""})},onTouchMove:function(e){var t=this;t.restartTouchTimeout();var n,o;if(!(t.isInToolbar(e.target)||t.isSliding||t.annotMode||t.isWidgetTargetType(e.target.type))){var i=t.c.$e.width(),a=t.c.$e.height();if(1!==e.originalEvent.touches.length||t.isPinching){if(e.originalEvent.touches.length>1){if(t.isPageScrolled())return;n=e.originalEvent.touches[0],o=e.originalEvent.touches[1];var r=o.clientX,s=o.clientY,d=n.clientX,l=n.clientY;t.newDist=Math.sqrt((d-r)*(d-r)+(l-s)*(l-s)),t.distRatio=t.newDist/t.oldDist;var c={x:(d+r)/2,y:(l+s)/2};t.newScale=t.distRatio*t.oldScale;var u=t.newScale*t.currentPageZoom;u>t.currentPageMaxZoom&&(t.newScale=t.currentPageMaxZoom/parseFloat(t.currentPageZoom));var p=t.c.tX+t.vWOffset+i/2,h=t.c.tY+a/2,g={x:p,y:h},f=g.x-t.newScale/t.oldScale*(g.x-t.oldPinchCenter.x),w=g.y-t.newScale/t.oldScale*(g.y-t.oldPinchCenter.y),v={x:f,y:w},C=c.x-v.x,P=c.y-v.y;t.c.tX=t.c.tX+C,t.c.tY=t.c.tY+P,t.transform(t.c.$e,t.c.tX,t.c.tY,t.newScale),t.oldScale=t.newScale,t.oldDist=t.newDist,t.oldPinchCenter.x=c.x,t.oldPinchCenter.y=c.y,t.shouldRerender=!0,t.cancelPageRenders()}}else{n=e.originalEvent.touches[0],t.$viewerWrapper.removeClass("animated");var m=t.oldTouch.x-n.clientX,$=t.oldTouch.y-n.clientY;t.isZoomedIn()?(t.c.tY=t.c.tY-$,t.c.tX=t.c.tX-m,t.transform(t.c.$e,t.c.tX,t.c.tY,t.newScale),t.shouldRerender=!0,t.cancelPageRenders()):(t.vwxPos=t.vwxPos-m,t.transform(t.$viewerWrapper,t.vwxPos,0)),t.oldTouch.x=n.clientX,t.oldTouch.y=n.clientY}}},onTouchEnd:function(t,n){var o=this;if(0===t.originalEvent.touches.length){clearTimeout(o.touchTimeout);var i=o.newScale*o.currentPageZoom,a=!1;if(i<o.currentPageMinZoom&&(i=o.currentPageMinZoom,o.newScale=i/parseFloat(o.currentPageZoom),o.oldScale=o.newScale,a=!0),o.startRerender(i),_.isUndefined(n)&&(n=!0),o.snapBack(a,n),o.shouldRerender){o.clearPages(o.c.$e);var r=o.getVisibleZoomedPages(),s=o.displayMode.getVisiblePages();r.length<o.nPagesPerWrapper&&(o.forEachPageInWrapper(o.currentPageIndex,function(e){if(r.indexOf(e)===-1){var t=s.indexOf(e);t!==-1&&s.splice(t,1)}}),o.pagesRendering=r),o.docViewer.updateView(s)}var d=o.vwxPos,l=o.pageToWrapper(o.currentPageIndex);-d+o.vWOffset>e.innerWidth/2&&l<o.numberOfWrappers()-1?(o.$wrapper.trigger("swipeleft"),t.stopImmediatePropagation()):d-o.vWOffset>e.innerWidth/2&&l>0?(o.$wrapper.trigger("swiperight"),t.stopImmediatePropagation()):(o.$viewerWrapper.addClass("animated"),o.vwxPos!==o.vWOffset&&o.transform(o.$viewerWrapper,o.vWOffset,0),o.vwxPos=o.vWOffset),o.isPinching=!1,o.shouldRerender=!1,o.docViewer.trigger("RESUME")}},startRerender:function(e){var n=this;n.shouldRerender&&(n.pagesRendering=[],n.forEachPageInWrapper(n.currentPageIndex,function(t){n.docViewer.setPageZoom(t,e),n.pagesRendering.push(t)}),n.c.$e.find(".auxiliary").hide(),n.rerenderPages=function(){n.rerenderPages=null,t(e,n.currentPageMinZoom)&&(n.zoomedWrapper=null,n.transformOffset=null),n.c.$e.removeClass("animated");var o=parseFloat(n.c.$e[0].style.width),i=parseFloat(n.c.$e[0].style.height),a=n.c.tX-n.newScale*o/2+o/2,r=n.c.tY-n.newScale*i/2+i/2;n.c.tX=a,n.c.tY=r,n.transform(n.c.$e,a,r,1),n.c.$e.width(o*n.newScale),n.c.$e.height(i*n.newScale);var s=[];n.c.$e.find("[id^=pageContainer]").each(function(){var e=parseFloat(this.style.width),t=parseFloat(this.style.height),o=$(this),i=parseInt(o.attr("id").slice("pageContainer".length),10);s.push(i),o.width(e*n.newScale).height(t*n.newScale),o.find("img").width(e*n.newScale).height(t*n.newScale);var a=n.getPageData(i);n.transform(o,a.x,a.y)}),n.transform(n.c.$e.find("canvas"),-a-n.vWOffset,-r),n.transform($(n.canvasToAppend),-a-n.vWOffset,-r);var d=s.sort(function(e,t){return e-t}),l=d[d.length-1];n.appendCanvas(n.c.$e,l),n.c.$e.find(".auxiliary").show(),n.currentPageZoom=e,n.newScale=1,n.oldScale=n.newScale,n.snapComplete=!1,n.shouldRerender=!1},t(e,n.currentPageMinZoom)||(n.zoomedWrapper=n.c),n.recentlyZoomed=!0,clearTimeout(n.zoomTimeout),n.zoomTimeout=setTimeout(function(){n.recentlyZoomed=!1},500))},getSnapLocation:function(t,n,o,i){var a=this,r=-a.vWOffset;return n<0&&n+i<=e.innerHeight&&(n=e.innerHeight-i),n+i>e.innerHeight&&n>0&&(n=0),t<r&&t+o<=e.innerWidth+r&&(t=r+e.innerWidth-o),t+o>r+e.innerWidth&&t>r&&(t=r),i<=e.innerHeight&&(n=(e.innerHeight-i)/2),o<=e.innerWidth&&(t=r+(e.innerWidth-o)/2),{top:n,left:t}},snapBack:function(e,n){var o=$(window).scrollTop(),i=o>1&&20!==o;if(!(i||this.isAndroid&&$(document.activeElement).is("textarea, input"))){var a=this,r=parseFloat(a.c.$e.get(0).style.width),s=parseFloat(a.c.$e.get(0).style.height),d=r,l=s,c=a.c.tX-a.newScale*d/2+d/2,u=a.c.tY-a.newScale*l/2+l/2;r*=a.newScale,s*=a.newScale;var p=Math.max(0,a.adjustedPageIndex(a.currentPageIndex));a.docViewer.getRightToLeftPages()&&(!a.isCoverMode||p>0)&&(p=Math.min(p+a.nPagesPerWrapper-1,a.nPages-1));var h=a.getPageData(p),g=a.getSnapLocation(c+h.x,u+h.y,h.totalWidth,h.maxHeight);g.left-=h.x,g.top-=h.y;var f=a.c.tX,w=a.c.tY;a.c.tX=g.left+a.newScale*d/2-d/2,a.c.tY=g.top+a.newScale*l/2-l/2;var v=!n||t(f,a.c.tX)&&t(w,a.c.tY)&&!e;if(v)a.snapComplete=!0;else{var C=function(){a.snapComplete=!0,!a.pagesRendering.length&&a.rerenderPages&&a.rerenderPages(),a.c.$e.get(0).removeEventListener("webkitTransitionEnd",C,!1),a.c.$e.get(0).removeEventListener("transitionend",C,!1)};a.c.$e.get(0).addEventListener("webkitTransitionEnd",C,!1),a.c.$e.get(0).addEventListener("transitionend",C,!1),a.c.$e.addClass("animated")}a.transform(a.c.$e,a.c.tX,a.c.tY,a.newScale),a.transformOffset={left:c,top:u}}},getVisibleZoomedPages:function(){var t,n=this,o=[],i=e.pageYOffset,a=i+e.innerHeight,r=e.pageXOffset,s=r+e.innerWidth;return n.forEachPageInWrapper(n.currentPageIndex,function(e){t=n.doc.getPageInfo(e);var d=n.displayMode.pageToWindow({x:0,y:0},e),l=n.displayMode.pageToWindow({x:t.width,y:t.height},e);(d.x<l.x?d.x:l.x)<=s&&(d.x<l.x?l.x:d.x)>=r&&(d.y<l.y?d.y:l.y)<=a&&(d.y<l.y?l.y:d.y)>=i&&o.push(e)},!0),o},searchText:function(e,t){var o=[],i=this;if(""!==e){var a=i.docViewer.SearchMode.e_page_stop|i.docViewer.SearchMode.e_highlight;t&&(a|=i.docViewer.SearchMode.e_search_up),i.docViewer.textSearchInit(e,a,!1,function(e){e.resultCode===n.ResultCode.e_found?(o.push(e.page_num),i.docViewer.displaySearchResult(e,_(i.jumpToFound).bind(i))):e.resultCode===n.ResultCode.e_done&&alert(i18n.t("endOfDocument"))})}},fullSearch:function(e,t){var o=this,i=[];if(""!==e){var a=o.docViewer.SearchMode.e_page_stop|o.docViewer.SearchMode.e_highlight;t&&(a|=o.docViewer.SearchMode.e_search_up),o.docViewer.textSearchInit(e,a,!0,function(e){if(e.resultCode===n.ResultCode.e_found){var t=e.page_num;i.push(e.page_num),o.docViewer.displaySearchResult(e,function(){o.jumpToFound(t,e.quads)})}else e.resultCode===n.ResultCode.e_done&&alert(i18n.t("endOfDocument"))})}},jumpToFound:function(t,n){var o=this;if(o.currentPageIndex!==t&&o.setCurrentPage(t),o.currentPageZoom!==o.getFitPageZoom(o.currentPageIndex)&&n.length>0){for(var i=n[0].getPoints(),a=i.y4,r=i.x4,s=i.y2,d=i.x2,l=1;l<n.length;l++){var c=n[l].getPoints();c.x4<r&&(r=c.x4),c.y4<a&&(a=c.y4),c.x2>d&&(d=c.x2),c.y2>s&&(s=c.y2)}var u=e.pageYOffset,p=u+document.documentElement.clientHeight,h=e.pageXOffset,g=h+document.documentElement.clientWidth,f=this.displayMode.pageToWindow({x:r,y:a},t),w=this.displayMode.pageToWindow({x:d,y:s},t),v={x:f.x<w.x?f.x:w.x,y:f.y<w.y?f.y:w.y},C={x:f.x>w.x?f.x:w.x,y:f.y>w.y?f.y:w.y};if(v.x<h||v.y<u||C.x>g||C.y>p){var P=C.x-v.x,m=C.y-v.y,$=o.c.tX,x=o.c.tY,M=$-v.x+parseInt(e.innerWidth/2,10)-P/2,A=x-v.y+parseInt(e.innerHeight/2,10)-m/2,T=o.c.$e.width(),y=o.c.$e.height(),b=-o.vWOffset;A<0&&A+y<=e.innerHeight&&(A=e.innerHeight-y),A+y>e.innerHeight&&A>0&&(A=0),M<b&&M+T<=e.innerWidth+b&&(M=b+e.innerWidth-T),M+T>b+e.innerWidth&&M>b&&(M=b),o.c.tX=M,o.c.tY=A,o.shouldRerender=!0,o.cancelPageRenders(),o.onTouchEnd({originalEvent:{touches:[]}})}}},onBookmarkSelect:function(e){var t=this,n=e.currentTarget.getAttribute("data-bookmark-page");if(null!==n){var o=parseInt(n,10);isNaN(o)?window.open(n):t.setCurrentPage(o-1)}else{var i=e.currentTarget.getAttribute("data-bookmark-level");t.createBookmarkList(i);var a=t.$bookmarkList;a.listview("refresh")}},onToolMouseDown:function(e){if(this.closeEditPopup(),this.touchedPoint={x:e.pageX,y:e.pageY},this.docViewer.getToolMode()===this.toolModeMap[o.TextSelect])return this.reshowMenu(),!1},onToolMouseUp:function(e){if(this.showAnnotationEditPopup(e),this.docViewer.getToolMode()===this.toolModeMap[o.TextSelect]){var t=this.$clipboard.get(0);t.focus(),t.selectionStart=0,t.setSelectionRange(0,this.$clipboard.get(0).value.length)}},setTextareaReadonly:function(e,t){e.prop("readonly",t)},showAnnotationList:function(){var e=this,t=$(".annotContainer");t.find(".annotlist-editButton").show(),t.find(".annotlist-replyButton").show(),t.find(".annotlist-deleteButton").hide(),t.find(".annotlist-doneButton").hide(),t.find(".annotlist-viewButton").show(),this.$annotList.children("li").each(function(){var t=$(this);t.show();var n=t.find(".annotContainer");n.attr("data-mode","list").show();var o=n.find("textarea");o.removeClass("ui-focus").hide(),e.setTextareaReadonly(o,!0)}),e.annotationManager.getAnnotationsList().length>0?e.$noAnnotations.hide():e.$noAnnotations.show(),this.$annotList.attr("data-last-mode","list"),this.refreshAnnotationList()},getAnnotationNoteContainer:function(e,t){function n(e){return'li[data-id="'+e.Id+'"]'}var o=this;t=t||e;var i=o.$annotList.children(n(t));return e===t?i:i.find(n(e))},createAnnotationListItem:function(e,t,n){var o=this,i=$("<li>").attr("data-id",e.Id).addClass("needstouch");i.click(function(t){var n=o.$annotList.attr("data-mode");"single"!==n&&$(t.target).hasClass("jumpToPage")&&(o.annotationManager.deselectAllAnnotations(),o.annotationManager.selectAnnotation(e),o.changeVisiblePage("viewerPage"),o.showAnnotationEditPopup())});var a=n?o.getAnnotationNoteContainer(t,n):o.$annotList;i.data("pagenumber",e.PageNumber);var r=!!n,s="<div class='annotContainer'>",d=e.Subject;"Sticky"===d&&(d="Comment"),s+="<a class='subject jumpToPage'>"+d+"</a>",s+="</div>";var l=$(s);l.attr("data-mode","list");var c=o.$annotList.attr("data-mode");"single"===c&&l.hide();var u=$('<a class="noteButton annotlist-doneButton">(<span data-i18n="annotationPopup.buttonDone"></span>)</a>');u.hide(),l.append(u),u.on("click",function(t){t.stopImmediatePropagation(),o.annotationManager.setNoteContents(e,v.val()),e instanceof Annotations.FreeTextAnnotation&&o.annotationManager.drawAnnotationsFromList([e]);var n=o.$annotList.attr("data-return-mode");return"thread"===n&&e?void o.viewAnnotsThreadMode(e):void o.viewAnnotsListMode()});var p=o.mayEditAnnotation(e);if(p){var h=$('<a class="noteButton annotlist-deleteButton">(<span class="needsclick" data-i18n="annotationPopup.buttonDelete"></span>)</a>');h.hide(),l.append(h),h.on("mousedown",function(t){if(t.stopImmediatePropagation(),e.isReply()){var n=o.$annotList.attr("data-return-mode");"thread"===n&&e?o.viewAnnotsThreadMode(e):o.viewAnnotsListMode()}else o.viewAnnotsListMode();o.annotationManager.deleteAnnotation(e)});var g=$('<a class="noteButton annotlist-editButton">(<span data-i18n="annotationPopup.buttonEdit"></span>)</a>');l.append(g),g.on("click",function(t){t.stopImmediatePropagation(),o.viewAnnotsSingleMode(e)})}else{l.append(u);var f=$('<a class="noteButton annotlist-viewButton">(<span data-i18n="annotationPopup.buttonView"></span>)</a>');l.append(f),f.on("click",function(t){t.stopImmediatePropagation(),o.viewAnnotsSingleMode(e)})}if(!o.isReadOnly()){var w=$('<a class="noteButton annotlist-replyButton">(<span data-i18n="annotationPopup.buttonReply"></span>)</a>');l.append(w),w.on("click",function(t){t.stopImmediatePropagation();var n=o.annotationManager.createAnnotationReply(e);o.viewAnnotsSingleMode(n)})}$("<div class='lastmodified'></div>").appendTo(l);var v=$("<textarea>").addClass("comment-text");o.setTextareaReadonly(v,!0),v.textinput(),v.on("keyup",function(){clearTimeout(o.noteModifyTimeout),o.noteModifyTimeout=setTimeout(function(){o.annotationManager.setNoteContents(e,v.val()),e instanceof Annotations.FreeTextAnnotation&&o.annotationManager.drawAnnotationsFromList([e])},500)}),v.hide();var C=$('<div class="comment-content">');C.append('<span class="annot-type-image"></span>');var P=e.Author?e.Author+": ":"";C.append("<span class='author'>"+P+"</span>"),C.append('<span class="comment-text"></span>'),C.append(v),l.append(C),l.i18n(),r&&l.addClass("reply"),i.append(l);for(var m=null,x=a.find("li"),M=!1,A=0;A<x.length;A++){var T=$(x[A]),y=T.data("pagenumber");if("undefined"!=typeof y){if(!(e.PageNumber>=y)){T.before(i),M=!0;break}m=T}}return!M&&m?m.after(i):M||a.append(i),o.refreshAnnotationItem(e,i),i},refreshAnnotationItem:function(e,t){var n=e.getContents()||"",o=t.children(".annotContainer");o.find("span.comment-text").text(n),o.find("textarea.comment-text").val(n),o.find(".lastmodified").text("Created: "+e.DateCreated.toLocaleString())},refreshAnnotationList:function(){this.$annotList.listview("refresh")},viewAnnotsListMode:function(){var e=this;this.threadAnnot=null,this.$annotList.attr("data-mode","list"),this.$annotList.attr("data-return-mode","list"),$(".showAllAnnotButton").hide();var t=$(".annotContainer");t.find(".annotlist-editButton").show(),t.find(".annotlist-replyButton").show(),t.find(".annotlist-deleteButton").hide(),t.find(".annotlist-doneButton").hide(),t.find(".annotlist-viewButton").show(),this.$annotList.children("li").each(function(){var t=$(this);t.show();var n=t.find(".annotContainer");n.attr("data-mode","list").show();var o=n.find("textarea");o.removeClass("ui-focus").hide(),e.setTextareaReadonly(o,!0)}),this.annotationManager.getAnnotationsList().length>0?this.$noAnnotations.hide():this.$noAnnotations.show(),this.$annotList.attr("data-last-mode","list"),this.refreshAnnotationList()},viewAnnotsThreadMode:function(e){var t=this;this.$annotList.attr("data-mode","thread"),this.$annotList.attr("data-return-mode","thread"),$(".showAllAnnotButton").show();var n=$(".annotContainer");n.find(".annotlist-editButton").show(),n.find(".annotlist-replyButton").show(),n.find(".annotlist-deleteButton").hide(),n.find(".annotlist-doneButton").hide(),n.find(".annotlist-viewButton").show();var o=t.annotationManager.getRootAnnotation(e);this.threadAnnot=o,this.$annotList.children("li").each(function(){var e=$(this),n=e.attr("data-id");if(o.Id===n){e.show();var i=e.find(".annotContainer");i.attr("data-mode","thread").show();var a=i.find("textarea");a.removeClass("ui-focus").hide(),t.setTextareaReadonly(a,!0)}else e.hide()}),t.annotationManager.getAnnotationsList().length>0?t.$noAnnotations.hide():t.$noAnnotations.show(),this.$annotList.attr("data-last-mode","thread"),this.refreshAnnotationList(),this.changeVisiblePage("annotationDialog")},viewAnnotsSingleMode:function(e,t){this.threadAnnot=null,$(".showAllAnnotButton").hide(),this.$annotList.attr("data-mode","single"),t&&this.$annotList.attr("data-return-mode",t);var n=this.annotationManager.getRootAnnotation(e);this.editAnnotationNote(e,n)},editAnnotationNote:function(t,n){var o=this;n=n||t;var i=o.getAnnotationNoteContainer(t,n),a=o.getAnnotationNoteContainer(n);o.$annotList.children().not(a).hide();var r=i.children(".annotContainer");a.find(".annotContainer").not(r).hide();var s=r.find("textarea.comment-text");s.show(),r.attr("data-mode","single");var d=r.children(".annotlist-editButton"),l=r.children(".annotlist-doneButton"),c=r.children(".annotlist-deleteButton"),u=r.children(".annotlist-replyButton");if(o.mayEditAnnotation(t))r.addClass("edit").removeClass("view"),o.setTextareaReadonly(s,!1),s.textinput("option","autogrow",!0).textinput("refresh"),d.hide(),l.show(),c.show(),u.hide(),s.on("blur",function(){s.off("blur"),$(this).closest(".annotContainer").children(".annotlist-doneButton").click(),o.refreshAnnotationItem(t,s.closest("li")),$("#annotationDialog .ui-content").scrollTop(a.position().top)});else{r.addClass("view").removeClass("edit"),l.show(),c.show(),u.hide();var p=r.children(".annotlist-viewButton");p.hide(),o.setTextareaReadonly(s,!0),s.textinput("option","autogrow",!0).textinput("refresh")}o.changeVisiblePage("annotationDialog"),e.utils.ie?setTimeout(function(){s.focus()},100):s.focus()},showAnnotationEditPopup:function(e){var t=this,n=t.annotationManager.getSelectedAnnotations();if(1===n.length){var o=n[0];t.mayEditAnnotation(o)?(t.$annotEditButtons.find("a").show(),o instanceof Annotations.StampAnnotation&&t.$annotEditButtons.find("#editStyleButton").hide()):(t.$annotEditButtons.find("a").hide(),t.$annotEditButtons.find("#editDoneButton").show(),t.$annotEditButtons.find("#editNoteButton").show()),t.$annotEditButtons.controlgroup(),t.setEditPopupLocation(o),e&&e.preventDefault()}else if(n.length>1){t.$annotEditButtons.find("a").hide(),t.$annotEditButtons.find("#editDoneButton").show();for(var i=!1,a=0;a<n.length;++a)if(t.mayEditAnnotation(n[a])){i=!0;break}i&&t.$annotEditButtons.find("#editDeleteButton").show(),t.$annotEditButtons.controlgroup(),t.setEditPopupLocation(n[0])}},setEditPopupLocation:function(e){var t=this,n=e.getPageNumber()-1,o=20,i=e.getX()+e.getWidth()/2,a=e.getY()-o,r=t.displayMode.pageToWindow({x:i,y:a},n);t.$annotEditPopup.parent().removeClass("ui-popup-truncate");var s=t.$annotEditPopup.height();if(r.y<s){var d=e.getY()+e.getHeight()+o,l=t.displayMode.pageToWindow({x:0,y:d},n);r.y=l.y,t.$annotEditPopup.popup("option","arrow","t")}else t.$annotEditPopup.popup("option","arrow","b");t.$annotEditPopup.popup("close"),t.$annotEditPopup.popup("open",{x:r.x,y:r.y})},closeEditPopup:function(){this.$annotEditPopup.popup("close"),this.$annotEditButtons.show(),this.$annotEditPopup.find("#annotEditProperties").hide(),this.$addNewColor.hide(),this.$signatureSelectionContainer.hide(),this.$textSelectionContainer.hide()},deleteSelectedAnnotations:function(){this.annotationManager.deleteAnnotations(this.annotationManager.getSelectedAnnotations()),this.closeEditPopup()},mayEditAnnotation:function(e){return this.annotationManager.canModify(e)},createBookmarkList:function(e){var t=this;t.doc.getBookmarks().then(function(n){var o=t.$bookmarkList,i="";if(null===n||n.length<1)return i='<li data-i18n="mobile.bookmarks.noBookmarks"></li>',o.html(i),o.i18n(),o.listview(),void o.listview("refresh");if(_.isUndefined(e)||""===e)e="";else{for(var a=e.split(","),r=0;r<a.length;r++){var s=a[r];n=n[s].getChildren()}a.pop();var d=a>1?a.join(","):a.toString();i+='<li data-role="list-divider" class="ui-icon-arrow-u" data-theme="a" style="-webkit-transform: translateZ(0)"><a data-bookmark-level="'+d+'" data-i18n="mobile.bookmarks.upOneLevel"></a></li>',null!==a&&(e+=",")}for(var l=0;l<n.length;l++){var c=n[l],u=c.getPageNumber()?c.getPageNumber():c.getURL(),p=c.getChildren().length,h="<span>"+c.getName()+"</span>";h=p>0?'<a href="#viewerPage" class="unselectable" data-bookmark-page="'+u+'">'+h+'</a><a data-shadow="false" data-theme="a" data-bookmark-level="'+e+l+'"></a>':'<a href="#viewerPage" class="unselectable" data-transition="none" data-bookmark-page="'+u+'">'+h+"</a>";var g='<li style="-webkit-transform: translateZ(0)" data-icon="false" class="bookmark-item"  data-pagenumber="'+u+'">'+h+"</li>";i+=g}o.html(i),o.i18n(),o.listview(),o.listview("refresh")})},initBookmarkView:function(){var e=this;e.createBookmarkList()},colorToHex:function(e){var t=e.toHexString();return t||(t="transparent"),t},colorHexToRGB:function(e){return"transparent"===e?new Annotations.Color(255,255,255,0):new Annotations.Color(e)},setCurrentPageNumber:function(e){this.setCurrentPage(e-1)},goToFirstPage:function(){this.setCurrentPage(0)},goToLastPage:function(){var e=this.docViewer.getPageCount()-1;e<=0||this.setCurrentPage(e)},goToNextPage:function(){var e=this.docViewer.getCurrentPage();e>=this.docViewer.getPageCount()||this.setCurrentPage(e)},goToPrevPage:function(){var e=this.docViewer.getCurrentPage()-2;e<0||this.setCurrentPage(e)},getZoomLevel:function(){return this.currentPageZoom},setZoomLevel:function(e,t){this.newScale=e/this.currentPageZoom,this.shouldRerender=!0,t&&this.c.$e.addClass("animated"),this.onTouchEnd({originalEvent:{touches:[]}},t)},setLayoutMode:function(t){this.isCoverMode=t===e.CoreControls.DisplayModes.Cover,this.docViewer.setPagesPerCanvas(this.nPagesPerWrapper,this.isCoverMode),this.docViewer.getDocument()&&(this.docViewer.removeContent(),this.setCurrentPage(this.currentPageIndex))}},e.ReaderControl.prototype=$.extend({},e.BaseReaderControl.prototype,e.ReaderControl.prototype)}(window),$(function(){$(document).one("viewerLoaded",function(){$("#ui-display").show()}),window.ControlUtils.initialize(function(){alert(i18n.t("mobile.unsupportedBrowser"))})}),ReaderControl.config={serverURL:"annotationHandler.php",defaultUser:"Guest"},ReaderControl.config.ui={hideAnnotationPanel:!1,hideControlBar:!1,hideSidePanel:!1,hideDisplayModes:!1,hideZoom:!1,hideTextSearch:!1,hidePrint:!1};